<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Session - IntellaClick</title>
  <script type="module" crossorigin src="/assets/create-session-j78ar7fM.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/toast-93yYkT8V.js">
  <link rel="modulepreload" crossorigin href="/assets/api-Cc5qfUA_.js">
  <link rel="modulepreload" crossorigin href="/assets/logger-gSLuc3Ra.js">
  <link rel="stylesheet" crossorigin href="/assets/common-ABeTdMwf.css">
  <link rel="stylesheet" crossorigin href="/assets/create-session-BUlOf5Ha.css">
</head>
<body>
    <div class="container">
        <a href="classes.html" class="back-link">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Classes
        </a>

        <div class="header">
            <h1>Start New Session</h1>
            <div class="class-info" id="classInfo">
                Loading class information...
            </div>
        </div>

        <div class="info-box">
            <h3>Session Types</h3>
            <p>Choose how you want to run your clicker session. You can use the web interface for quick polls or integrate with the desktop app for PowerPoint integration.</p>
        </div>

        <div class="section">
            <h2>Choose Session Type</h2>
            <div class="session-options">
                <div class="option-card" onclick="selectSessionType('quick')" id="quickOption">
                    <h3>Quick Poll</h3>
                    <p>Start a simple multiple choice or true/false poll instantly</p>
                </div>
                <div class="option-card" onclick="selectSessionType('quiz')" id="quizOption">
                    <h3>Quiz Session</h3>
                    <p>Run a prepared quiz with multiple questions</p>
                </div>
                <div class="option-card" onclick="selectSessionType('desktop')" id="desktopOption">
                    <h3>Desktop App</h3>
                    <p>Use with PowerPoint and advanced features</p>
                </div>
            </div>
        </div>

        <div class="section" id="sessionConfig" style="display: none;">
            <h2>Session Configuration</h2>
            <form id="sessionForm">
                <div class="form-group">
                    <label for="sessionName">Session Name</label>
                    <input type="text" id="sessionName" placeholder="e.g., Week 3 Review" required>
                </div>

                <div class="form-group">
                    <label for="customSessionCode">
                        Custom Session Code (Optional)
                        <small style="color: var(--text-secondary); display: block; margin-top: 4px;">
                            Leave blank for random code, or enter your own (e.g., BIO3002025). Same code can be reused for multiple sessions.
                        </small>
                    </label>
                    <input
                        type="text"
                        id="customSessionCode"
                        placeholder="e.g., BIO3002025"
                        maxlength="20"
                        pattern="[A-Za-z0-9]{4,20}"
                        title="4-20 characters, letters and numbers only"
                        style="text-transform: uppercase;"
                    >
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="enableGamification" checked style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="display: flex; flex-direction: column; gap: 4px;">
                            <span style="font-weight: 600; font-size: 14px;">üèÜ Enable Gamification</span>
                            <span style="font-size: 12px; color: var(--text-secondary); font-weight: normal;">
                                Students will earn points, achievements, and level up during this session
                            </span>
                        </span>
                    </label>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="autoSaveQuestions" checked style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="display: flex; flex-direction: column; gap: 4px;">
                            <span style="font-weight: 600; font-size: 14px;">üíæ Save Questions for Reuse</span>
                            <span style="font-size: 12px; color: var(--text-secondary); font-weight: normal;">
                                Automatically save this session's questions to "Saved Question Sets" for future use
                            </span>
                        </span>
                    </label>
                </div>

                <div class="form-group" id="quickPollConfig" style="display: none;">
                    <!-- Load Saved Questions Button -->
                    <div style="margin-bottom: 16px;">
                        <button type="button" class="btn btn-secondary" onclick="goToSavedQuestions()" style="width: 100%;">
                            üìÇ Manage Saved Question Sets
                        </button>
                    </div>

                    <!-- Question Defaults Section (moved up from bottom) -->
                    <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; margin-bottom: 20px; background-color: #F9FAFB;">
                        <h3 style="font-size: 16px; margin-bottom: 12px; color: var(--text-primary);">‚öôÔ∏è Question Defaults</h3>
                        <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
                            Set default values for all questions in this session. These apply automatically to new questions and imported quizzes.
                        </p>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 12px;">
                            <div>
                                <label for="defaultTimeLimit" style="font-size: 13px; display: block; margin-bottom: 4px;">
                                    Time Limit (seconds)
                                </label>
                                <input
                                    type="number"
                                    id="defaultTimeLimit"
                                    value="60"
                                    min="10"
                                    max="300"
                                    style="width: 100%; padding: 8px;"
                                >
                            </div>
                            <div>
                                <label for="defaultPoints" style="font-size: 13px; display: block; margin-bottom: 4px;">
                                    Points per Question
                                </label>
                                <input
                                    type="number"
                                    id="defaultPoints"
                                    value="10"
                                    min="1"
                                    max="100"
                                    style="width: 100%; padding: 8px;"
                                >
                            </div>
                        </div>

                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; user-select: none; margin-bottom: 8px;">
                            <input type="checkbox" id="defaultAwardParticipation" style="width: 20px; height: 20px; cursor: pointer;">
                            <span style="font-size: 13px;">
                                Award points for participation (even if answer is wrong)
                            </span>
                        </label>
                    </div>

                    <!-- Questions List -->
                    <div id="questionsList" style="margin-bottom: 20px;"></div>

                    <label for="questionText">Add Question</label>
                    <textarea id="questionText" rows="3" placeholder="Enter your question here..."></textarea>
                    <button type="button" class="btn btn-secondary" onclick="insertBlank()" style="margin-top: 8px; font-size: 0.9rem; padding: 0.5rem 1rem;">
                        Insert [blank] at cursor
                    </button>

                    <label style="margin-top: 16px;">Question Type</label>
                    <select id="questionType" onchange="updateQuestionOptions()">
                        <option value="mcq">Multiple Choice</option>
                        <option value="poll">Poll (No Correct Answer)</option>
                        <option value="tf">True/False</option>
                        <option value="matching">Matching</option>
                        <option value="ordering">Put in Order</option>
                        <option value="fillblank">Fill in the Blank</option>
                    </select>
                    
                    <!-- Multiple Choice Options -->
                    <div id="mcqOptions" style="margin-top: 16px;">
                        <label>Answer Options</label>
                        <div id="mcqOptionsContainer" class="radio-group" style="flex-direction: column; gap: 10px;">
                            <!-- Options will be added dynamically -->
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addMcqOption()">+ Add Option</button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="removeMcqOption()">- Remove Last</button>
                        </div>
                        <small style="color: var(--text-secondary); margin-top: 8px; display: block;">Select the radio button next to the correct answer</small>
                    </div>

                    <!-- Poll Options (No Correct Answer) -->
                    <div id="pollOptions" style="margin-top: 16px; display: none;">
                        <label>Poll Options</label>
                        <div id="pollOptionsContainer" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- Options will be added dynamically -->
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addPollOption()">+ Add Option</button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="removePollOption()">- Remove Last</button>
                        </div>
                        <div style="margin-top: 12px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; cursor: pointer;">
                                <input type="checkbox" id="pollParticipationPoints" style="width: auto; margin: 0;">
                                <span>Award points for participation (no wrong answer)</span>
                            </label>
                        </div>
                        <small style="color: var(--text-secondary); margin-top: 8px; display: block;">No correct answer - results will show distribution</small>
                    </div>

                    <!-- True/False Options -->
                    <div id="tfOptions" style="margin-top: 16px; display: none;">
                        <label>Correct Answer</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="tfAnswer" value="true" checked>
                                <label>True</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="tfAnswer" value="false">
                                <label>False</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Matching Options -->
                    <div id="matchingOptions" style="margin-top: 16px; display: none;">
                        <label>Matching Pairs</label>
                        <div id="matchingPairsContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 8px;">
                            <!-- Pairs will be added dynamically -->
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addMatchingPair()">+ Add Pair</button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="removeMatchingPair()">- Remove Last</button>
                        </div>
                    </div>
                    
                    <!-- Ordering Options -->
                    <div id="orderingOptions" style="margin-top: 16px; display: none;">
                        <label>Items in Correct Order</label>
                        <div id="orderingItemsContainer" style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                            <!-- Items will be added dynamically -->
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addOrderingItem()">+ Add Item</button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="removeOrderingItem()">- Remove Last</button>
                        </div>
                        <small style="color: var(--text-secondary); margin-top: 8px; display: block;">Enter items in the correct order</small>
                    </div>
                    
                    <!-- Fill in the Blank Options -->
                    <div id="fillblankOptions" style="margin-top: 16px; display: none;">
                        <label>Correct Answer(s)</label>
                        <input type="text" id="blankAnswer" placeholder="Enter the correct answer" style="margin-top: 8px;">
                        <small style="color: var(--text-secondary); margin-top: 8px; display: block;">Use [blank] in your question text where the answer should go</small>
                    </div>

                    <!-- Add Question Button -->
                    <div style="margin-top: 16px; display: flex; gap: 8px;">
                        <button type="button" id="addQuestionBtn" class="btn btn-primary" onclick="addQuickPollQuestion()">+ Add This Question</button>
                        <button type="button" id="cancelEditBtn" class="btn btn-secondary" onclick="cancelEdit()" style="display: none;">Cancel</button>
                    </div>
                </div>

                <div class="form-group" id="quizConfig" style="display: none;">
                    <label for="quizSelect">Select Quiz</label>
                    <select id="quizSelect">
                        <option value="">Loading quizzes...</option>
                    </select>
                    <div id="noQuizzesMessage" style="display: none; margin-top: 12px; padding: 12px; background-color: #FEF3C7; border: 1px solid #FDE68A; border-radius: 8px;">
                        <p style="margin: 0; color: #92400E; font-size: 14px;">
                            No quizzes available yet.
                            <a href="saved-questions.html" style="color: var(--primary-color); font-weight: 500;">Create your first quiz</a>
                        </p>
                    </div>
                </div>

                <div id="desktopInstructions" style="display: none;">
                    <div class="info-box">
                        <h3>Launch from Desktop App</h3>
                        <p>To use PowerPoint integration and advanced features:</p>
                        <ol style="margin-left: 20px; margin-top: 12px;">
                            <li>Open the IntellaClick desktop application</li>
                            <li>Select this class: <strong id="desktopClassName"></strong></li>
                            <li>Click "Start Session" in the desktop app</li>
                            <li>Students can join using code: <strong id="desktopJoinCode"></strong></li>
                        </ol>
                    </div>
                </div>

                <div class="form-group" id="sessionOptions" style="display: block;">
                    <label style="display: block; margin-bottom: 8px;">
                        <input type="checkbox" id="allowAnonymous">
                        Allow anonymous responses
                    </label>
                    <label style="display: block; margin-bottom: 8px;">
                        <input type="checkbox" id="openToAll">
                        Open to all (allow non-enrolled students)
                    </label>
                    <label style="display: block; margin-bottom: 8px;">
                        <input type="checkbox" id="allowAnswerChange">
                        Allow students to change their answer
                    </label>
                    <label style="display: block; margin-bottom: 8px;">
                        <input type="checkbox" id="showCorrectAnswer">
                        Show correct answer when question ends
                    </label>
                    <small style="color: var(--text-secondary); display: block; margin-top: 4px;">
                        By default, only enrolled students can join. Check "Open to all" to allow anyone with the code.
                    </small>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="cancelSession()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="startButton">Start Session</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast" class="toast"></div>

</body>
</html>