import{t as l}from"./toast-Cbd37M37.js";/* empty css               *//* empty css                       */import{q as k}from"./api-Cc5qfUA_.js";import{l as v}from"./logger-CXzo1yMG.js";import{g as L,a as S}from"./questionPreview-ChZvlnqt.js";const A=document.createElement("style");A.textContent=L();document.head.appendChild(A);let m=[],x=null,w=null,f=4,g=4,y=4,h=4;document.addEventListener("DOMContentLoaded",function(){J(),document.getElementById("quizForm").addEventListener("submit",_),I(4),q(4),B(4),b(4),$();const e=new URLSearchParams(window.location.search).get("id");e&&K(e)});function I(r){f=r;const e=document.getElementById("mcqOptionsContainer"),i={};let o=null;for(let t=0;t<26;t++){const n=String.fromCharCode(65+t),s=document.getElementById(`option${n}`),c=document.querySelector(`input[name="correctAnswer"][value="${n}"]`);s&&(i[n]=s.value),c&&c.checked&&(o=n)}e.innerHTML="";for(let t=0;t<r;t++){const n=String.fromCharCode(65+t),s=document.createElement("div");s.className="radio-option",s.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${n}" ${o===n||t===0&&!o?"checked":""}>
                    <input type="text" id="option${n}" placeholder="Option ${n}" value="${i[n]||""}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,e.appendChild(s)}}function q(r){g=r;const e=document.getElementById("pollOptionsContainer"),i={};for(let o=0;o<26;o++){const t=String.fromCharCode(65+o),n=document.getElementById(`pollOption${t}`);n&&(i[t]=n.value)}e.innerHTML="";for(let o=0;o<r;o++){const t=String.fromCharCode(65+o),n=document.createElement("input");n.type="text",n.id=`pollOption${t}`,n.placeholder=`Option ${t}`,n.value=i[t]||"",n.style.width="100%",e.appendChild(n)}}function F(){if(f>=26){l.error("Maximum 26 options allowed");return}f++,I(f)}function R(){if(f<=2){l.error("Minimum 2 options required");return}f--,I(f)}function H(){if(g>=26){l.error("Maximum 26 options allowed");return}g++,q(g)}function D(){if(g<=2){l.error("Minimum 2 options required");return}g--,q(g)}function B(r){y=r;const e=document.getElementById("matchingPairsContainer"),i={};for(let o=1;o<=10;o++){const t=document.getElementById(`match${o}Left`),n=document.getElementById(`match${o}Right`);t&&(i[`${o}Left`]=t.value),n&&(i[`${o}Right`]=n.value)}e.innerHTML="";for(let o=0;o<r;o++){const t=o+1,n=document.createElement("input");n.type="text",n.id=`match${t}Left`,n.placeholder=`Item ${t}`,n.value=i[`${t}Left`]||"",n.style.width="100%";const s=document.createElement("input");s.type="text",s.id=`match${t}Right`,s.placeholder=`Match ${t}`,s.value=i[`${t}Right`]||"",s.style.width="100%",e.appendChild(n),e.appendChild(s)}}function N(){if(y>=10){l.error("Maximum 10 pairs allowed");return}y++,B(y)}function V(){if(y<=2){l.error("Minimum 2 pairs required");return}y--,B(y)}function b(r){h=r;const e=document.getElementById("orderingItemsContainer"),i={};for(let o=1;o<=10;o++){const t=document.getElementById(`order${o}`);t&&(i[o]=t.value)}e.innerHTML="";for(let o=0;o<r;o++){const t=o+1,n=document.createElement("input");n.type="text",n.id=`order${t}`,n.placeholder=`${G(t)} item`,n.value=i[t]||"",n.style.width="100%",e.appendChild(n)}}function U(){if(h>=10){l.error("Maximum 10 items allowed");return}h++,b(h)}function j(){if(h<=2){l.error("Minimum 2 items required");return}h--,b(h)}function G(r){const e=["th","st","nd","rd"],i=r%100;return r+(e[(i-20)%10]||e[i]||e[0])}function J(){localStorage.getItem("token")||(window.location.href="login.html")}async function K(r){try{v.debug("Loading quiz for editing:",r);const e=await k.getById(r),i=e.quiz||e;x=r,document.getElementById("quizTitle").value=i.title||"",document.getElementById("quizDescription").value=i.description||"",document.querySelector(".header h1").textContent="Edit Quiz",document.getElementById("saveButton").textContent="Update Quiz",i.questions&&i.questions.length>0&&(m=i.questions.map(o=>{const t=o.questionSnapshot||{};return{questionText:t.questionText||"",questionType:t.questionType||"mcq",options:t.options||[],correctAnswer:t.correctAnswer,pairs:t.pairs,correctOrder:t.correctOrder,points:o.points||10}}),T()),l.success("Quiz loaded for editing")}catch(e){v.error("Error loading quiz:",e),l.error("Failed to load quiz: "+e.message)}}function $(){const r=document.getElementById("questionType").value;document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none";const e=document.getElementById("insertBlankBtn");switch(r==="fillblank"?e.style.display="block":e.style.display="none",r){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block",C();break}}function W(){const r=document.getElementById("questionType").value,e=document.getElementById("questionText").value.trim();if(!e){l.error("Please enter a question");return}let i={questionText:e,questionType:r,points:10};try{switch(r){case"mcq":const o=[];let t=null;for(let a=0;a<f;a++){const u=String.fromCharCode(65+a),d=document.getElementById(`option${u}`);if(d&&d.value.trim()){o.push(d.value.trim());const Q=document.querySelector(`input[name="correctAnswer"][value="${u}"]`);Q&&Q.checked&&(t=u)}}if(o.length<2){l.error("Please provide at least 2 answer options");return}i.options=o,i.correctAnswer=t;break;case"poll":const n=[];for(let a=0;a<g;a++){const u=String.fromCharCode(65+a),d=document.getElementById(`pollOption${u}`);d&&d.value.trim()&&n.push(d.value.trim())}if(n.length<2){l.error("Please provide at least 2 poll options");return}i.options=n;const s=document.getElementById("pollParticipationPoints").checked;i.awardParticipationPoints=s;break;case"tf":i.options=["True","False"],i.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const c=[];for(let a=1;a<=y;a++){const u=document.getElementById(`match${a}Left`).value.trim(),d=document.getElementById(`match${a}Right`).value.trim();u&&d&&c.push({left:u,right:d})}if(c.length<2){l.error("Please provide at least 2 matching pairs");return}i.pairs=c;break;case"ordering":const p=[];for(let a=1;a<=h;a++){const u=document.getElementById(`order${a}`).value.trim();u&&p.push(u)}if(p.length<2){l.error("Please provide at least 2 items to order");return}i.correctOrder=p;break;case"fillblank":const O=(e.match(/\[blank\]/gi)||[]).length;if(O===0){l.error("Please include at least one [blank] in your question");return}const E=[];for(let a=1;a<=O;a++){const u=document.getElementById(`blankAnswer${a}`),d=u?u.value.trim():"";if(!d){l.error(`Please provide answer for blank ${a}`);return}E.push(d)}i.correctAnswer=E.length===1?E[0]:E;break}if(w!==null){m[w]=i,l.success("Question updated successfully!"),w=null;const o=document.querySelector('button[onclick="addQuestion()"]');o&&(o.textContent="+ Add This Question",o.className="btn btn-primary")}else m.push(i),l.success("Question added successfully!");z(),T()}catch(o){v.error("Error adding question:",o),l.error("Error adding question: "+o.message)}}function z(){document.getElementById("questionText").value="";for(let e=0;e<f;e++){const i=String.fromCharCode(65+e),o=document.getElementById(`option${i}`);o&&(o.value="")}for(let e=0;e<g;e++){const i=String.fromCharCode(65+e),o=document.getElementById(`pollOption${i}`);o&&(o.value="")}for(let e=1;e<=y;e++){const i=document.getElementById(`match${e}Left`),o=document.getElementById(`match${e}Right`);i&&(i.value=""),o&&(o.value="")}for(let e=1;e<=h;e++){const i=document.getElementById(`order${e}`);i&&(i.value="")}const r=document.getElementById("blankAnswer");r&&(r.value="")}function X(r){const e=m[r];switch(w=r,document.getElementById("questionText").value=e.questionText,document.getElementById("questionType").value=e.questionType,$(),e.questionType){case"mcq":if(e.options&&(I(e.options.length),e.options.forEach((t,n)=>{const s=String.fromCharCode(65+n),c=document.getElementById(`option${s}`);c&&(c.value=t)}),e.correctAnswer)){const t=document.querySelector(`input[name="correctAnswer"][value="${e.correctAnswer}"]`);t&&(t.checked=!0)}break;case"poll":e.options&&(q(e.options.length),e.options.forEach((t,n)=>{const s=String.fromCharCode(65+n),c=document.getElementById(`pollOption${s}`);c&&(c.value=t)}));break;case"tf":if(e.correctAnswer){const t=document.querySelector(`input[name="tfAnswer"][value="${e.correctAnswer}"]`);t&&(t.checked=!0)}break;case"matching":e.pairs&&(B(e.pairs.length),e.pairs.forEach((t,n)=>{const s=n+1,c=document.getElementById(`match${s}Left`),p=document.getElementById(`match${s}Right`);c&&(c.value=t.left),p&&(p.value=t.right)}));break;case"ordering":e.correctOrder&&(b(e.correctOrder.length),e.correctOrder.forEach((t,n)=>{const s=document.getElementById(`order${n+1}`);s&&(s.value=t)}));break;case"fillblank":setTimeout(()=>{(Array.isArray(e.correctAnswer)?e.correctAnswer:[e.correctAnswer]).forEach((n,s)=>{const c=document.getElementById(`blankAnswer${s+1}`);c&&(c.value=n)})},50);break}const i=document.querySelector('button[onclick="addQuestion()"]');i&&(i.textContent="Update Question",i.className="btn btn-success");const o=document.getElementById("cancelEditBtn");o&&(o.style.display="inline-block"),document.getElementById("questionText").scrollIntoView({behavior:"smooth",block:"center"}),l.success("Question loaded for editing")}function Y(r){window.confirm("Remove this question?")&&(m.splice(r,1),T(),w===r&&P(),l.success("Question removed"))}function P(){w=null,z();const r=document.querySelector('button[onclick="addQuestion()"]');r&&(r.textContent="+ Add This Question",r.className="btn btn-primary");const e=document.getElementById("cancelEditBtn");e&&(e.style.display="none"),l.success("Edit cancelled")}function T(){const r=document.getElementById("questionsList");if(m.length===0){r.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}r.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${m.length} Question(s) Added:</strong>
                </div>
                ${m.map((e,i)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${i+1}: ${e.questionText}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${Z(e.questionType)}</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="editQuestion(${i})">Edit</button>
                            <button type="button" class="btn btn-danger btn-small" onclick="removeQuestion(${i})">Remove</button>
                        </div>
                    </div>
                `).join("")}
            `}function Z(r){return{mcq:"Multiple Choice",poll:"Poll",tf:"True/False",matching:"Matching",ordering:"Put in Order",fillblank:"Fill in the Blank"}[r]||r.toUpperCase()}async function _(r){r.preventDefault();const e=document.getElementById("quizTitle").value.trim(),i=document.getElementById("quizDescription").value.trim();if(!e){l.error("Please enter a quiz title");return}if(m.length===0){l.error("Please add at least one question to the quiz");return}const o=m.map(n=>({questionSnapshot:{questionText:n.questionText,questionType:n.questionType,options:n.options,correctAnswer:n.correctAnswer,pairs:n.pairs,correctOrder:n.correctOrder},points:n.points||10})),t={title:e,description:i,type:"standard",questions:o,questionCount:o.length,settings:{shuffleQuestions:!1,shuffleAnswers:!1,showCorrectAnswers:!0}};try{document.getElementById("saveButton").disabled=!0,document.getElementById("saveButton").textContent="Saving...";let n;x?(n=await k.update(x,t),v.debug("Quiz updated:",n),l.success("Quiz updated successfully!")):(n=await k.create(t),v.debug("Quiz created:",n),l.success("Quiz saved successfully!")),setTimeout(()=>{window.location.href="quizzes.html"},1e3)}catch(n){v.error("Error saving quiz:",n),l.error("Failed to save quiz: "+n.message),document.getElementById("saveButton").disabled=!1,document.getElementById("saveButton").textContent="Save Quiz"}}function ee(){m.length>0?window.confirm("Are you sure you want to cancel? All unsaved changes will be lost.")&&(window.location.href="quizzes.html"):window.location.href="quizzes.html"}function te(){const r=document.getElementById("questionText"),e=r.selectionStart,i=r.selectionEnd,o=r.value,t=o.substring(0,e)+"[blank]"+o.substring(i);r.value=t,r.selectionStart=r.selectionEnd=e+7,r.focus(),document.getElementById("questionType").value==="fillblank"&&C()}function C(){const e=(document.getElementById("questionText").value.match(/\[blank\]/gi)||[]).length,i=document.getElementById("blankAnswersContainer");if(i.innerHTML="",e===0){i.innerHTML='<small style="color: var(--text-secondary);">No blanks found. Click "Insert [blank]" button to add blanks to your question.</small>';return}for(let o=0;o<e;o++){const t=document.createElement("input");t.type="text",t.id=`blankAnswer${o+1}`,t.placeholder=`Answer for blank ${o+1}`,t.style.marginTop="0",i.appendChild(t)}}function ne(){const r=document.getElementById("questionText").value.trim();if(!r){l.error("Please enter question text first");return}const e=document.getElementById("questionType").value;let i={text:r,type:e,timeLimit:60,points:10};if(e==="mcq"||e==="poll"){const t=[];for(let n=0;n<(e==="mcq"?f:g);n++){const s=String.fromCharCode(65+n),c=document.getElementById(e==="mcq"?`option${s}`:`pollOption${s}`);c&&c.value.trim()&&t.push(c.value.trim())}i.options=t}else if(e==="matching"){const t=[],n=[];for(let s=1;s<=y;s++){const c=document.getElementById(`match${s}Left`),p=document.getElementById(`match${s}Right`);c&&c.value.trim()&&t.push(c.value.trim()),p&&p.value.trim()&&n.push(p.value.trim())}i.matching={items:t,matches:n}}else if(e==="ordering"){const t=[];for(let n=1;n<=h;n++){const s=document.getElementById(`order${n}`);s&&s.value.trim()&&t.push(s.value.trim())}i.ordering=t}const o=S(i);document.getElementById("questionPreviewBody").innerHTML=o,document.getElementById("questionPreviewModal").classList.add("active")}function M(){document.getElementById("questionPreviewModal").classList.remove("active")}document.addEventListener("keydown",r=>{if(r.key==="Escape"){const e=document.getElementById("questionPreviewModal");e&&e.classList.contains("active")&&M()}});window.updateQuestionOptions=$;window.addQuestion=W;window.editQuestion=X;window.removeQuestion=Y;window.cancelEditQuestion=P;window.cancelQuiz=ee;window.insertBlank=te;window.updateBlankAnswerFields=C;window.addMcqOption=F;window.removeMcqOption=R;window.addPollOption=H;window.removePollOption=D;window.addMatchingPair=N;window.removeMatchingPair=V;window.addOrderingItem=U;window.removeOrderingItem=j;window.previewQuestion=ne;window.closePreviewModal=M;
