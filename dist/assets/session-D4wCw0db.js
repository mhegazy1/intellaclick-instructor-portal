import{t as p}from"./toast-Cbd37M37.js";/* empty css               */import{l as h}from"./logger-CXzo1yMG.js";let v,b,f,G,y=[],w=-1,N,R=null,B={defaultTimeLimit:60,defaultPoints:10,defaultAwardParticipation:!1,defaultShowCorrectAnswer:!0,defaultAllowAnswerChange:!0};document.addEventListener("DOMContentLoaded",function(){const t=new URLSearchParams(window.location.search);if(v=t.get("id"),b=t.get("code"),t.get("type"),!v||!b){p.error("Invalid session parameters"),setTimeout(()=>window.location.href="classes.html",2e3);return}const e=sessionStorage.getItem("pendingQuestions");if(e){const o=JSON.parse(e);y.push(...o),sessionStorage.removeItem("pendingQuestions"),sessionStorage.removeItem("currentQuestionIndex"),S()}else{const o=sessionStorage.getItem("pendingQuestion");if(o){const i=JSON.parse(o);y.push(i),sessionStorage.removeItem("pendingQuestion"),S()}}if(y.length===0){const o=sessionStorage.getItem("questionQueue_"+b),i=sessionStorage.getItem("questionIndex_"+b);o&&(console.log("[Session] Restoring queue from sessionStorage"),y=JSON.parse(o),w=i?parseInt(i):-1,S())}y.length===0&&(console.log("[Session] Attempting to restore queue from backend"),V()),W(),P(),K(),ce()});function W(){localStorage.getItem("token")||(window.location.href="/login.html")}async function P(){try{const t=await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${b}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load session");f=(await t.json()).session,G=f.classId,h.debug("Session loaded:",{sessionId:v,sessionCode:b,sessionData:f,hasCurrentQuestion:!!f.currentQuestion}),X()}catch(t){h.error("Error loading session:",t),p.error("Failed to load session")}}async function V(){try{const t=await fetch(`https://api-modular.intellaclick.com/api/sessions/${v}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok){console.error("[Session] Failed to fetch session data for queue restoration");return}const e=await t.json();e.success&&e.session.questionQueue&&e.session.questionQueue.length>0?(y=e.session.questionQueue,w=e.session.currentQuestionIndex??-1,console.log("[Session] Queue restored from backend:",{queueLength:y.length,currentIndex:w}),S(),p.success(`Restored ${y.length} questions from previous session`)):console.log("[Session] No saved queue found in backend")}catch(t){console.error("[Session] Error restoring queue from backend:",t)}}async function z(){try{if(!(await fetch(`https://api-modular.intellaclick.com/api/sessions/${v}/question-queue`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({questionQueue:y,currentQuestionIndex:w})})).ok){console.error("[Session] Failed to save queue to backend");return}console.log("[Session] Queue saved to backend successfully")}catch(t){console.error("[Session] Error saving queue to backend:",t)}}async function K(){try{const t=await fetch("https://api-modular.intellaclick.com/api/users/question-defaults",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});t.ok?(B=(await t.json()).defaults||B,document.getElementById("modalTimeLimit").value=B.defaultTimeLimit,document.getElementById("modalPoints").value=B.defaultPoints,document.getElementById("modalAwardParticipation").checked=B.defaultAwardParticipation,h.debug("âœ… Loaded question defaults:",B)):h.debug("No saved question defaults found, using system defaults")}catch(t){h.error("Error loading question defaults:",t)}}function X(){document.getElementById("sessionCode").textContent=f.sessionCode,document.getElementById("participantCount").textContent=f.participantCount||0;const t=`https://join.intellaclick.com/session/${f.sessionCode}`;document.getElementById("joinUrl").innerHTML=`
                <strong>Students can join at:</strong><br>
                <div style="display: flex; align-items: center; gap: 12px; margin: 8px 0;">
                    <span style="font-size: 16px; user-select: all; flex: 1;">${t}</span>
                    <button class="btn btn-secondary" onclick="copyJoinUrl('${t}')" style="padding: 6px 12px; font-size: 12px;">
                        Copy Link
                    </button>
                </div>
                <small style="color: var(--text-secondary); margin-top: 4px; display: block;">
                    Session ID: ${f.id||f._id}<br>
                    ${f.restrictToEnrolled===!1?"Open to all students":"Restricted to enrolled students only"}
                </small>
            `,Z(t);const e=document.getElementById("sessionStatus");e.textContent=f.status.charAt(0).toUpperCase()+f.status.slice(1),e.className=`status-badge status-${f.status}`,f.status==="active"&&f.currentQuestion&&(document.getElementById("stopBtn").disabled=!1,document.getElementById("resultsBtn").disabled=!1,j(f.currentQuestion)),Y()}function Y(){const t=document.getElementById("participantsList");fetch(`https://api-modular.intellaclick.com/api/sessions/${v}/participants`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>e.json()).then(e=>{e.participants&&e.participants.length>0?(t.innerHTML="",e.participants.forEach(o=>{const i=document.createElement("div");i.className="participant-card",i.innerHTML=`
                            <strong>${o.name||"Anonymous"}</strong><br>
                            <small style="color: var(--text-secondary);">
                                Joined: ${new Date(o.joinedAt).toLocaleTimeString()}<br>
                                ${o.isEnrolled?"Enrolled Student":"Guest"}
                            </small>
                        `,t.appendChild(i)})):t.innerHTML='<p style="color: var(--text-secondary);">No participants yet. Share the session code for students to join.</p>'}).catch(e=>{h.error("Error loading participants:",e)})}function Z(t){const e=document.getElementById("qrcode");e.innerHTML="";const o=document.createElement("canvas");QRCode.toCanvas(o,t,{width:400,margin:2,color:{dark:"#000000",light:"#FFFFFF"}},function(i){if(i){h.error("QR Code generation error:",i),e.innerHTML='<p style="color: var(--text-secondary);">QR Code generation failed</p>';return}o.style.width="200px",o.style.height="200px",e.appendChild(o)})}function S(){const t=document.getElementById("queueList");sessionStorage.setItem("questionQueue_"+b,JSON.stringify(y)),sessionStorage.setItem("questionIndex_"+b,w.toString()),z(),y.length===0?(t.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions in queue. Create a new question or import from a quiz.</p>',document.getElementById("sendBtn").disabled=!0):(t.innerHTML="",y.forEach((e,o)=>{const i=document.createElement("div");i.className="question-item",i.style.padding="12px",i.style.marginBottom="8px",i.style.border="1px solid var(--border-color)",i.style.borderRadius="6px",i.style.backgroundColor="var(--bg-primary)";const n=document.createElement("div");n.style.display="flex",n.style.alignItems="flex-start",n.style.marginBottom="10px";const s=document.createElement("div");s.style.fontWeight="bold",s.style.marginRight="8px",s.style.minWidth="24px",s.style.color="var(--text-secondary)",s.textContent=`${o+1}.`;const u=document.createElement("div");if(u.style.flex="1",u.style.lineHeight="1.4",u.textContent=e.text||e.questionText,n.appendChild(s),n.appendChild(u),o>w){const c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-between",c.style.alignItems="center",c.style.paddingTop="10px",c.style.borderTop="1px solid var(--border-color)";const r=document.createElement("div");r.style.display="grid",r.style.gridTemplateColumns="auto auto auto",r.style.gap="12px 20px",r.style.alignItems="center",r.style.fontSize="13px";const a=document.createElement("span");a.style.color="var(--text-secondary)",a.style.textAlign="right",a.style.minWidth="50px",a.textContent="Time:";const m=document.createElement("input");m.type="number",m.value=e.timeLimit||60,m.min=10,m.max=300,m.style.width="60px",m.style.padding="4px 8px",m.style.border="1px solid var(--border-color)",m.style.borderRadius="4px",m.style.fontSize="13px";const x=()=>{const M=parseInt(m.value)||60;e.timeLimit=M,console.log(`âœï¸ Updated question ${o+1} time limit:`,M,"Full question:",e),sessionStorage.setItem("questionQueue_"+b,JSON.stringify(y)),z()};m.onchange=x,m.onblur=x;const E=document.createElement("span");E.style.color="var(--text-secondary)",E.textContent="sec";const C=document.createElement("span");C.style.color="var(--text-secondary)",C.style.textAlign="right",C.style.minWidth="50px",C.textContent="Points:";const d=document.createElement("input");d.type="number",d.value=e.points||10,d.min=1,d.max=100,d.style.width="60px",d.style.padding="4px 8px",d.style.border="1px solid var(--border-color)",d.style.borderRadius="4px",d.style.fontSize="13px";const l=()=>{const M=parseInt(d.value)||10;e.points=M,console.log(`âœï¸ Updated question ${o+1} points:`,M,"Full question:",e),sessionStorage.setItem("questionQueue_"+b,JSON.stringify(y)),z()};d.onchange=l,d.onblur=l;const g=document.createElement("span");g.style.color="var(--text-secondary)",g.textContent="pts";const q=document.createElement("span");q.style.color="var(--text-secondary)",q.style.textAlign="right",q.style.minWidth="50px",q.textContent="Award:";const Q=document.createElement("div");Q.style.width="60px",Q.style.display="flex",Q.style.alignItems="center",Q.style.paddingLeft="4px";const I=document.createElement("input");I.type="checkbox",I.checked=e.awardParticipationPoints||!1,I.style.cursor="pointer",I.style.width="16px",I.style.height="16px",I.style.margin="0",I.onchange=()=>{e.awardParticipationPoints=I.checked,console.log(`âœï¸ Updated question ${o+1} awardParticipationPoints:`,I.checked,"Full question:",e),sessionStorage.setItem("questionQueue_"+b,JSON.stringify(y)),z()},Q.appendChild(I);const H=document.createElement("span");H.textContent="Participation points",r.appendChild(a),r.appendChild(m),r.appendChild(E),r.appendChild(C),r.appendChild(d),r.appendChild(g),r.appendChild(q),r.appendChild(Q),r.appendChild(H);const O=document.createElement("div");O.style.display="flex",O.style.gap="6px",O.style.flexShrink="0";const T=document.createElement("button");T.className="btn btn-secondary",T.style.padding="6px 10px",T.style.fontSize="12px",T.style.minWidth="32px",T.innerHTML="â†‘",T.title="Move up",o>w+1?T.onclick=()=>U(o,-1):(T.disabled=!0,T.style.opacity="0.3",T.style.cursor="not-allowed"),O.appendChild(T);const k=document.createElement("button");k.className="btn btn-secondary",k.style.padding="6px 10px",k.style.fontSize="12px",k.style.minWidth="32px",k.innerHTML="â†“",k.title="Move down",o<y.length-1?k.onclick=()=>U(o,1):(k.disabled=!0,k.style.opacity="0.3",k.style.cursor="not-allowed"),O.appendChild(k);const A=document.createElement("button");A.className="btn btn-secondary",A.style.padding="6px 12px",A.style.fontSize="12px",A.textContent="Edit",A.onclick=()=>te(o),O.appendChild(A);const L=document.createElement("button");L.className="btn btn-secondary",L.style.padding="6px 12px",L.style.fontSize="12px",L.textContent="Remove",L.onclick=()=>ee(o),O.appendChild(L),c.appendChild(r),c.appendChild(O),i.appendChild(n),i.appendChild(c)}else i.appendChild(n),i.style.opacity="0.6",i.style.backgroundColor="var(--bg-secondary)";t.appendChild(i)}),document.getElementById("sendBtn").disabled=!1)}function ee(t){y.splice(t,1),S()}function U(t,e){const o=t+e;if(o<=w||o>=y.length)return;const i=y[t];y[t]=y[o],y[o]=i,S(),p.success("Question moved")}let $=null;function te(t){$=t;const e=y[t];document.getElementById("questionModal").style.display="block";const o=!e.correctAnswer&&e.correctAnswer!==0&&e.correctAnswer!==!1,i=o?"poll":e.type||e.questionType||"mcq";h.debug("Editing question:",{type:i,isPoll:o,correctAnswer:e.correctAnswer,options:e.options||e.optionTexts}),document.getElementById("modalQuestionType").value=i,document.getElementById("modalQuestionText").value=e.text||e.questionText||"",document.getElementById("modalTimeLimit").value=e.timeLimit||60,document.getElementById("modalPoints").value=e.points||10,document.getElementById("modalAwardParticipation").checked=e.awardParticipationPoints||!1,setTimeout(()=>F(),10),setTimeout(()=>{switch(i){case"poll":if(e.options||e.optionTexts){const r=e.optionTexts||e.options;["A","B","C","D"].forEach((a,m)=>{const x=document.getElementById(`modalOption${a}`);x&&r[m]&&(x.value=r[m])})}break;case"mcq":if(e.optionTexts||e.options){const r=e.optionTexts||e.options;["A","B","C","D"].forEach((a,m)=>{const x=document.getElementById(`modalOption${a}`);if(x&&r[m]&&(x.value=r[m]),e.correctAnswer===a||e.correctAnswer===m){const E=document.querySelector(`input[name="modalCorrect"][value="${a}"]`);E&&(E.checked=!0)}})}break;case"tf":const s=e.correctAnswer==="true"||e.correctAnswer===!0?"true":"false",u=document.querySelector(`input[name="modalTF"][value="${s}"]`);u&&(u.checked=!0);break;case"matching":e.pairs&&e.pairs.forEach((r,a)=>{const m=document.getElementById(`modalMatch${a+1}Left`),x=document.getElementById(`modalMatch${a+1}Right`);m&&(m.value=r.left||""),x&&(x.value=r.right||"")});break;case"ordering":e.correctOrder&&e.correctOrder.forEach((r,a)=>{const m=document.getElementById(`modalOrder${a+1}`);m&&(m.value=r||"")});break;case"fillblank":const c=document.getElementById("modalBlankAnswer");c&&(c.value=e.correctAnswer||"");break}},100);const n=document.querySelector("#questionModal h2");n&&(n.textContent="Edit Question")}async function oe(){if(console.log("ðŸš€ SEND NEXT QUESTION CALLED:",{currentIndex:w,queueLength:y.length,willPassCheck:w+1<y.length,nextQuestion:y[w+1]}),w+1>=y.length){p.error("No more questions in queue");return}w++,sessionStorage.setItem("questionIndex_"+b,w.toString());const t=y[w];console.log("ðŸ” QUESTION FROM QUEUE (before normalization):",{index:w,timeLimit:t.timeLimit,points:t.points,awardParticipationPoints:t.awardParticipationPoints,fullQuestion:t});const e={...t};console.log("ðŸ” NORMALIZED QUESTION (after spread):",{timeLimit:e.timeLimit,points:e.points,awardParticipationPoints:e.awardParticipationPoints,fullQuestion:e}),delete e.type;const i={mcq:"multiple_choice",tf:"boolean",matching:"matching",ordering:"ordering",fillblank:"fill_blank"}[t.type]||t.type;if(e.questionType=i,e.type=i,e.questionText=t.text||t.questionText,t.type==="tf")e.options=["True","False"];else if(t.type==="mcq")t.optionTexts&&(e.options=t.options,e.optionTexts=t.optionTexts);else if(t.type==="matching"){e.pairs=t.pairs||[];const n=e.pairs.map(u=>u.right),s=n.sort(()=>Math.random()-.5);e.shuffledMatchingRight=s,console.log("ðŸŽ² MATCHING SHUFFLE DEBUG:",{originalPairs:e.pairs,originalRight:n,shuffledRight:s})}else if(t.type==="ordering"){e.correctOrder=t.correctOrder||[];const n=[...e.correctOrder].sort(()=>Math.random()-.5);e.shuffledOrderingItems=n,console.log("ðŸŽ² ORDERING SHUFFLE DEBUG:",{originalOrder:e.correctOrder,shuffledItems:n})}else t.type==="fillblank"&&(e.correctAnswer=t.correctAnswer||"");console.log("ðŸ“¤ SENDING QUESTION TO BACKEND:",{sessionId:v,questionType:e.questionType,type:e.type,timeLimit:e.timeLimit,points:e.points,awardParticipationPoints:e.awardParticipationPoints,shuffledMatchingRight:e.shuffledMatchingRight,shuffledOrderingItems:e.shuffledOrderingItems,fullQuestion:e}),h.debug("Sending question:",{sessionId:v,endpoint:`https://api-modular.intellaclick.com/api/sessions/${v}/questions`,questionData:e,hasQuestionText:!!e.questionText,questionType:e.questionType}),console.log("ðŸŒ MAKING FETCH REQUEST:",{url:`https://api-modular.intellaclick.com/api/sessions/${v}/questions`,method:"POST",timeLimit:e.timeLimit,points:e.points});try{const n=await fetch(`https://api-modular.intellaclick.com/api/sessions/${v}/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(e)});if(console.log("ðŸ“¡ FETCH RESPONSE:",{status:n.status,ok:n.ok}),!n.ok){const u=await n.json();throw console.log("âŒ FETCH ERROR:",u),h.error("API Error:",{status:n.status,error:u}),new Error(u.error||"Failed to send question")}const s=await n.json();console.log("âœ… FETCH SUCCESS:",s),h.debug("Question sent successfully:",s),p.success("Question sent successfully!"),document.getElementById("stopBtn").disabled=!1,document.getElementById("resultsBtn").disabled=!1,j(t),S(),setTimeout(async()=>{await P()},500)}catch(n){h.error("Error sending question:",n),n.name==="TypeError"&&n.message==="Failed to fetch"?(p.error("Network error: Unable to reach the API server. This may be a CORS issue."),h.error("CORS Error Details:",{error:n,message:"The API server may need to add instructor.intellaclick.com to its allowed origins",currentOrigin:window.location.origin,apiUrl:"https://api-modular.intellaclick.com"}),window.confirm(`Network error detected. This is likely a CORS configuration issue.

The backend needs to add instructor.intellaclick.com to its allowed origins.

Click OK to open the CORS test page for more details.`)&&window.open("/cors-test.html","_blank")):p.error(n.message||"Failed to send question"),w--}}function j(t){document.getElementById("currentQuestionSection").style.display="block";const e=t.type||t.questionType,o=t.text||t.questionText||"";h.debug("ðŸ“º DISPLAYING QUESTION IN SESSION CONTROL:",{questionType:e,questionText:o,hasPairs:!!t.pairs,pairs:t.pairs,hasCorrectOrder:!!t.correctOrder,correctOrder:t.correctOrder,fullQuestion:t});let i=o;(e==="fillblank"||e==="fill_blank")&&(i=i.replace(/\[blank\]/gi,'<span style="display: inline-block; min-width: 100px; border-bottom: 2px solid #4F46E5; margin: 0 6px; height: 1.2em; vertical-align: bottom;"></span>')),document.getElementById("questionText").innerHTML=i;const n=document.getElementById("questionOptions");if(n.innerHTML="",(e==="mcq"||e==="multiple_choice")&&(t.optionTexts||t.options)){const s=t.optionTexts||t.options;(t.options&&t.optionTexts?t.options:["A","B","C","D"]).forEach((c,r)=>{if(s[r]){const a=document.createElement("div");a.style.marginTop="8px",a.textContent=`${c}: ${s[r]}`,n.appendChild(a)}})}else if(e==="tf"||e==="boolean")n.innerHTML='<div style="margin-top: 8px;">A: True</div><div style="margin-top: 8px;">B: False</div>';else if(e==="matching"&&t.pairs){if(n.innerHTML="<strong>Match the following:</strong>",t.pairs.forEach((s,u)=>{const c=document.createElement("div");c.style.marginTop="8px",c.textContent=`${u+1}. ${s.left} â†’ ?`,n.appendChild(c)}),t.shuffledMatchingRight){const s=document.createElement("div");s.style.marginTop="12px",s.innerHTML="<strong>Options to match:</strong>",t.shuffledMatchingRight.forEach((u,c)=>{const r=document.createElement("div");r.style.marginTop="4px",r.textContent=`${String.fromCharCode(65+c)}. ${u}`,s.appendChild(r)}),n.appendChild(s)}}else(e==="ordering"||e==="ordering")&&t.correctOrder&&(n.innerHTML="<strong>Put in correct order:</strong>",(t.shuffledOrderingItems||t.correctOrder).forEach((u,c)=>{const r=document.createElement("div");r.style.marginTop="8px",r.textContent=`${String.fromCharCode(65+c)}. ${u}`,n.appendChild(r)}))}function ne(){document.getElementById("questionModal").style.display="block",F()}function _(){document.getElementById("questionModal").style.display="none",document.getElementById("modalQuestionText").value="",document.getElementById("modalQuestionType").value="mcq",$=null;const t=document.querySelector("#questionModal h2");t&&(t.textContent="Create Question")}function ie(){document.getElementById("importModal").style.display="block",ye()}function D(){document.getElementById("importModal").style.display="none",R=null}function F(){const t=document.getElementById("modalQuestionType").value,e=document.getElementById("modalQuestionOptions");switch(t){case"poll":e.innerHTML=`
                        <label>Poll Options (no correct answer - all answers award participation points)</label>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionA" placeholder="Option A" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionB" placeholder="Option B" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionC" placeholder="Option C" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionD" placeholder="Option D" style="width: 100%;">
                        </div>
                        <small style="display: block; margin-top: 8px; color: var(--text-secondary);">
                            ðŸ’¡ Poll questions have no correct answer. All students who answer receive participation points.
                        </small>
                    `;break;case"mcq":e.innerHTML=`
                        <label>Answer Options (select correct answer)</label>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="A" checked>
                            <input type="text" id="modalOptionA" placeholder="Option A" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="B">
                            <input type="text" id="modalOptionB" placeholder="Option B" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="C">
                            <input type="text" id="modalOptionC" placeholder="Option C" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="D">
                            <input type="text" id="modalOptionD" placeholder="Option D" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                    `;break;case"tf":e.innerHTML=`
                        <label>Correct Answer</label>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalTF" value="true" checked> True
                            <input type="radio" name="modalTF" value="false" style="margin-left: 20px;"> False
                        </div>
                    `;break;case"matching":e.innerHTML=`
                        <label>Matching Pairs</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
                            <input type="text" placeholder="Item 1" id="modalMatch1Left">
                            <input type="text" placeholder="Match 1" id="modalMatch1Right">
                            <input type="text" placeholder="Item 2" id="modalMatch2Left">
                            <input type="text" placeholder="Match 2" id="modalMatch2Right">
                            <input type="text" placeholder="Item 3" id="modalMatch3Left">
                            <input type="text" placeholder="Match 3" id="modalMatch3Right">
                        </div>
                    `;break;case"ordering":e.innerHTML=`
                        <label>Items in Correct Order</label>
                        <div style="margin-top: 8px;">
                            <input type="text" placeholder="1st item" id="modalOrder1" style="margin-bottom: 8px;">
                            <input type="text" placeholder="2nd item" id="modalOrder2" style="margin-bottom: 8px;">
                            <input type="text" placeholder="3rd item" id="modalOrder3" style="margin-bottom: 8px;">
                            <input type="text" placeholder="4th item" id="modalOrder4">
                        </div>
                    `;break;case"fillblank":e.innerHTML=`
                        <label>Correct Answer</label>
                        <input type="text" id="modalBlankAnswer" placeholder="Enter the correct answer" style="margin-top: 8px;">
                        <small style="display: block; margin-top: 8px; color: var(--text-secondary);">Use [blank] in your question where the answer should go</small>
                    `;break}}async function se(){var t;try{const e=((t=f.currentQuestion)==null?void 0:t.questionId)||"current";if(!(await fetch(`https://api-modular.intellaclick.com/api/sessions/${v}/questions/${e}/end`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to stop question");p.success("Question stopped"),document.getElementById("currentQuestionSection").style.display="none",await P()}catch(e){h.error("Error stopping question:",e),p.error("Failed to stop question")}}async function re(){var t,e;try{const i=await(await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${b}/responses`)).json();if(!i.success){p.error("Failed to load results");return}const s=await(await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${b}`)).json();console.log("ðŸ“Š Results data:",{responses:i.responses,responsesByQuestion:i.responsesByQuestion,sessionQuestions:(t=s.session)==null?void 0:t.questions,currentQuestion:(e=s.session)==null?void 0:e.currentQuestion}),document.getElementById("responsesSection").style.display="block",ae(i.responses,i.responsesByQuestion,s.session),document.getElementById("responsesSection").scrollIntoView({behavior:"smooth"})}catch(o){console.error("Error fetching results:",o),p.error("Failed to load results")}}function ae(t,e,o){var s,u;const i=document.getElementById("responseChart");if(!t||t.length===0){i.innerHTML='<p style="color: var(--text-secondary); text-align: center; padding: 40px;">No responses yet</p>';return}let n="<h3>Session Results Summary</h3>";n+=`<p style="margin-bottom: 20px; color: var(--text-secondary);">Total Responses: ${t.length}</p>`,n+='<div style="padding-bottom: 20px;">';for(const[c,r]of Object.entries(e)){let a=(s=o==null?void 0:o.questions)==null?void 0:s.find(l=>{var g;return((g=l._id)==null?void 0:g.toString())===c||l.questionId===c||l.id===c});if(!a&&(o!=null&&o.questionQueue)&&(a=o.questionQueue.find(l=>{var g;return((g=l._id)==null?void 0:g.toString())===c||l.questionId===c||l.id===c})),!a&&(o!=null&&o.currentQuestion)){const l=o.currentQuestion;(((u=l._id)==null?void 0:u.toString())===c||l.questionId===c||l.id===c)&&(a=l)}if(!a&&r.length>0){const l=t.find(g=>g.questionId===c);l&&(a=l.questionData||l.question||l.questionDetails)}console.log("ðŸ” Question lookup:",{questionId:c,questionsArray:o==null?void 0:o.questions,questionQueue:o==null?void 0:o.questionQueue,foundQuestion:a,firstResponse:r[0],fullResponse:t.find(l=>l.questionId===c)});const m=(a==null?void 0:a.text)||(a==null?void 0:a.questionText)||"Question text not found",x=(a==null?void 0:a.type)||(a==null?void 0:a.questionType)||"unknown",E=(a==null?void 0:a.options)||[],C=a==null?void 0:a.correctAnswer;n+=`
                    <div style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="margin-bottom: 16px; word-wrap: break-word;">${m}</h4>
                        <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                            ${r.length} response${r.length!==1?"s":""}
                        </p>
                `;const d={};r.forEach(l=>{const g=l.answer;d[g]=(d[g]||0)+1}),console.log("ðŸ“Š Answer counting:",{questionId:c,questionResponses:r,answerCounts:d,options:E,questionType:x}),(x==="multiple_choice"||x==="mcq")&&(n+='<div style="margin-bottom: 20px;">',E.forEach((l,g)=>{const q=d[g]||0,Q=Math.round(q/r.length*100)||0,I=C===g;n+=`
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <span style="font-weight: 500;">
                                        ${l} ${I?'<span style="color: var(--secondary-color);">âœ“ Correct</span>':""}
                                    </span>
                                    <span style="color: var(--text-secondary);">${q} (${Q}%)</span>
                                </div>
                                <div style="background: #E5E7EB; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: ${I?"var(--secondary-color)":"var(--primary-color)"}; height: 100%; width: ${Q}%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        `}),n+="</div>"),n+='<details style="margin-top: 16px;">',n+='<summary style="cursor: pointer; color: var(--primary-color); font-weight: 500;">View individual responses</summary>',n+='<div style="margin-top: 12px; max-height: 300px; overflow-y: auto;">',n+='<table style="width: 100%; border-collapse: collapse;">',n+='<tr style="background: #F9FAFB;"><th style="text-align: left; padding: 8px;">Student</th><th style="text-align: left; padding: 8px;">Answer</th><th style="text-align: left; padding: 8px;">Time</th></tr>',r.forEach(l=>{const g=(x==="multiple_choice"||x==="mcq")&&E[l.answer]||l.answer,q=l.submittedAt?new Date(l.submittedAt).toLocaleTimeString():"N/A";n+=`
                        <tr style="border-bottom: 1px solid #E5E7EB;">
                            <td style="padding: 8px;">${l.participantName}</td>
                            <td style="padding: 8px;">${g}</td>
                            <td style="padding: 8px; color: var(--text-secondary);">${q}</td>
                        </tr>
                    `}),n+="</table></div></details>",n+="</div>"}n+="</div>",i.innerHTML=n}async function le(){var t;if(confirm("Are you sure you want to end this session?"))try{const e=((t=f==null?void 0:f.gamification)==null?void 0:t.enabled)&&(f==null?void 0:f.classId);let o;if(e?(h.debug("Ending session with gamification processing..."),o=await fetch(`https://api-modular.intellaclick.com/api/sessions-gamified/${v}/end-with-gamification`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})):(h.debug("Ending session (no gamification)..."),o=await fetch(`https://api-modular.intellaclick.com/api/sessions/${v}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({status:"ended"})})),!o.ok)throw new Error("Failed to end session");const i=await o.json();h.debug("Session ended:",i),e&&i.gamificationResults?p.success(`Session ended - ${i.gamificationResults.length} students earned points!`):p.success("Session ended"),J(),setTimeout(()=>window.location.href="classes.html",2e3)}catch(e){h.error("Error ending session:",e),p.error("Failed to end session")}}function ce(){N=setInterval(P,3e3)}function J(){N&&clearInterval(N)}function de(){const t=`display.html?id=${v}&code=${b}`;window.open(t,"IntellaClickDisplay","width=1920,height=1080,menubar=no,toolbar=no,location=no,status=no")}function pe(t){navigator.clipboard.writeText(t).then(()=>{p.success("Link copied to clipboard!")}).catch(e=>{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-999999px",document.body.appendChild(o),o.select();try{document.execCommand("copy"),p.success("Link copied to clipboard!")}catch{p.error("Failed to copy link")}document.body.removeChild(o)})}function ue(){const t=document.getElementById("sessionCode").textContent;navigator.clipboard.writeText(t).then(()=>{p.success("Session code copied!")}).catch(e=>{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-999999px",document.body.appendChild(o),o.select();try{document.execCommand("copy"),p.success("Session code copied!")}catch{p.error("Failed to copy code")}document.body.removeChild(o)})}function me(){const t=document.getElementById("modalQuestionText").value.trim(),e=document.getElementById("modalQuestionType").value;if(!t){p.error("Please enter a question");return}const o=parseInt(document.getElementById("modalTimeLimit").value)||60,i=parseInt(document.getElementById("modalPoints").value)||10,n=document.getElementById("modalAwardParticipation").checked;let s={text:t,type:e,timeLimit:o,points:i,awardParticipationPoints:n};switch(e){case"poll":const u=[],c=[];if(["A","B","C","D"].forEach(d=>{const l=document.getElementById(`modalOption${d}`);l&&l.value.trim()&&(u.push(d),c.push(l.value.trim()))}),u.length<2){p.error("Please provide at least 2 options");return}s.type="mcq",s.options=u,s.optionTexts=c,s.awardParticipationPoints=!0;break;case"mcq":const r=[],a=[];let m=null;if(["A","B","C","D"].forEach(d=>{const l=document.getElementById(`modalOption${d}`);if(l&&l.value.trim()){r.push(d),a.push(l.value.trim());const g=document.querySelector(`input[name="modalCorrect"][value="${d}"]`);g&&g.checked&&(m=d)}}),r.length<2){p.error("Please provide at least 2 options");return}s.options=r,s.optionTexts=a,s.correctAnswer=m;break;case"tf":s.options=["True","False"],s.correctAnswer=document.querySelector('input[name="modalTF"]:checked').value;break;case"matching":const x=[];for(let d=1;d<=3;d++){const l=document.getElementById(`modalMatch${d}Left`).value.trim(),g=document.getElementById(`modalMatch${d}Right`).value.trim();l&&g&&x.push({left:l,right:g})}if(x.length<2){p.error("Please provide at least 2 matching pairs");return}s.pairs=x;break;case"ordering":const E=[];for(let d=1;d<=4;d++){const l=document.getElementById(`modalOrder${d}`).value.trim();l&&E.push(l)}if(E.length<2){p.error("Please provide at least 2 items");return}s.correctOrder=E;break;case"fillblank":const C=document.getElementById("modalBlankAnswer").value.trim();if(!C){p.error("Please provide the correct answer");return}if(!t.includes("[blank]")){p.error("Please include [blank] in your question");return}s.correctAnswer=C;break}$!==null?(y[$]=s,$=null,p.success("Question updated")):(y.push(s),p.success("Question added to queue")),S(),_()}async function ye(){try{const t=await fetch("https://api-modular.intellaclick.com/api/quizzes",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load quizzes");const o=(await t.json()).quizzes||[],i=document.getElementById("quizList");o.length===0?(i.innerHTML='<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No quizzes found. <a href="saved-questions.html" style="color: var(--primary-color);">Create your first quiz</a></p>',document.getElementById("importBtn").disabled=!0):(i.innerHTML="",o.forEach(n=>{const s=document.createElement("div");s.className="quiz-item",s.innerHTML=`
                            <strong>${n.title}</strong><br>
                            <small style="color: var(--text-secondary);">${n.questionCount||0} questions â€¢ ${n.totalPoints||0} points</small>
                        `,s.onclick=()=>ge(n._id,s),i.appendChild(s)}))}catch(t){h.error("Error loading quizzes:",t);const e=document.getElementById("quizList");e.innerHTML='<p style="color: var(--danger-color); text-align: center; padding: 20px;">Failed to load quizzes. Please try again.</p>'}}function ge(t,e){R=t,document.querySelectorAll(".quiz-item").forEach(o=>{o.classList.remove("selected")}),e.classList.add("selected"),document.getElementById("importBtn").disabled=!1}async function he(){if(!R){p.error("Please select a quiz");return}try{const t=await fetch(`https://api-modular.intellaclick.com/api/quizzes/${R}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load quiz");const e=await t.json(),o=e.quiz||e;o.questions&&o.questions.length>0?(h.debug("ðŸ“‹ Applying question defaults to imported quiz:",B),o.questions.forEach(i=>{const n=i.questionSnapshot||i,s=n.questionType||n.type||"mcq",u={text:n.questionText||i.text||"",type:s,options:n.options||[],correctAnswer:n.correctAnswer||0,timeLimit:n.timeLimit||i.timeLimit||B.defaultTimeLimit,points:n.points||i.points||B.defaultPoints,awardParticipationPoints:B.defaultAwardParticipation};u.type==="matching"&&n.pairs&&(u.pairs=n.pairs,h.debug("ðŸ“¦ Imported matching question with pairs:",n.pairs)),u.type==="ordering"&&n.correctOrder&&(u.correctOrder=n.correctOrder,h.debug("ðŸ“¦ Imported ordering question with correctOrder:",n.correctOrder)),y.push(u)}),S(),D(),p.success(`Imported ${o.questions.length} questions from ${o.title}`)):p.error("Quiz has no questions")}catch(t){h.error("Error importing quiz:",t),p.error("Failed to import quiz")}}window.onclick=function(t){t.target.className==="modal"&&(t.target.style.display="none")};window.addEventListener("beforeunload",J);window.copySessionCode=ue;window.openDisplayView=de;window.showQuestionModal=ne;window.showImportModal=ie;window.sendNextQuestion=oe;window.stopQuestion=se;window.showResults=re;window.loadSession=P;window.endSession=le;window.closeQuestionModal=_;window.addQuestionToQueue=me;window.closeImportModal=D;window.importSelectedQuiz=he;window.copyJoinUrl=pe;window.updateModalOptions=F;
