import{t as s}from"./toast-93yYkT8V.js";/* empty css               *//* empty css                       */import{q as B}from"./api-Dxj3jBlT.js";import{l as w}from"./logger-gSLuc3Ra.js";let u=[],k=null,v=null,p=4,f=4,g=4,y=4;document.addEventListener("DOMContentLoaded",function(){D(),document.getElementById("quizForm").addEventListener("submit",J),q(4),E(4),b(4),I(4),O();const e=new URLSearchParams(window.location.search).get("id");e&&N(e)});function q(n){p=n;const e=document.getElementById("mcqOptionsContainer");e.innerHTML="";for(let t=0;t<n;t++){const i=String.fromCharCode(65+t),o=document.createElement("div");o.className="radio-option",o.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${i}" ${t===0?"checked":""}>
                    <input type="text" id="option${i}" placeholder="Option ${i}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,e.appendChild(o)}}function E(n){f=n;const e=document.getElementById("pollOptionsContainer");e.innerHTML="";for(let t=0;t<n;t++){const i=String.fromCharCode(65+t),o=document.createElement("input");o.type="text",o.id=`pollOption${i}`,o.placeholder=`Option ${i}`,o.style.width="100%",e.appendChild(o)}}function $(){if(p>=26){s.error("Maximum 26 options allowed");return}p++,q(p)}function A(){if(p<=2){s.error("Minimum 2 options required");return}p--,q(p)}function P(){if(f>=26){s.error("Maximum 26 options allowed");return}f++,E(f)}function M(){if(f<=2){s.error("Minimum 2 options required");return}f--,E(f)}function b(n){g=n;const e=document.getElementById("matchingPairsContainer");e.innerHTML="";for(let t=0;t<n;t++){const i=t+1,o=document.createElement("input");o.type="text",o.id=`match${i}Left`,o.placeholder=`Item ${i}`,o.style.width="100%";const r=document.createElement("input");r.type="text",r.id=`match${i}Right`,r.placeholder=`Match ${i}`,r.style.width="100%",e.appendChild(o),e.appendChild(r)}}function S(){if(g>=10){s.error("Maximum 10 pairs allowed");return}g++,b(g)}function L(){if(g<=2){s.error("Minimum 2 pairs required");return}g--,b(g)}function I(n){y=n;const e=document.getElementById("orderingItemsContainer");e.innerHTML="";for(let t=0;t<n;t++){const i=t+1,o=document.createElement("input");o.type="text",o.id=`order${i}`,o.placeholder=`${H(i)} item`,o.style.width="100%",e.appendChild(o)}}function F(){if(y>=10){s.error("Maximum 10 items allowed");return}y++,I(y)}function R(){if(y<=2){s.error("Minimum 2 items required");return}y--,I(y)}function H(n){const e=["th","st","nd","rd"],t=n%100;return n+(e[(t-20)%10]||e[t]||e[0])}function D(){localStorage.getItem("token")||(window.location.href="login.html")}async function N(n){try{w.debug("Loading quiz for editing:",n);const e=await B.getById(n),t=e.quiz||e;k=n,document.getElementById("quizTitle").value=t.title||"",document.getElementById("quizDescription").value=t.description||"",document.querySelector(".header h1").textContent="Edit Quiz",document.getElementById("saveButton").textContent="Update Quiz",t.questions&&t.questions.length>0&&(u=t.questions.map(i=>{const o=i.questionSnapshot||{};return{questionText:o.questionText||"",questionType:o.questionType||"mcq",options:o.options||[],correctAnswer:o.correctAnswer,pairs:o.pairs,correctOrder:o.correctOrder,points:i.points||10}}),x()),s.success("Quiz loaded for editing")}catch(e){w.error("Error loading quiz:",e),s.error("Failed to load quiz: "+e.message)}}function O(){const n=document.getElementById("questionType").value;switch(document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none",n){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block";break}}function U(){const n=document.getElementById("questionType").value,e=document.getElementById("questionText").value.trim();if(!e){s.error("Please enter a question");return}let t={questionText:e,questionType:n,points:10};try{switch(n){case"mcq":const i=[];let o=null;for(let l=0;l<p;l++){const d=String.fromCharCode(65+l),m=document.getElementById(`option${d}`);if(m&&m.value.trim()){i.push(m.value.trim());const T=document.querySelector(`input[name="correctAnswer"][value="${d}"]`);T&&T.checked&&(o=d)}}if(i.length<2){s.error("Please provide at least 2 answer options");return}t.options=i,t.correctAnswer=o;break;case"poll":const r=[];for(let l=0;l<f;l++){const d=String.fromCharCode(65+l),m=document.getElementById(`pollOption${d}`);m&&m.value.trim()&&r.push(m.value.trim())}if(r.length<2){s.error("Please provide at least 2 poll options");return}t.options=r;const a=document.getElementById("pollParticipationPoints").checked;t.awardParticipationPoints=a;break;case"tf":t.options=["True","False"],t.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const c=[];for(let l=1;l<=g;l++){const d=document.getElementById(`match${l}Left`).value.trim(),m=document.getElementById(`match${l}Right`).value.trim();d&&m&&c.push({left:d,right:m})}if(c.length<2){s.error("Please provide at least 2 matching pairs");return}t.pairs=c;break;case"ordering":const h=[];for(let l=1;l<=y;l++){const d=document.getElementById(`order${l}`).value.trim();d&&h.push(d)}if(h.length<2){s.error("Please provide at least 2 items to order");return}t.correctOrder=h;break;case"fillblank":const Q=document.getElementById("blankAnswer").value.trim();if(!Q){s.error("Please provide the correct answer");return}if(!e.includes("[blank]")){s.error("Please include [blank] in your question where the answer should go");return}t.correctAnswer=Q;break}if(v!==null){u[v]=t,s.success("Question updated successfully!"),v=null;const i=document.querySelector('button[onclick="addQuestion()"]');i&&(i.textContent="+ Add This Question",i.className="btn btn-primary")}else u.push(t),s.success("Question added successfully!");z(),x()}catch(i){w.error("Error adding question:",i),s.error("Error adding question: "+i.message)}}function z(){document.getElementById("questionText").value="";for(let e=0;e<p;e++){const t=String.fromCharCode(65+e),i=document.getElementById(`option${t}`);i&&(i.value="")}for(let e=0;e<f;e++){const t=String.fromCharCode(65+e),i=document.getElementById(`pollOption${t}`);i&&(i.value="")}for(let e=1;e<=g;e++){const t=document.getElementById(`match${e}Left`),i=document.getElementById(`match${e}Right`);t&&(t.value=""),i&&(i.value="")}for(let e=1;e<=y;e++){const t=document.getElementById(`order${e}`);t&&(t.value="")}const n=document.getElementById("blankAnswer");n&&(n.value="")}function j(n){const e=u[n];switch(v=n,document.getElementById("questionText").value=e.questionText,document.getElementById("questionType").value=e.questionType,O(),e.questionType){case"mcq":if(e.options&&(q(e.options.length),e.options.forEach((o,r)=>{const a=String.fromCharCode(65+r),c=document.getElementById(`option${a}`);c&&(c.value=o)}),e.correctAnswer)){const o=document.querySelector(`input[name="correctAnswer"][value="${e.correctAnswer}"]`);o&&(o.checked=!0)}break;case"poll":e.options&&(E(e.options.length),e.options.forEach((o,r)=>{const a=String.fromCharCode(65+r),c=document.getElementById(`pollOption${a}`);c&&(c.value=o)}));break;case"tf":if(e.correctAnswer){const o=document.querySelector(`input[name="tfAnswer"][value="${e.correctAnswer}"]`);o&&(o.checked=!0)}break;case"matching":e.pairs&&(b(e.pairs.length),e.pairs.forEach((o,r)=>{const a=r+1,c=document.getElementById(`match${a}Left`),h=document.getElementById(`match${a}Right`);c&&(c.value=o.left),h&&(h.value=o.right)}));break;case"ordering":e.correctOrder&&(I(e.correctOrder.length),e.correctOrder.forEach((o,r)=>{const a=document.getElementById(`order${r+1}`);a&&(a.value=o)}));break;case"fillblank":e.correctAnswer&&(document.getElementById("blankAnswer").value=e.correctAnswer);break}const t=document.querySelector('button[onclick="addQuestion()"]');t&&(t.textContent="Update Question",t.className="btn btn-success");const i=document.getElementById("cancelEditBtn");i&&(i.style.display="inline-block"),document.getElementById("questionText").scrollIntoView({behavior:"smooth",block:"center"}),s.success("Question loaded for editing")}function V(n){window.confirm("Remove this question?")&&(u.splice(n,1),x(),v===n&&C(),s.success("Question removed"))}function C(){v=null,z();const n=document.querySelector('button[onclick="addQuestion()"]');n&&(n.textContent="+ Add This Question",n.className="btn btn-primary");const e=document.getElementById("cancelEditBtn");e&&(e.style.display="none"),s.success("Edit cancelled")}function x(){const n=document.getElementById("questionsList");if(u.length===0){n.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}n.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${u.length} Question(s) Added:</strong>
                </div>
                ${u.map((e,t)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${t+1}: ${e.questionText}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${G(e.questionType)}</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="editQuestion(${t})">Edit</button>
                            <button type="button" class="btn btn-danger btn-small" onclick="removeQuestion(${t})">Remove</button>
                        </div>
                    </div>
                `).join("")}
            `}function G(n){return{mcq:"Multiple Choice",poll:"Poll",tf:"True/False",matching:"Matching",ordering:"Put in Order",fillblank:"Fill in the Blank"}[n]||n.toUpperCase()}async function J(n){n.preventDefault();const e=document.getElementById("quizTitle").value.trim(),t=document.getElementById("quizDescription").value.trim();if(!e){s.error("Please enter a quiz title");return}if(u.length===0){s.error("Please add at least one question to the quiz");return}const i=u.map(r=>({questionSnapshot:{questionText:r.questionText,questionType:r.questionType,options:r.options,correctAnswer:r.correctAnswer,pairs:r.pairs,correctOrder:r.correctOrder},points:r.points||10})),o={title:e,description:t,type:"standard",questions:i,questionCount:i.length,settings:{shuffleQuestions:!1,shuffleAnswers:!1,showCorrectAnswers:!0}};try{document.getElementById("saveButton").disabled=!0,document.getElementById("saveButton").textContent="Saving...";let r;k?(r=await B.update(k,o),w.debug("Quiz updated:",r),s.success("Quiz updated successfully!")):(r=await B.create(o),w.debug("Quiz created:",r),s.success("Quiz saved successfully!")),setTimeout(()=>{window.location.href="quizzes.html"},1e3)}catch(r){w.error("Error saving quiz:",r),s.error("Failed to save quiz: "+r.message),document.getElementById("saveButton").disabled=!1,document.getElementById("saveButton").textContent="Save Quiz"}}function K(){u.length>0?window.confirm("Are you sure you want to cancel? All unsaved changes will be lost.")&&(window.location.href="quizzes.html"):window.location.href="quizzes.html"}function W(){const n=document.getElementById("questionText"),e=n.selectionStart,t=n.selectionEnd,i=n.value,o=i.substring(0,e)+"[blank]"+i.substring(t);n.value=o,n.selectionStart=n.selectionEnd=e+7,n.focus()}window.updateQuestionOptions=O;window.addQuestion=U;window.editQuestion=j;window.removeQuestion=V;window.cancelEditQuestion=C;window.cancelQuiz=K;window.insertBlank=W;window.addMcqOption=$;window.removeMcqOption=A;window.addPollOption=P;window.removePollOption=M;window.addMatchingPair=S;window.removeMatchingPair=L;window.addOrderingItem=F;window.removeOrderingItem=R;
