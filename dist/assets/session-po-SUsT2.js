import{t as g}from"./toast-Cbd37M37.js";/* empty css               */import{l as w}from"./logger-CXzo1yMG.js";let C,T,b,G,f=[],I=-1,R,N=null,Q={defaultTimeLimit:60,defaultPoints:10,defaultAwardParticipation:!1,defaultShowCorrectAnswer:!0,defaultAllowAnswerChange:!0};document.addEventListener("DOMContentLoaded",function(){const t=new URLSearchParams(window.location.search);if(C=t.get("id"),T=t.get("code"),t.get("type"),!C||!T){g.error("Invalid session parameters"),setTimeout(()=>window.location.href="classes.html",2e3);return}const e=sessionStorage.getItem("pendingQuestions");if(e){const s=JSON.parse(e);f.push(...s),sessionStorage.removeItem("pendingQuestions"),sessionStorage.removeItem("currentQuestionIndex"),S()}else{const s=sessionStorage.getItem("pendingQuestion");if(s){const i=JSON.parse(s);f.push(i),sessionStorage.removeItem("pendingQuestion"),S()}}if(f.length===0){const s=sessionStorage.getItem("questionQueue_"+T),i=sessionStorage.getItem("questionIndex_"+T);s&&(console.log("[Session] Restoring queue from sessionStorage"),f=JSON.parse(s),I=i?parseInt(i):-1,S())}f.length===0&&(console.log("[Session] Attempting to restore queue from backend"),V()),W(),F(),Z(),ce()});function W(){localStorage.getItem("token")||(window.location.href="/login.html")}async function F(){try{const t=await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${T}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load session");b=(await t.json()).session,G=b.classId,w.debug("Session loaded:",{sessionId:C,sessionCode:T,sessionData:b,hasCurrentQuestion:!!b.currentQuestion}),K()}catch(t){w.error("Error loading session:",t),g.error("Failed to load session")}}async function V(){try{const t=await fetch(`https://api-modular.intellaclick.com/api/sessions/${C}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok){console.error("[Session] Failed to fetch session data for queue restoration");return}const e=await t.json();e.success&&e.session.questionQueue&&e.session.questionQueue.length>0?(f=e.session.questionQueue,I=e.session.currentQuestionIndex??-1,console.log("[Session] Queue restored from backend:",{queueLength:f.length,currentIndex:I}),S(),g.success(`Restored ${f.length} questions from previous session`)):console.log("[Session] No saved queue found in backend")}catch(t){console.error("[Session] Error restoring queue from backend:",t)}}async function z(){try{if(!(await fetch(`https://api-modular.intellaclick.com/api/sessions/${C}/question-queue`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({questionQueue:f,currentQuestionIndex:I})})).ok){console.error("[Session] Failed to save queue to backend");return}console.log("[Session] Queue saved to backend successfully")}catch(t){console.error("[Session] Error saving queue to backend:",t)}}async function Z(){try{const t=await fetch("https://api-modular.intellaclick.com/api/users/question-defaults",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});t.ok?(Q=(await t.json()).defaults||Q,document.getElementById("modalTimeLimit").value=Q.defaultTimeLimit,document.getElementById("modalPoints").value=Q.defaultPoints,document.getElementById("modalAwardParticipation").checked=Q.defaultAwardParticipation,w.debug("‚úÖ Loaded question defaults:",Q)):w.debug("No saved question defaults found, using system defaults")}catch(t){w.error("Error loading question defaults:",t)}}function K(){document.getElementById("sessionCode").textContent=b.sessionCode,document.getElementById("participantCount").textContent=b.participantCount||0;const t=`https://join.intellaclick.com/session/${b.sessionCode}`;document.getElementById("joinUrl").innerHTML=`
                <strong>Students can join at:</strong><br>
                <div style="display: flex; align-items: center; gap: 12px; margin: 8px 0;">
                    <span style="font-size: 16px; user-select: all; flex: 1;">${t}</span>
                    <button class="btn btn-secondary" onclick="copyJoinUrl('${t}')" style="padding: 6px 12px; font-size: 12px;">
                        Copy Link
                    </button>
                </div>
                <small style="color: var(--text-secondary); margin-top: 4px; display: block;">
                    Session ID: ${b.id||b._id}<br>
                    ${b.restrictToEnrolled===!1?"Open to all students":"Restricted to enrolled students only"}
                </small>
            `,Y(t);const e=document.getElementById("sessionStatus");e.textContent=b.status.charAt(0).toUpperCase()+b.status.slice(1),e.className=`status-badge status-${b.status}`,b.status==="active"&&b.currentQuestion&&(document.getElementById("stopBtn").disabled=!1,document.getElementById("resultsBtn").disabled=!1,U(b.currentQuestion)),X()}function X(){const t=document.getElementById("participantsList");fetch(`https://api-modular.intellaclick.com/api/sessions/${C}/participants`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>e.json()).then(e=>{e.participants&&e.participants.length>0?(t.innerHTML="",e.participants.forEach(s=>{const i=document.createElement("div");i.className="participant-card",i.innerHTML=`
                            <strong>${s.name||"Anonymous"}</strong><br>
                            <small style="color: var(--text-secondary);">
                                Joined: ${new Date(s.joinedAt).toLocaleTimeString()}<br>
                                ${s.isEnrolled?"Enrolled Student":"Guest"}
                            </small>
                        `,t.appendChild(i)})):t.innerHTML='<p style="color: var(--text-secondary);">No participants yet. Share the session code for students to join.</p>'}).catch(e=>{w.error("Error loading participants:",e)})}function Y(t){const e=document.getElementById("qrcode");e.innerHTML="";const s=document.createElement("canvas");QRCode.toCanvas(s,t,{width:400,margin:2,color:{dark:"#000000",light:"#FFFFFF"}},function(i){if(i){w.error("QR Code generation error:",i),e.innerHTML='<p style="color: var(--text-secondary);">QR Code generation failed</p>';return}s.style.width="200px",s.style.height="200px",e.appendChild(s)})}function S(){const t=document.getElementById("queueList");sessionStorage.setItem("questionQueue_"+T,JSON.stringify(f)),sessionStorage.setItem("questionIndex_"+T,I.toString()),z(),f.length===0?(t.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions in queue. Create a new question or import from a quiz.</p>',document.getElementById("sendBtn").disabled=!0):(t.innerHTML="",f.forEach((e,s)=>{const i=document.createElement("div");i.className="question-item",i.style.padding="12px",i.style.marginBottom="8px",i.style.border="1px solid var(--border-color)",i.style.borderRadius="6px",i.style.backgroundColor="var(--bg-primary)";const o=document.createElement("div");o.style.display="flex",o.style.alignItems="flex-start",o.style.marginBottom="10px";const a=document.createElement("div");a.style.fontWeight="bold",a.style.marginRight="8px",a.style.minWidth="24px",a.style.color="var(--text-secondary)",a.textContent=`${s+1}.`;const y=document.createElement("div");if(y.style.flex="1",y.style.lineHeight="1.4",y.textContent=e.text||e.questionText,o.appendChild(a),o.appendChild(y),s>I){const p=document.createElement("div");p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.paddingTop="10px",p.style.borderTop="1px solid var(--border-color)";const l=document.createElement("div");l.style.display="grid",l.style.gridTemplateColumns="auto auto auto",l.style.gap="12px 20px",l.style.alignItems="center",l.style.fontSize="13px";const n=document.createElement("span");n.style.color="var(--text-secondary)",n.style.textAlign="right",n.style.minWidth="50px",n.textContent="Time:";const h=document.createElement("input");h.type="number",h.value=e.timeLimit||60,h.min=10,h.max=300,h.style.width="60px",h.style.padding="4px 8px",h.style.border="1px solid var(--border-color)",h.style.borderRadius="4px",h.style.fontSize="13px";const d=()=>{const M=parseInt(h.value)||60;e.timeLimit=M,console.log(`‚úèÔ∏è Updated question ${s+1} time limit:`,M,"Full question:",e),sessionStorage.setItem("questionQueue_"+T,JSON.stringify(f)),z()};h.onchange=d,h.onblur=d;const v=document.createElement("span");v.style.color="var(--text-secondary)",v.textContent="sec";const u=document.createElement("span");u.style.color="var(--text-secondary)",u.style.textAlign="right",u.style.minWidth="50px",u.textContent="Points:";const m=document.createElement("input");m.type="number",m.value=e.points||10,m.min=1,m.max=100,m.style.width="60px",m.style.padding="4px 8px",m.style.border="1px solid var(--border-color)",m.style.borderRadius="4px",m.style.fontSize="13px";const r=()=>{const M=parseInt(m.value)||10;e.points=M,console.log(`‚úèÔ∏è Updated question ${s+1} points:`,M,"Full question:",e),sessionStorage.setItem("questionQueue_"+T,JSON.stringify(f)),z()};m.onchange=r,m.onblur=r;const c=document.createElement("span");c.style.color="var(--text-secondary)",c.textContent="pts";const k=document.createElement("span");k.style.color="var(--text-secondary)",k.style.textAlign="right",k.style.minWidth="50px",k.textContent="Award:";const x=document.createElement("div");x.style.width="60px",x.style.display="flex",x.style.alignItems="center",x.style.paddingLeft="4px";const E=document.createElement("input");E.type="checkbox",E.checked=e.awardParticipationPoints||!1,E.style.cursor="pointer",E.style.width="16px",E.style.height="16px",E.style.margin="0",E.onchange=()=>{e.awardParticipationPoints=E.checked,console.log(`‚úèÔ∏è Updated question ${s+1} awardParticipationPoints:`,E.checked,"Full question:",e),sessionStorage.setItem("questionQueue_"+T,JSON.stringify(f)),z()},x.appendChild(E);const O=document.createElement("span");O.textContent="Participation points",l.appendChild(n),l.appendChild(h),l.appendChild(v),l.appendChild(u),l.appendChild(m),l.appendChild(c),l.appendChild(k),l.appendChild(x),l.appendChild(O);const A=document.createElement("div");A.style.display="flex",A.style.gap="6px",A.style.flexShrink="0";const B=document.createElement("button");B.className="btn btn-secondary",B.style.padding="6px 10px",B.style.fontSize="12px",B.style.minWidth="32px",B.innerHTML="‚Üë",B.title="Move up",s>I+1?B.onclick=()=>j(s,-1):(B.disabled=!0,B.style.opacity="0.3",B.style.cursor="not-allowed"),A.appendChild(B);const q=document.createElement("button");q.className="btn btn-secondary",q.style.padding="6px 10px",q.style.fontSize="12px",q.style.minWidth="32px",q.innerHTML="‚Üì",q.title="Move down",s<f.length-1?q.onclick=()=>j(s,1):(q.disabled=!0,q.style.opacity="0.3",q.style.cursor="not-allowed"),A.appendChild(q);const $=document.createElement("button");$.className="btn btn-secondary",$.style.padding="6px 12px",$.style.fontSize="12px",$.textContent="Edit",$.onclick=()=>te(s),A.appendChild($);const L=document.createElement("button");L.className="btn btn-secondary",L.style.padding="6px 12px",L.style.fontSize="12px",L.textContent="Remove",L.onclick=()=>ee(s),A.appendChild(L),p.appendChild(l),p.appendChild(A),i.appendChild(o),i.appendChild(p)}else i.appendChild(o),i.style.opacity="0.6",i.style.backgroundColor="var(--bg-secondary)";t.appendChild(i)}),document.getElementById("sendBtn").disabled=!1)}function ee(t){f.splice(t,1),S()}function j(t,e){const s=t+e;if(s<=I||s>=f.length)return;const i=f[t];f[t]=f[s],f[s]=i,S(),g.success("Question moved")}let P=null;function te(t){P=t;const e=f[t];document.getElementById("questionModal").style.display="block";const s=!e.correctAnswer&&e.correctAnswer!==0&&e.correctAnswer!==!1,i=s?"poll":e.type||e.questionType||"mcq";w.debug("Editing question:",{type:i,isPoll:s,correctAnswer:e.correctAnswer,options:e.options||e.optionTexts}),document.getElementById("modalQuestionType").value=i,document.getElementById("modalQuestionText").value=e.text||e.questionText||"",document.getElementById("modalTimeLimit").value=e.timeLimit||60,document.getElementById("modalPoints").value=e.points||10,document.getElementById("modalAwardParticipation").checked=e.awardParticipationPoints||!1,setTimeout(()=>H(),10),setTimeout(()=>{switch(i){case"poll":if(e.options||e.optionTexts){const l=e.optionTexts||e.options;["A","B","C","D"].forEach((n,h)=>{const d=document.getElementById(`modalOption${n}`);d&&l[h]&&(d.value=l[h])})}break;case"mcq":if(e.optionTexts||e.options){const l=e.optionTexts||e.options;["A","B","C","D"].forEach((n,h)=>{const d=document.getElementById(`modalOption${n}`);if(d&&l[h]&&(d.value=l[h]),e.correctAnswer===n||e.correctAnswer===h){const v=document.querySelector(`input[name="modalCorrect"][value="${n}"]`);v&&(v.checked=!0)}})}break;case"tf":const a=e.correctAnswer==="true"||e.correctAnswer===!0?"true":"false",y=document.querySelector(`input[name="modalTF"][value="${a}"]`);y&&(y.checked=!0);break;case"matching":e.pairs&&e.pairs.forEach((l,n)=>{const h=document.getElementById(`modalMatch${n+1}Left`),d=document.getElementById(`modalMatch${n+1}Right`);h&&(h.value=l.left||""),d&&(d.value=l.right||"")});break;case"ordering":e.correctOrder&&e.correctOrder.forEach((l,n)=>{const h=document.getElementById(`modalOrder${n+1}`);h&&(h.value=l||"")});break;case"fillblank":const p=document.getElementById("modalBlankAnswer");p&&(p.value=e.correctAnswer||"");break}},100);const o=document.querySelector("#questionModal h2");o&&(o.textContent="Edit Question")}async function oe(){if(console.log("üöÄ SEND NEXT QUESTION CALLED:",{currentIndex:I,queueLength:f.length,willPassCheck:I+1<f.length,nextQuestion:f[I+1]}),I+1>=f.length){g.error("No more questions in queue");return}I++,sessionStorage.setItem("questionIndex_"+T,I.toString());const t=f[I];console.log("üîç QUESTION FROM QUEUE (before normalization):",{index:I,timeLimit:t.timeLimit,points:t.points,awardParticipationPoints:t.awardParticipationPoints,fullQuestion:t});const e={...t};console.log("üîç NORMALIZED QUESTION (after spread):",{timeLimit:e.timeLimit,points:e.points,awardParticipationPoints:e.awardParticipationPoints,fullQuestion:e}),delete e.type;const i={mcq:"multiple_choice",tf:"boolean",matching:"matching",ordering:"ordering",fillblank:"fill_blank"}[t.type]||t.type;if(e.questionType=i,e.type=i,e.questionText=t.text||t.questionText,t.type==="tf")e.options=["True","False"];else if(t.type==="mcq")t.optionTexts&&(e.options=t.options,e.optionTexts=t.optionTexts);else if(t.type==="matching"){e.pairs=t.pairs||[];const o=e.pairs.map(y=>y.right),a=o.sort(()=>Math.random()-.5);e.shuffledMatchingRight=a,console.log("üé≤ MATCHING SHUFFLE DEBUG:",{originalPairs:e.pairs,originalRight:o,shuffledRight:a})}else if(t.type==="ordering"){e.correctOrder=t.correctOrder||[];const o=[...e.correctOrder].sort(()=>Math.random()-.5);e.shuffledOrderingItems=o,console.log("üé≤ ORDERING SHUFFLE DEBUG:",{originalOrder:e.correctOrder,shuffledItems:o})}else t.type==="fillblank"&&(e.correctAnswer=t.correctAnswer||"");console.log("üì§ SENDING QUESTION TO BACKEND:",{sessionId:C,questionType:e.questionType,type:e.type,timeLimit:e.timeLimit,points:e.points,awardParticipationPoints:e.awardParticipationPoints,shuffledMatchingRight:e.shuffledMatchingRight,shuffledOrderingItems:e.shuffledOrderingItems,fullQuestion:e}),w.debug("Sending question:",{sessionId:C,endpoint:`https://api-modular.intellaclick.com/api/sessions/${C}/questions`,questionData:e,hasQuestionText:!!e.questionText,questionType:e.questionType}),console.log("üåê MAKING FETCH REQUEST:",{url:`https://api-modular.intellaclick.com/api/sessions/${C}/questions`,method:"POST",timeLimit:e.timeLimit,points:e.points});try{const o=await fetch(`https://api-modular.intellaclick.com/api/sessions/${C}/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(e)});if(console.log("üì° FETCH RESPONSE:",{status:o.status,ok:o.ok}),!o.ok){const y=await o.json();throw console.log("‚ùå FETCH ERROR:",y),w.error("API Error:",{status:o.status,error:y}),new Error(y.error||"Failed to send question")}const a=await o.json();console.log("‚úÖ FETCH SUCCESS:",a),w.debug("Question sent successfully:",a),g.success("Question sent successfully!"),document.getElementById("stopBtn").disabled=!1,document.getElementById("resultsBtn").disabled=!1,U(t),S(),setTimeout(async()=>{await F()},500)}catch(o){w.error("Error sending question:",o),o.name==="TypeError"&&o.message==="Failed to fetch"?(g.error("Network error: Unable to reach the API server. This may be a CORS issue."),w.error("CORS Error Details:",{error:o,message:"The API server may need to add instructor.intellaclick.com to its allowed origins",currentOrigin:window.location.origin,apiUrl:"https://api-modular.intellaclick.com"}),window.confirm(`Network error detected. This is likely a CORS configuration issue.

The backend needs to add instructor.intellaclick.com to its allowed origins.

Click OK to open the CORS test page for more details.`)&&window.open("/cors-test.html","_blank")):g.error(o.message||"Failed to send question"),I--}}function U(t){document.getElementById("currentQuestionSection").style.display="block";const e=t.type||t.questionType,s=t.text||t.questionText||"";w.debug("üì∫ DISPLAYING QUESTION IN SESSION CONTROL:",{questionType:e,questionText:s,hasPairs:!!t.pairs,pairs:t.pairs,hasCorrectOrder:!!t.correctOrder,correctOrder:t.correctOrder,fullQuestion:t});let i=s;(e==="fillblank"||e==="fill_blank")&&(i=i.replace(/\[blank\]/gi,'<span style="display: inline-block; min-width: 100px; border-bottom: 2px solid #4F46E5; margin: 0 6px; height: 1.2em; vertical-align: bottom;"></span>')),document.getElementById("questionText").innerHTML=i;const o=document.getElementById("questionOptions");if(o.innerHTML="",(e==="mcq"||e==="multiple_choice")&&(t.optionTexts||t.options)){const a=t.optionTexts||t.options;(t.options&&t.optionTexts?t.options:["A","B","C","D"]).forEach((p,l)=>{if(a[l]){const n=document.createElement("div");n.style.marginTop="8px",n.textContent=`${p}: ${a[l]}`,o.appendChild(n)}})}else if(e==="tf"||e==="boolean")o.innerHTML='<div style="margin-top: 8px;">A: True</div><div style="margin-top: 8px;">B: False</div>';else if(e==="matching"&&t.pairs){if(o.innerHTML="<strong>Match the following:</strong>",t.pairs.forEach((a,y)=>{const p=document.createElement("div");p.style.marginTop="8px",p.textContent=`${y+1}. ${a.left} ‚Üí ?`,o.appendChild(p)}),t.shuffledMatchingRight){const a=document.createElement("div");a.style.marginTop="12px",a.innerHTML="<strong>Options to match:</strong>",t.shuffledMatchingRight.forEach((y,p)=>{const l=document.createElement("div");l.style.marginTop="4px",l.textContent=`${String.fromCharCode(65+p)}. ${y}`,a.appendChild(l)}),o.appendChild(a)}}else(e==="ordering"||e==="ordering")&&t.correctOrder&&(o.innerHTML="<strong>Put in correct order:</strong>",(t.shuffledOrderingItems||t.correctOrder).forEach((y,p)=>{const l=document.createElement("div");l.style.marginTop="8px",l.textContent=`${String.fromCharCode(65+p)}. ${y}`,o.appendChild(l)}))}function ne(){document.getElementById("questionModal").style.display="block",H()}function _(){document.getElementById("questionModal").style.display="none",document.getElementById("modalQuestionText").value="",document.getElementById("modalQuestionType").value="mcq",P=null;const t=document.querySelector("#questionModal h2");t&&(t.textContent="Create Question")}function se(){document.getElementById("importModal").style.display="block",ge()}function D(){document.getElementById("importModal").style.display="none",N=null}function H(){const t=document.getElementById("modalQuestionType").value,e=document.getElementById("modalQuestionOptions");switch(t){case"poll":e.innerHTML=`
                        <label>Poll Options (no correct answer - all answers award participation points)</label>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionA" placeholder="Option A" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionB" placeholder="Option B" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionC" placeholder="Option C" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionD" placeholder="Option D" style="width: 100%;">
                        </div>
                        <small style="display: block; margin-top: 8px; color: var(--text-secondary);">
                            üí° Poll questions have no correct answer. All students who answer receive participation points.
                        </small>
                    `;break;case"mcq":e.innerHTML=`
                        <label>Answer Options (select correct answer)</label>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="A" checked>
                            <input type="text" id="modalOptionA" placeholder="Option A" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="B">
                            <input type="text" id="modalOptionB" placeholder="Option B" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="C">
                            <input type="text" id="modalOptionC" placeholder="Option C" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="D">
                            <input type="text" id="modalOptionD" placeholder="Option D" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                    `;break;case"tf":e.innerHTML=`
                        <label>Correct Answer</label>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalTF" value="true" checked> True
                            <input type="radio" name="modalTF" value="false" style="margin-left: 20px;"> False
                        </div>
                    `;break;case"matching":e.innerHTML=`
                        <label>Matching Pairs</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
                            <input type="text" placeholder="Item 1" id="modalMatch1Left">
                            <input type="text" placeholder="Match 1" id="modalMatch1Right">
                            <input type="text" placeholder="Item 2" id="modalMatch2Left">
                            <input type="text" placeholder="Match 2" id="modalMatch2Right">
                            <input type="text" placeholder="Item 3" id="modalMatch3Left">
                            <input type="text" placeholder="Match 3" id="modalMatch3Right">
                        </div>
                    `;break;case"ordering":e.innerHTML=`
                        <label>Items in Correct Order</label>
                        <div style="margin-top: 8px;">
                            <input type="text" placeholder="1st item" id="modalOrder1" style="margin-bottom: 8px;">
                            <input type="text" placeholder="2nd item" id="modalOrder2" style="margin-bottom: 8px;">
                            <input type="text" placeholder="3rd item" id="modalOrder3" style="margin-bottom: 8px;">
                            <input type="text" placeholder="4th item" id="modalOrder4">
                        </div>
                    `;break;case"fillblank":e.innerHTML=`
                        <label>Correct Answer</label>
                        <input type="text" id="modalBlankAnswer" placeholder="Enter the correct answer" style="margin-top: 8px;">
                        <small style="display: block; margin-top: 8px; color: var(--text-secondary);">Use [blank] in your question where the answer should go</small>
                    `;break}}async function ie(){var t;try{const e=((t=b.currentQuestion)==null?void 0:t.questionId)||"current";if(!(await fetch(`https://api-modular.intellaclick.com/api/sessions/${C}/questions/${e}/end`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to stop question");g.success("Question stopped"),document.getElementById("currentQuestionSection").style.display="none",await F()}catch(e){w.error("Error stopping question:",e),g.error("Failed to stop question")}}async function re(){var t,e;try{const i=await(await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${T}/responses`)).json();if(!i.success){g.error("Failed to load results");return}const a=await(await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${T}`)).json();console.log("üìä Results data:",{responses:i.responses,responsesByQuestion:i.responsesByQuestion,sessionQuestions:(t=a.session)==null?void 0:t.questions,currentQuestion:(e=a.session)==null?void 0:e.currentQuestion}),document.getElementById("responsesSection").style.display="block",ae(i.responses,i.responsesByQuestion,a.session),document.getElementById("responsesSection").scrollIntoView({behavior:"smooth"})}catch(s){console.error("Error fetching results:",s),g.error("Failed to load results")}}function ae(t,e,s){var a,y;const i=document.getElementById("responseChart");if(!t||t.length===0){i.innerHTML='<p style="color: var(--text-secondary); text-align: center; padding: 40px;">No responses yet</p>';return}let o="<h3>Session Results Summary</h3>";o+=`<p style="margin-bottom: 20px; color: var(--text-secondary);">Total Responses: ${t.length}</p>`,o+='<div style="padding-bottom: 20px;">';for(const[p,l]of Object.entries(e)){let n=(a=s==null?void 0:s.questions)==null?void 0:a.find(r=>{var c;return((c=r._id)==null?void 0:c.toString())===p||r.questionId===p||r.id===p});if(!n&&(s!=null&&s.questionQueue)&&(n=s.questionQueue.find(r=>{var c;return((c=r._id)==null?void 0:c.toString())===p||r.questionId===p||r.id===p})),!n&&(s!=null&&s.currentQuestion)){const r=s.currentQuestion;(((y=r._id)==null?void 0:y.toString())===p||r.questionId===p||r.id===p)&&(n=r)}if(!n&&l.length>0){const r=t.find(c=>c.questionId===p);r&&(n=r.questionData||r.question||r.questionDetails)}console.log("üîç Question lookup:",{questionId:p,questionsArray:s==null?void 0:s.questions,questionQueue:s==null?void 0:s.questionQueue,foundQuestion:n,firstResponse:l[0],fullResponse:t.find(r=>r.questionId===p)});const h=(n==null?void 0:n.text)||(n==null?void 0:n.questionText)||"Question text not found",d=(n==null?void 0:n.type)||(n==null?void 0:n.questionType)||"unknown",v=(n==null?void 0:n.options)||[];let u=n==null?void 0:n.correctAnswer;typeof u=="string"&&u.length===1&&u>="A"&&u<="Z"?u=u.charCodeAt(0)-65:d==="boolean"&&typeof u=="string"&&(u==="true"||u==="True"?u=0:(u==="false"||u==="False")&&(u=1)),o+=`
                    <div style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="margin-bottom: 16px; word-wrap: break-word;">${h}</h4>
                        <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                            ${l.length} response${l.length!==1?"s":""}
                        </p>
                `;const m={};if(l.forEach(r=>{let c=r.answer;typeof c=="string"&&c.length===1&&c>="A"&&c<="Z"?c=c.charCodeAt(0)-65:d==="boolean"&&(c==="true"||c===!0?c=0:(c==="false"||c===!1)&&(c=1)),m[c]=(m[c]||0)+1}),console.log("üìä Answer counting:",{questionId:p,questionResponses:l,answerCounts:m,options:v,questionType:d}),(d==="multiple_choice"||d==="mcq"||d==="poll"||d==="boolean")&&(o+='<div style="margin-bottom: 20px;">',v.forEach((r,c)=>{const k=m[c]||0,x=Math.round(k/l.length*100)||0,O=(d==="multiple_choice"||d==="mcq")&&u===c;o+=`
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <span style="font-weight: 500;">
                                        ${r} ${O?'<span style="color: var(--secondary-color);">‚úì Correct</span>':""}
                                    </span>
                                    <span style="color: var(--text-secondary);">${k} (${x}%)</span>
                                </div>
                                <div style="background: #E5E7EB; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: ${O?"var(--secondary-color)":"var(--primary-color)"}; height: 100%; width: ${x}%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        `}),o+="</div>"),d==="multiple_choice"||d==="mcq")console.log("üîç MCQ correct answer check:",{questionType:d,correctAnswer:u,options:v,hasCorrectAnswer:u!==void 0,optionAtIndex:v[u]}),u!==void 0&&v[u]&&(o+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',o+='<strong style="color: var(--secondary-color);">Correct Answer:</strong> ',o+=`<span>${v[u]}</span>`,o+="</div>");else if(d==="boolean")console.log("üîç Boolean correct answer check:",{questionType:d,correctAnswer:u,options:v,hasCorrectAnswer:u!==void 0,optionAtIndex:v[u]}),u!==void 0&&v[u]&&(o+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',o+='<strong style="color: var(--secondary-color);">Correct Answer:</strong> ',o+=`<span>${v[u]}</span>`,o+="</div>");else if(d==="matching"){console.log("üîç Matching question debug:",{question:n,pairs:n==null?void 0:n.pairs,leftColumn:n==null?void 0:n.leftColumn,rightColumn:n==null?void 0:n.rightColumn,correctPairs:n==null?void 0:n.correctPairs,correctAnswer:n==null?void 0:n.correctAnswer});let r=(n==null?void 0:n.leftColumn)||[];r.length===0&&(n!=null&&n.pairs)&&Array.isArray(n.pairs)&&(r=n.pairs.map(k=>k.left),console.log("üìù Built leftColumn from pairs:",r));const c=(n==null?void 0:n.correctPairs)||(n==null?void 0:n.correctAnswer);if(c){o+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',o+='<strong style="color: var(--secondary-color);">Correct Answer:</strong><br>';const k=Object.entries(c).map(([x,E])=>`${r[parseInt(x)]||x} ‚Üí ${E}`).join(", ");o+=`<span style="margin-top: 4px; display: block;">${k}</span>`,o+="</div>"}}else d==="ordering"&&(n!=null&&n.correctOrder)?(o+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',o+='<strong style="color: var(--secondary-color);">Correct Order:</strong><br>',o+=`<span style="margin-top: 4px; display: block;">${n.correctOrder.join(", ")}</span>`,o+="</div>"):d==="fill_blank"&&(n!=null&&n.correctAnswer)&&(o+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',o+='<strong style="color: var(--secondary-color);">Correct Answer:</strong><br>',o+=`<span style="margin-top: 4px; display: block;">${n.correctAnswer}</span>`,o+="</div>");o+='<details style="margin-top: 16px;">',o+='<summary style="cursor: pointer; color: var(--primary-color); font-weight: 500;">View individual responses</summary>',o+='<div style="margin-top: 12px; max-height: 300px; overflow-y: auto;">',o+='<table style="width: 100%; border-collapse: collapse;">',o+='<tr style="background: #F9FAFB;"><th style="text-align: left; padding: 8px;">Student</th><th style="text-align: left; padding: 8px;">Answer</th><th style="text-align: left; padding: 8px;">Time</th></tr>',l.forEach(r=>{let c;if(d==="multiple_choice"||d==="mcq"||d==="poll"){let x=r.answer;typeof x=="string"&&x.length===1&&x>="A"&&x<="Z"&&(x=x.charCodeAt(0)-65),c=v[x]||r.answer}else if(d==="boolean")c=r.answer==="true"||r.answer===!0?"True":"False";else if(d==="matching")if(typeof r.answer=="object"&&r.answer!==null){let x=(n==null?void 0:n.leftColumn)||[];x.length===0&&(n!=null&&n.pairs)&&Array.isArray(n.pairs)&&(x=n.pairs.map(E=>E.left)),console.log("üîç Processing matching answer:",{answer:r.answer,leftColumn:x,participantName:r.participantName}),c=Object.entries(r.answer).map(([E,O])=>{const A=x[parseInt(E)]||E;return console.log(`   Mapping: index=${E}, right=${O}, leftItem=${A}`),`${A} ‚Üí ${O}`}).join(", ")}else c=JSON.stringify(r.answer);else d==="ordering"&&Array.isArray(r.answer)?c=r.answer.join(", "):c=r.answer;const k=r.submittedAt?new Date(r.submittedAt).toLocaleTimeString():"N/A";o+=`
                        <tr style="border-bottom: 1px solid #E5E7EB;">
                            <td style="padding: 8px;">${r.participantName}</td>
                            <td style="padding: 8px;">${c}</td>
                            <td style="padding: 8px; color: var(--text-secondary);">${k}</td>
                        </tr>
                    `}),o+="</table></div></details>",o+="</div>"}o+="</div>",i.innerHTML=o}async function le(){var t;if(confirm("Are you sure you want to end this session?"))try{const e=((t=b==null?void 0:b.gamification)==null?void 0:t.enabled)&&(b==null?void 0:b.classId);let s;if(e?(w.debug("Ending session with gamification processing..."),s=await fetch(`https://api-modular.intellaclick.com/api/sessions-gamified/${C}/end-with-gamification`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})):(w.debug("Ending session (no gamification)..."),s=await fetch(`https://api-modular.intellaclick.com/api/sessions/${C}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({status:"ended"})})),!s.ok)throw new Error("Failed to end session");const i=await s.json();w.debug("Session ended:",i),e&&i.gamificationResults?g.success(`Session ended - ${i.gamificationResults.length} students earned points!`):g.success("Session ended"),J(),setTimeout(()=>window.location.href="classes.html",2e3)}catch(e){w.error("Error ending session:",e),g.error("Failed to end session")}}function ce(){R=setInterval(F,3e3)}function J(){R&&clearInterval(R)}function de(){const t=`display.html?id=${C}&code=${T}`;window.open(t,"IntellaClickDisplay","width=1920,height=1080,menubar=no,toolbar=no,location=no,status=no")}function pe(t){navigator.clipboard.writeText(t).then(()=>{g.success("Link copied to clipboard!")}).catch(e=>{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-999999px",document.body.appendChild(s),s.select();try{document.execCommand("copy"),g.success("Link copied to clipboard!")}catch{g.error("Failed to copy link")}document.body.removeChild(s)})}function ue(){const t=document.getElementById("sessionCode").textContent;navigator.clipboard.writeText(t).then(()=>{g.success("Session code copied!")}).catch(e=>{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-999999px",document.body.appendChild(s),s.select();try{document.execCommand("copy"),g.success("Session code copied!")}catch{g.error("Failed to copy code")}document.body.removeChild(s)})}function me(){const t=document.getElementById("modalQuestionText").value.trim(),e=document.getElementById("modalQuestionType").value;if(!t){g.error("Please enter a question");return}const s=parseInt(document.getElementById("modalTimeLimit").value)||60,i=parseInt(document.getElementById("modalPoints").value)||10,o=document.getElementById("modalAwardParticipation").checked;let a={text:t,type:e,timeLimit:s,points:i,awardParticipationPoints:o};switch(e){case"poll":const y=[],p=[];if(["A","B","C","D"].forEach(m=>{const r=document.getElementById(`modalOption${m}`);r&&r.value.trim()&&(y.push(m),p.push(r.value.trim()))}),y.length<2){g.error("Please provide at least 2 options");return}a.type="mcq",a.options=y,a.optionTexts=p,a.awardParticipationPoints=!0;break;case"mcq":const l=[],n=[];let h=null;if(["A","B","C","D"].forEach(m=>{const r=document.getElementById(`modalOption${m}`);if(r&&r.value.trim()){l.push(m),n.push(r.value.trim());const c=document.querySelector(`input[name="modalCorrect"][value="${m}"]`);c&&c.checked&&(h=m)}}),l.length<2){g.error("Please provide at least 2 options");return}a.options=l,a.optionTexts=n,a.correctAnswer=h;break;case"tf":a.options=["True","False"],a.correctAnswer=document.querySelector('input[name="modalTF"]:checked').value;break;case"matching":const d=[];for(let m=1;m<=3;m++){const r=document.getElementById(`modalMatch${m}Left`).value.trim(),c=document.getElementById(`modalMatch${m}Right`).value.trim();r&&c&&d.push({left:r,right:c})}if(d.length<2){g.error("Please provide at least 2 matching pairs");return}a.pairs=d;break;case"ordering":const v=[];for(let m=1;m<=4;m++){const r=document.getElementById(`modalOrder${m}`).value.trim();r&&v.push(r)}if(v.length<2){g.error("Please provide at least 2 items");return}a.correctOrder=v;break;case"fillblank":const u=document.getElementById("modalBlankAnswer").value.trim();if(!u){g.error("Please provide the correct answer");return}if(!t.includes("[blank]")){g.error("Please include [blank] in your question");return}a.correctAnswer=u;break}P!==null?(f[P]=a,P=null,g.success("Question updated")):(f.push(a),g.success("Question added to queue")),S(),_()}async function ge(){try{const t=await fetch("https://api-modular.intellaclick.com/api/quizzes",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load quizzes");const s=(await t.json()).quizzes||[],i=document.getElementById("quizList");s.length===0?(i.innerHTML='<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No quizzes found. <a href="saved-questions.html" style="color: var(--primary-color);">Create your first quiz</a></p>',document.getElementById("importBtn").disabled=!0):(i.innerHTML="",s.forEach(o=>{const a=document.createElement("div");a.className="quiz-item",a.innerHTML=`
                            <strong>${o.title}</strong><br>
                            <small style="color: var(--text-secondary);">${o.questionCount||0} questions ‚Ä¢ ${o.totalPoints||0} points</small>
                        `,a.onclick=()=>ye(o._id,a),i.appendChild(a)}))}catch(t){w.error("Error loading quizzes:",t);const e=document.getElementById("quizList");e.innerHTML='<p style="color: var(--danger-color); text-align: center; padding: 20px;">Failed to load quizzes. Please try again.</p>'}}function ye(t,e){N=t,document.querySelectorAll(".quiz-item").forEach(s=>{s.classList.remove("selected")}),e.classList.add("selected"),document.getElementById("importBtn").disabled=!1}async function he(){if(!N){g.error("Please select a quiz");return}try{const t=await fetch(`https://api-modular.intellaclick.com/api/quizzes/${N}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load quiz");const e=await t.json(),s=e.quiz||e;s.questions&&s.questions.length>0?(w.debug("üìã Applying question defaults to imported quiz:",Q),s.questions.forEach(i=>{const o=i.questionSnapshot||i,a=o.questionType||o.type||"mcq",y={text:o.questionText||i.text||"",type:a,options:o.options||[],correctAnswer:o.correctAnswer||0,timeLimit:o.timeLimit||i.timeLimit||Q.defaultTimeLimit,points:o.points||i.points||Q.defaultPoints,awardParticipationPoints:Q.defaultAwardParticipation};y.type==="matching"&&o.pairs&&(y.pairs=o.pairs,w.debug("üì¶ Imported matching question with pairs:",o.pairs)),y.type==="ordering"&&o.correctOrder&&(y.correctOrder=o.correctOrder,w.debug("üì¶ Imported ordering question with correctOrder:",o.correctOrder)),f.push(y)}),S(),D(),g.success(`Imported ${s.questions.length} questions from ${s.title}`)):g.error("Quiz has no questions")}catch(t){w.error("Error importing quiz:",t),g.error("Failed to import quiz")}}window.onclick=function(t){t.target.className==="modal"&&(t.target.style.display="none")};window.addEventListener("beforeunload",J);window.copySessionCode=ue;window.openDisplayView=de;window.showQuestionModal=ne;window.showImportModal=se;window.sendNextQuestion=oe;window.stopQuestion=ie;window.showResults=re;window.loadSession=F;window.endSession=le;window.closeQuestionModal=_;window.addQuestionToQueue=me;window.closeImportModal=D;window.importSelectedQuiz=he;window.copyJoinUrl=pe;window.updateModalOptions=H;
