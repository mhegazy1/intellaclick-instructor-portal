import{t as u}from"./toast-Cbd37M37.js";/* empty css               */import{l as x}from"./logger-CXzo1yMG.js";import{g as Y,a as ee}from"./questionPreview-BhPLn-7f.js";async function _(t,e="Text"){try{await navigator.clipboard.writeText(t),u.success(`${e} copied to clipboard!`)}catch{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-999999px",document.body.appendChild(s),s.select();try{document.execCommand("copy"),u.success(`${e} copied to clipboard!`)}catch{u.error(`Failed to copy ${e.toLowerCase()}`)}finally{document.body.removeChild(s)}}}const D=document.createElement("style");D.textContent=Y();document.head.appendChild(D);let k,T,v,te,y=[],C=-1,N,z=null,O={defaultTimeLimit:60,defaultPoints:10,defaultAwardParticipation:!1,defaultShowCorrectAnswer:!0,defaultAllowAnswerChange:!0};document.addEventListener("DOMContentLoaded",function(){const t=new URLSearchParams(window.location.search);if(k=t.get("id"),T=t.get("code"),t.get("type"),!k||!T){u.error("Invalid session parameters"),setTimeout(()=>window.location.href="classes.html",2e3);return}const e=sessionStorage.getItem("pendingQuestions");if(e){const o=JSON.parse(e);y.push(...o),sessionStorage.removeItem("pendingQuestions"),sessionStorage.removeItem("currentQuestionIndex"),Q()}else{const o=sessionStorage.getItem("pendingQuestion");if(o){const s=JSON.parse(o);y.push(s),sessionStorage.removeItem("pendingQuestion"),Q()}}if(y.length===0){const o=sessionStorage.getItem("questionQueue_"+T),s=sessionStorage.getItem("questionIndex_"+T);o&&(console.log("[Session] Restoring queue from sessionStorage"),y=JSON.parse(o),C=s?parseInt(s):-1,Q())}y.length===0&&(console.log("[Session] Attempting to restore queue from backend"),ne()),oe(),F(),ie(),Ie()});function oe(){localStorage.getItem("token")||(window.location.href="/login.html")}async function F(){try{const t=await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${T}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load session");v=(await t.json()).session,te=v.classId,x.debug("Session loaded:",{sessionId:k,sessionCode:T,sessionData:v,hasCurrentQuestion:!!v.currentQuestion}),se()}catch(t){x.error("Error loading session:",t),u.error("Failed to load session")}}async function ne(){try{const t=await fetch(`https://api-modular.intellaclick.com/api/sessions/${k}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok){console.error("[Session] Failed to fetch session data for queue restoration");return}const e=await t.json();e.success&&e.session.questionQueue&&e.session.questionQueue.length>0?(y=e.session.questionQueue,C=e.session.currentQuestionIndex??-1,console.log("[Session] Queue restored from backend:",{queueLength:y.length,currentIndex:C}),Q(),u.success(`Restored ${y.length} questions from previous session`)):console.log("[Session] No saved queue found in backend")}catch(t){console.error("[Session] Error restoring queue from backend:",t)}}async function R(){try{if(!(await fetch(`https://api-modular.intellaclick.com/api/sessions/${k}/question-queue`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({questionQueue:y,currentQuestionIndex:C})})).ok){console.error("[Session] Failed to save queue to backend");return}console.log("[Session] Queue saved to backend successfully")}catch(t){console.error("[Session] Error saving queue to backend:",t)}}async function ie(){try{const t=await fetch("https://api-modular.intellaclick.com/api/users/question-defaults",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});t.ok?(O=(await t.json()).defaults||O,document.getElementById("modalTimeLimit").value=O.defaultTimeLimit,document.getElementById("modalPoints").value=O.defaultPoints,document.getElementById("modalAwardParticipation").checked=O.defaultAwardParticipation,x.debug("‚úÖ Loaded question defaults:",O)):x.debug("No saved question defaults found, using system defaults")}catch(t){x.error("Error loading question defaults:",t)}}function se(){document.getElementById("sessionCode").textContent=v.sessionCode,document.getElementById("participantCount").textContent=v.participantCount||0;const t=`https://join.intellaclick.com/session/${v.sessionCode}`;document.getElementById("joinUrl").innerHTML=`
                <strong>Students can join at:</strong><br>
                <div style="display: flex; align-items: center; gap: 12px; margin: 8px 0;">
                    <span style="font-size: 16px; user-select: all; flex: 1;">${t}</span>
                    <button class="btn btn-secondary" onclick="copyJoinUrl('${t}')" style="padding: 6px 12px; font-size: 12px;">
                        Copy Link
                    </button>
                </div>
                <small style="color: var(--text-secondary); margin-top: 4px; display: block;">
                    Session ID: ${v.id||v._id}<br>
                    ${v.restrictToEnrolled===!1?"Open to all students":"Restricted to enrolled students only"}
                </small>
            `,ae(t);const e=document.getElementById("sessionStatus");e.textContent=v.status.charAt(0).toUpperCase()+v.status.slice(1),e.className=`status-badge status-${v.status}`,v.status==="active"&&v.currentQuestion&&(document.getElementById("stopBtn").disabled=!1,document.getElementById("resultsBtn").disabled=!1,J(v.currentQuestion)),re()}function re(){const t=document.getElementById("participantsList");fetch(`https://api-modular.intellaclick.com/api/sessions/${k}/participants`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>e.json()).then(e=>{e.participants&&e.participants.length>0?(t.innerHTML="",e.participants.forEach(o=>{const s=document.createElement("div");s.className="participant-card",s.innerHTML=`
                            <strong>${o.name||"Anonymous"}</strong><br>
                            <small style="color: var(--text-secondary);">
                                Joined: ${new Date(o.joinedAt).toLocaleTimeString()}<br>
                                ${o.isEnrolled?"Enrolled Student":"Guest"}
                            </small>
                        `,t.appendChild(s)})):t.innerHTML='<p style="color: var(--text-secondary);">No participants yet. Share the session code for students to join.</p>'}).catch(e=>{x.error("Error loading participants:",e)})}function ae(t){const e=document.getElementById("qrcode");e.innerHTML="";const o=document.createElement("canvas");QRCode.toCanvas(o,t,{width:400,margin:2,color:{dark:"#000000",light:"#FFFFFF"}},function(s){if(s){x.error("QR Code generation error:",s),e.innerHTML='<p style="color: var(--text-secondary);">QR Code generation failed</p>';return}o.style.width="200px",o.style.height="200px",e.appendChild(o)})}function Q(){const t=document.getElementById("queueList");sessionStorage.setItem("questionQueue_"+T,JSON.stringify(y)),sessionStorage.setItem("questionIndex_"+T,C.toString()),R(),y.length===0?(t.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions in queue. Create a new question or import from a quiz.</p>',document.getElementById("sendBtn").disabled=!0):(t.innerHTML="",y.forEach((e,o)=>{const s=document.createElement("div");s.className="question-item",s.style.padding="12px",s.style.marginBottom="8px",s.style.border="1px solid var(--border-color)",s.style.borderRadius="6px",s.style.backgroundColor="var(--bg-primary)";const n=document.createElement("div");n.style.display="flex",n.style.alignItems="flex-start",n.style.marginBottom="10px";const c=document.createElement("div");c.style.fontWeight="bold",c.style.marginRight="8px",c.style.minWidth="24px",c.style.color="var(--text-secondary)",c.textContent=`${o+1}.`;const p=document.createElement("div");if(p.style.flex="1",p.style.lineHeight="1.4",p.textContent=e.text||e.questionText,n.appendChild(c),n.appendChild(p),o>C){const l=document.createElement("div");l.style.display="flex",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.paddingTop="10px",l.style.borderTop="1px solid var(--border-color)";const a=document.createElement("div");a.style.display="grid",a.style.gridTemplateColumns="auto auto auto",a.style.gap="12px 20px",a.style.alignItems="center",a.style.fontSize="13px";const i=document.createElement("span");i.style.color="var(--text-secondary)",i.style.textAlign="right",i.style.minWidth="50px",i.textContent="Time:";const w=document.createElement("input");w.type="number",w.value=e.timeLimit||60,w.min=10,w.max=300,w.style.width="60px",w.style.padding="4px 8px",w.style.border="1px solid var(--border-color)",w.style.borderRadius="4px",w.style.fontSize="13px";const g=()=>{const L=parseInt(w.value)||60;e.timeLimit=L,console.log(`‚úèÔ∏è Updated question ${o+1} time limit:`,L,"Full question:",e),sessionStorage.setItem("questionQueue_"+T,JSON.stringify(y)),R()};w.onchange=g,w.onblur=g;const E=document.createElement("span");E.style.color="var(--text-secondary)",E.textContent="sec";const m=document.createElement("span");m.style.color="var(--text-secondary)",m.style.textAlign="right",m.style.minWidth="50px",m.textContent="Points:";const b=document.createElement("input");b.type="number",b.value=e.points||10,b.min=1,b.max=100,b.style.width="60px",b.style.padding="4px 8px",b.style.border="1px solid var(--border-color)",b.style.borderRadius="4px",b.style.fontSize="13px";const r=()=>{const L=parseInt(b.value)||10;e.points=L,console.log(`‚úèÔ∏è Updated question ${o+1} points:`,L,"Full question:",e),sessionStorage.setItem("questionQueue_"+T,JSON.stringify(y)),R()};b.onchange=r,b.onblur=r;const d=document.createElement("span");d.style.color="var(--text-secondary)",d.textContent="pts";const f=document.createElement("span");f.style.color="var(--text-secondary)",f.style.textAlign="right",f.style.minWidth="50px",f.textContent="Award:";const h=document.createElement("div");h.style.width="60px",h.style.display="flex",h.style.alignItems="center",h.style.paddingLeft="4px";const I=document.createElement("input");I.type="checkbox",I.checked=e.awardParticipationPoints||!1,I.style.cursor="pointer",I.style.width="16px",I.style.height="16px",I.style.margin="0",I.onchange=()=>{e.awardParticipationPoints=I.checked,console.log(`‚úèÔ∏è Updated question ${o+1} awardParticipationPoints:`,I.checked,"Full question:",e),sessionStorage.setItem("questionQueue_"+T,JSON.stringify(y)),R()},h.appendChild(I);const q=document.createElement("span");q.textContent="Participation points",a.appendChild(i),a.appendChild(w),a.appendChild(E),a.appendChild(m),a.appendChild(b),a.appendChild(d),a.appendChild(f),a.appendChild(h),a.appendChild(q);const M=document.createElement("div");M.style.display="flex",M.style.gap="6px",M.style.flexShrink="0";const B=document.createElement("button");B.className="btn btn-secondary",B.style.padding="6px 10px",B.style.fontSize="12px",B.style.minWidth="32px",B.innerHTML="‚Üë",B.title="Move up",o>C+1?B.onclick=()=>U(o,-1):(B.disabled=!0,B.style.opacity="0.3",B.style.cursor="not-allowed"),M.appendChild(B);const A=document.createElement("button");A.className="btn btn-secondary",A.style.padding="6px 10px",A.style.fontSize="12px",A.style.minWidth="32px",A.innerHTML="‚Üì",A.title="Move down",o<y.length-1?A.onclick=()=>U(o,1):(A.disabled=!0,A.style.opacity="0.3",A.style.cursor="not-allowed"),M.appendChild(A);const $=document.createElement("button");$.className="btn btn-secondary",$.style.padding="6px 12px",$.style.fontSize="12px",$.textContent="Edit",$.onclick=()=>de(o),M.appendChild($);const S=document.createElement("button");S.className="btn btn-secondary",S.style.padding="6px 12px",S.style.fontSize="12px",S.textContent="Remove",S.onclick=()=>le(o),M.appendChild(S),l.appendChild(a),l.appendChild(M),s.appendChild(n),s.appendChild(l)}else s.appendChild(n),s.style.opacity="0.6",s.style.backgroundColor="var(--bg-secondary)";t.appendChild(s)}),document.getElementById("sendBtn").disabled=!1)}function le(t){y.splice(t,1),Q()}function U(t,e){const o=t+e;if(o<=C||o>=y.length)return;const s=y[t];y[t]=y[o],y[o]=s,Q(),u.success("Question moved")}let P=null;function de(t){P=t;const e=y[t];document.getElementById("questionModal").style.display="block";let o=e.type||e.questionType||"mcq";o==="mcq"&&!e.correctAnswer&&e.correctAnswer!==0&&e.correctAnswer!==!1&&(e.options||e.optionTexts)&&(o="poll"),x.debug("Editing question:",{type:o,originalType:e.type,correctAnswer:e.correctAnswer,pairs:e.pairs,correctOrder:e.correctOrder,options:e.options||e.optionTexts}),document.getElementById("modalQuestionType").value=o,document.getElementById("modalQuestionText").value=e.text||e.questionText||"",document.getElementById("modalTimeLimit").value=e.timeLimit||60,document.getElementById("modalPoints").value=e.points||10,document.getElementById("modalAwardParticipation").checked=e.awardParticipationPoints||!1,setTimeout(()=>H(),10),setTimeout(()=>{switch(o){case"poll":if(e.options||e.optionTexts){const p=e.optionTexts||e.options;["A","B","C","D"].forEach((l,a)=>{const i=document.getElementById(`modalOption${l}`);i&&p[a]&&(i.value=p[a])})}break;case"mcq":if(e.optionTexts||e.options){const p=e.optionTexts||e.options;["A","B","C","D"].forEach((l,a)=>{const i=document.getElementById(`modalOption${l}`);if(i&&p[a]&&(i.value=p[a]),e.correctAnswer===l||e.correctAnswer===a){const w=document.querySelector(`input[name="modalCorrect"][value="${l}"]`);w&&(w.checked=!0)}})}break;case"tf":const n=e.correctAnswer==="true"||e.correctAnswer===!0?"true":"false",c=document.querySelector(`input[name="modalTF"][value="${n}"]`);c&&(c.checked=!0);break;case"matching":if(e.pairs){for(;window.modalMatchingCount<e.pairs.length&&window.modalMatchingCount<10;)V();e.pairs.forEach((p,l)=>{const a=document.getElementById(`modalMatch${l+1}Left`),i=document.getElementById(`modalMatch${l+1}Right`);a&&(a.value=p.left||""),i&&(i.value=p.right||"")})}break;case"ordering":if(e.correctOrder){for(;window.modalOrderingCount<e.correctOrder.length&&window.modalOrderingCount<10;)Z();e.correctOrder.forEach((p,l)=>{const a=document.getElementById(`modalOrder${l+1}`);a&&(a.value=p||"")})}break;case"fillblank":setTimeout(()=>{(Array.isArray(e.correctAnswer)?e.correctAnswer:[e.correctAnswer]).forEach((l,a)=>{const i=document.getElementById(`modalBlankAnswer${a+1}`);i&&(i.value=l)})},50);break}},100);const s=document.querySelector("#questionModal h2");s&&(s.textContent="Edit Question")}async function ce(){if(console.log("üöÄ SEND NEXT QUESTION CALLED:",{currentIndex:C,queueLength:y.length,willPassCheck:C+1<y.length,nextQuestion:y[C+1]}),C+1>=y.length){u.error("No more questions in queue");return}C++,sessionStorage.setItem("questionIndex_"+T,C.toString());const t=y[C];console.log("üîç QUESTION FROM QUEUE (before normalization):",{index:C,timeLimit:t.timeLimit,points:t.points,awardParticipationPoints:t.awardParticipationPoints,fullQuestion:t});const e={...t};console.log("üîç NORMALIZED QUESTION (after spread):",{timeLimit:e.timeLimit,points:e.points,awardParticipationPoints:e.awardParticipationPoints,fullQuestion:e}),delete e.type;const s={mcq:"multiple_choice",tf:"boolean",matching:"matching",ordering:"ordering",fillblank:"fill_blank"}[t.type]||t.type;if(e.questionType=s,e.type=s,e.questionText=t.text||t.questionText,t.type==="tf")e.options=["True","False"];else if(t.type==="mcq")t.optionTexts&&(e.options=t.options,e.optionTexts=t.optionTexts);else if(t.type==="matching"){e.pairs=t.pairs||[];const n=e.pairs.map(p=>p.right),c=n.sort(()=>Math.random()-.5);e.shuffledMatchingRight=c,console.log("üé≤ MATCHING SHUFFLE DEBUG:",{originalPairs:e.pairs,originalRight:n,shuffledRight:c})}else if(t.type==="ordering"){e.correctOrder=t.correctOrder||[];const n=[...e.correctOrder].sort(()=>Math.random()-.5);e.shuffledOrderingItems=n,console.log("üé≤ ORDERING SHUFFLE DEBUG:",{originalOrder:e.correctOrder,shuffledItems:n})}else t.type==="fillblank"&&(e.correctAnswer=t.correctAnswer||"");console.log("üì§ SENDING QUESTION TO BACKEND:",{sessionId:k,questionType:e.questionType,type:e.type,timeLimit:e.timeLimit,points:e.points,awardParticipationPoints:e.awardParticipationPoints,shuffledMatchingRight:e.shuffledMatchingRight,shuffledOrderingItems:e.shuffledOrderingItems,fullQuestion:e}),x.debug("Sending question:",{sessionId:k,endpoint:`https://api-modular.intellaclick.com/api/sessions/${k}/questions`,questionData:e,hasQuestionText:!!e.questionText,questionType:e.questionType}),console.log("üåê MAKING FETCH REQUEST:",{url:`https://api-modular.intellaclick.com/api/sessions/${k}/questions`,method:"POST",timeLimit:e.timeLimit,points:e.points});try{const n=await fetch(`https://api-modular.intellaclick.com/api/sessions/${k}/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(e)});if(console.log("üì° FETCH RESPONSE:",{status:n.status,ok:n.ok}),!n.ok){const p=await n.json();throw console.log("‚ùå FETCH ERROR:",p),x.error("API Error:",{status:n.status,error:p}),new Error(p.error||"Failed to send question")}const c=await n.json();console.log("‚úÖ FETCH SUCCESS:",c),x.debug("Question sent successfully:",c),u.success("Question sent successfully!"),document.getElementById("stopBtn").disabled=!1,document.getElementById("resultsBtn").disabled=!1,J(t),Q(),setTimeout(async()=>{await F()},500)}catch(n){x.error("Error sending question:",n),n.name==="TypeError"&&n.message==="Failed to fetch"?(u.error("Network error: Unable to reach the API server. This may be a CORS issue."),x.error("CORS Error Details:",{error:n,message:"The API server may need to add instructor.intellaclick.com to its allowed origins",currentOrigin:window.location.origin,apiUrl:"https://api-modular.intellaclick.com"}),window.confirm(`Network error detected. This is likely a CORS configuration issue.

The backend needs to add instructor.intellaclick.com to its allowed origins.

Click OK to open the CORS test page for more details.`)&&window.open("/cors-test.html","_blank")):u.error(n.message||"Failed to send question"),C--}}function J(t){document.getElementById("currentQuestionSection").style.display="block";const e=t.type||t.questionType,o=t.text||t.questionText||"";x.debug("üì∫ DISPLAYING QUESTION IN SESSION CONTROL:",{questionType:e,questionText:o,hasPairs:!!t.pairs,pairs:t.pairs,hasCorrectOrder:!!t.correctOrder,correctOrder:t.correctOrder,fullQuestion:t});let s=o;(e==="fillblank"||e==="fill_blank")&&(s=s.replace(/\[blank\]/gi,'<span style="display: inline-block; min-width: 100px; border-bottom: 2px solid #4F46E5; margin: 0 6px; height: 1.2em; vertical-align: bottom;"></span>')),document.getElementById("questionText").innerHTML=s;const n=document.getElementById("questionOptions");if(n.innerHTML="",(e==="mcq"||e==="multiple_choice")&&(t.optionTexts||t.options)){const c=t.optionTexts||t.options;(t.options&&t.optionTexts?t.options:["A","B","C","D"]).forEach((l,a)=>{if(c[a]){const i=document.createElement("div");i.style.marginTop="8px",i.textContent=`${l}: ${c[a]}`,n.appendChild(i)}})}else if(e==="tf"||e==="boolean")n.innerHTML='<div style="margin-top: 8px;">A: True</div><div style="margin-top: 8px;">B: False</div>';else if(e==="matching"&&t.pairs){if(n.innerHTML="<strong>Match the following:</strong>",t.pairs.forEach((c,p)=>{const l=document.createElement("div");l.style.marginTop="8px",l.textContent=`${p+1}. ${c.left} ‚Üí ?`,n.appendChild(l)}),t.shuffledMatchingRight){const c=document.createElement("div");c.style.marginTop="12px",c.innerHTML="<strong>Options to match:</strong>",t.shuffledMatchingRight.forEach((p,l)=>{const a=document.createElement("div");a.style.marginTop="4px",a.textContent=`${String.fromCharCode(65+l)}. ${p}`,c.appendChild(a)}),n.appendChild(c)}}else(e==="ordering"||e==="ordering")&&t.correctOrder&&(n.innerHTML="<strong>Put in correct order:</strong>",(t.shuffledOrderingItems||t.correctOrder).forEach((p,l)=>{const a=document.createElement("div");a.style.marginTop="8px",a.textContent=`${String.fromCharCode(65+l)}. ${p}`,n.appendChild(a)}))}function pe(){document.getElementById("questionModal").style.display="block",H()}function G(){document.getElementById("questionModal").style.display="none",document.getElementById("modalQuestionText").value="",document.getElementById("modalQuestionType").value="mcq",P=null;const t=document.querySelector("#questionModal h2");t&&(t.textContent="Create Question"),window.modalMatchingCount=3,window.modalOrderingCount=4}function ue(){const t=document.getElementById("modalQuestionText").value.trim();if(!t){u.error("Please enter question text first");return}const e=document.getElementById("modalQuestionType").value,o=parseInt(document.getElementById("modalTimeLimit").value),s=parseInt(document.getElementById("modalPoints").value);let n={text:t,type:e,timeLimit:o,points:s};if(e==="mcq"||e==="poll"){const p=document.querySelectorAll('#modalQuestionOptions input[type="text"]');n.options=Array.from(p).map(l=>l.value.trim()).filter(l=>l)}else if(e==="matching"){const p=[],l=[];for(let a=1;a<=10;a++){const i=document.getElementById(`modalMatch${a}Left`),w=document.getElementById(`modalMatch${a}Right`);i&&i.value.trim()&&p.push(i.value.trim()),w&&w.value.trim()&&l.push(w.value.trim())}n.matching={items:p,matches:l}}else if(e==="ordering"){const p=[];for(let l=1;l<=10;l++){const a=document.getElementById(`modalOrder${l}`);a&&a.value.trim()&&p.push(a.value.trim())}n.ordering=p}const c=ee(n);document.getElementById("questionPreviewBody").innerHTML=c,document.getElementById("questionPreviewModal").classList.add("active")}function W(){document.getElementById("questionPreviewModal").classList.remove("active")}function V(){if(window.modalMatchingCount||(window.modalMatchingCount=3),window.modalMatchingCount>=10){u.error("Maximum 10 pairs allowed");return}window.modalMatchingCount++;const t=document.getElementById("modalMatchingContainer"),e=window.modalMatchingCount,o=document.createElement("input");o.type="text",o.id=`modalMatch${e}Left`,o.placeholder=`Item ${e}`;const s=document.createElement("input");s.type="text",s.id=`modalMatch${e}Right`,s.placeholder=`Match ${e}`,t.appendChild(o),t.appendChild(s)}function me(){if(window.modalMatchingCount||(window.modalMatchingCount=3),window.modalMatchingCount<=2){u.error("Minimum 2 pairs required");return}document.getElementById("modalMatchingContainer");const t=window.modalMatchingCount,e=document.getElementById(`modalMatch${t}Left`),o=document.getElementById(`modalMatch${t}Right`);e&&e.remove(),o&&o.remove(),window.modalMatchingCount--}function Z(){if(window.modalOrderingCount||(window.modalOrderingCount=4),window.modalOrderingCount>=10){u.error("Maximum 10 items allowed");return}window.modalOrderingCount++;const t=document.getElementById("modalOrderingContainer"),e=window.modalOrderingCount,o=document.createElement("input");o.type="text",o.id=`modalOrder${e}`,o.placeholder=ye(e)+" item",o.style.marginBottom="8px",o.style.width="100%",t.appendChild(o)}function ge(){if(window.modalOrderingCount||(window.modalOrderingCount=4),window.modalOrderingCount<=2){u.error("Minimum 2 items required");return}document.getElementById("modalOrderingContainer");const t=window.modalOrderingCount,e=document.getElementById(`modalOrder${t}`);e&&e.remove(),window.modalOrderingCount--}function ye(t){const e=["th","st","nd","rd"],o=t%100;return t+(e[(o-20)%10]||e[o]||e[0])}window.previewModalQuestion=ue;window.closePreviewModal=W;window.addModalMatchingPair=V;window.removeModalMatchingPair=me;window.addModalOrderingItem=Z;window.removeModalOrderingItem=ge;document.addEventListener("keydown",t=>{if(t.key==="Escape"){const e=document.getElementById("questionPreviewModal");e&&e.classList.contains("active")&&W()}});function he(){document.getElementById("importModal").style.display="block",Me()}function K(){document.getElementById("importModal").style.display="none",z=null}function H(){const t=document.getElementById("modalQuestionType").value,e=document.getElementById("modalQuestionOptions"),o=document.getElementById("modalInsertBlankBtn");switch(t==="fillblank"?o.style.display="block":o.style.display="none",t){case"poll":e.innerHTML=`
                        <label>Poll Options (no correct answer - all answers award participation points)</label>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionA" placeholder="Option A" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionB" placeholder="Option B" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionC" placeholder="Option C" style="width: 100%; margin-bottom: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="text" id="modalOptionD" placeholder="Option D" style="width: 100%;">
                        </div>
                        <small style="display: block; margin-top: 8px; color: var(--text-secondary);">
                            üí° Poll questions have no correct answer. All students who answer receive participation points.
                        </small>
                    `;break;case"mcq":e.innerHTML=`
                        <label>Answer Options (select correct answer)</label>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="A" checked>
                            <input type="text" id="modalOptionA" placeholder="Option A" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="B">
                            <input type="text" id="modalOptionB" placeholder="Option B" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="C">
                            <input type="text" id="modalOptionC" placeholder="Option C" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalCorrect" value="D">
                            <input type="text" id="modalOptionD" placeholder="Option D" style="width: calc(100% - 30px); margin-left: 8px;">
                        </div>
                    `;break;case"tf":e.innerHTML=`
                        <label>Correct Answer</label>
                        <div style="margin-top: 8px;">
                            <input type="radio" name="modalTF" value="true" checked> True
                            <input type="radio" name="modalTF" value="false" style="margin-left: 20px;"> False
                        </div>
                    `;break;case"matching":e.innerHTML=`
                        <label>Matching Pairs</label>
                        <div id="modalMatchingContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
                            <input type="text" placeholder="Item 1" id="modalMatch1Left">
                            <input type="text" placeholder="Match 1" id="modalMatch1Right">
                            <input type="text" placeholder="Item 2" id="modalMatch2Left">
                            <input type="text" placeholder="Match 2" id="modalMatch2Right">
                            <input type="text" placeholder="Item 3" id="modalMatch3Left">
                            <input type="text" placeholder="Match 3" id="modalMatch3Right">
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addModalMatchingPair()">+ Add Pair</button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="removeModalMatchingPair()">- Remove Last</button>
                        </div>
                    `,window.modalMatchingCount=3;break;case"ordering":e.innerHTML=`
                        <label>Items in Correct Order</label>
                        <div id="modalOrderingContainer" style="margin-top: 8px;">
                            <input type="text" placeholder="1st item" id="modalOrder1" style="margin-bottom: 8px; width: 100%;">
                            <input type="text" placeholder="2nd item" id="modalOrder2" style="margin-bottom: 8px; width: 100%;">
                            <input type="text" placeholder="3rd item" id="modalOrder3" style="margin-bottom: 8px; width: 100%;">
                            <input type="text" placeholder="4th item" id="modalOrder4" style="width: 100%;">
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="addModalOrderingItem()">+ Add Item</button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="removeModalOrderingItem()">- Remove Last</button>
                        </div>
                    `,window.modalOrderingCount=4;break;case"fillblank":e.innerHTML=`
                        <label>Correct Answer(s)</label>
                        <div id="modalBlankAnswersContainer" style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                            <!-- Answer fields will be added dynamically based on number of [blank] tags -->
                        </div>
                        <small style="display: block; margin-top: 8px; color: var(--text-secondary);">Click "Insert [blank]" button above to add blanks to your question. An answer field will appear for each blank.</small>
                    `,j();break}}function fe(){const t=document.getElementById("modalQuestionText"),e=t.selectionStart,o=t.selectionEnd,s=t.value,n=s.substring(0,e)+"[blank]"+s.substring(o);t.value=n,t.selectionStart=t.selectionEnd=e+7,t.focus(),document.getElementById("modalQuestionType").value==="fillblank"&&j()}function j(){const e=(document.getElementById("modalQuestionText").value.match(/\[blank\]/gi)||[]).length,o=document.getElementById("modalBlankAnswersContainer");if(o){if(o.innerHTML="",e===0){o.innerHTML='<small style="color: var(--text-secondary);">No blanks found. Click "Insert [blank]" button to add blanks to your question.</small>';return}for(let s=0;s<e;s++){const n=document.createElement("input");n.type="text",n.id=`modalBlankAnswer${s+1}`,n.placeholder=`Answer for blank ${s+1}`,n.style.marginTop="0",n.style.width="100%",o.appendChild(n)}}}async function we(){var t;try{const e=((t=v.currentQuestion)==null?void 0:t.questionId)||"current";if(!(await fetch(`https://api-modular.intellaclick.com/api/sessions/${k}/questions/${e}/end`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to stop question");u.success("Question stopped"),document.getElementById("currentQuestionSection").style.display="none",await F()}catch(e){x.error("Error stopping question:",e),u.error("Failed to stop question")}}async function xe(){var t,e;try{const s=await(await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${T}/responses`)).json();if(!s.success){u.error("Failed to load results");return}const c=await(await fetch(`https://api-modular.intellaclick.com/api/sessions/code/${T}`)).json();console.log("üìä Results data:",{responses:s.responses,responsesByQuestion:s.responsesByQuestion,sessionQuestions:(t=c.session)==null?void 0:t.questions,currentQuestion:(e=c.session)==null?void 0:e.currentQuestion}),document.getElementById("responsesSection").style.display="block",be(s.responses,s.responsesByQuestion,c.session),document.getElementById("responsesSection").scrollIntoView({behavior:"smooth"})}catch(o){console.error("Error fetching results:",o),u.error("Failed to load results")}}function be(t,e,o){var c,p;const s=document.getElementById("responseChart");if(!t||t.length===0){s.innerHTML='<p style="color: var(--text-secondary); text-align: center; padding: 40px;">No responses yet</p>';return}let n="<h3>Session Results Summary</h3>";n+=`<p style="margin-bottom: 20px; color: var(--text-secondary);">Total Responses: ${t.length}</p>`,n+='<div style="padding-bottom: 20px;">';for(const[l,a]of Object.entries(e)){let i=(c=o==null?void 0:o.questions)==null?void 0:c.find(r=>{var d;return((d=r._id)==null?void 0:d.toString())===l||r.questionId===l||r.id===l});if(!i&&(o!=null&&o.questionQueue)&&(i=o.questionQueue.find(r=>{var d;return((d=r._id)==null?void 0:d.toString())===l||r.questionId===l||r.id===l})),!i&&(o!=null&&o.currentQuestion)){const r=o.currentQuestion;(((p=r._id)==null?void 0:p.toString())===l||r.questionId===l||r.id===l)&&(i=r)}if(!i&&a.length>0){const r=t.find(d=>d.questionId===l);r&&(i=r.questionData||r.question||r.questionDetails)}console.log("üîç Question lookup:",{questionId:l,questionsArray:o==null?void 0:o.questions,questionQueue:o==null?void 0:o.questionQueue,foundQuestion:i,firstResponse:a[0],fullResponse:t.find(r=>r.questionId===l)});const w=(i==null?void 0:i.text)||(i==null?void 0:i.questionText)||"Question text not found",g=(i==null?void 0:i.type)||(i==null?void 0:i.questionType)||"unknown",E=(i==null?void 0:i.options)||[];let m=i==null?void 0:i.correctAnswer;typeof m=="string"&&m.length===1&&m>="A"&&m<="Z"?m=m.charCodeAt(0)-65:g==="boolean"&&typeof m=="string"&&(m==="true"||m==="True"?m=0:(m==="false"||m==="False")&&(m=1)),n+=`
                    <div style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="margin-bottom: 16px; word-wrap: break-word;">${w}</h4>
                        <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                            ${a.length} response${a.length!==1?"s":""}
                        </p>
                `;const b={};if(a.forEach(r=>{let d=r.answer;typeof d=="string"&&d.length===1&&d>="A"&&d<="Z"?d=d.charCodeAt(0)-65:g==="boolean"&&(d==="true"||d===!0?d=0:(d==="false"||d===!1)&&(d=1)),b[d]=(b[d]||0)+1}),console.log("üìä Answer counting:",{questionId:l,questionResponses:a,answerCounts:b,options:E,questionType:g}),(g==="multiple_choice"||g==="mcq"||g==="poll"||g==="boolean")&&(n+='<div style="margin-bottom: 20px;">',E.forEach((r,d)=>{const f=b[d]||0,h=Math.round(f/a.length*100)||0,q=(g==="multiple_choice"||g==="mcq")&&m===d;n+=`
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <span style="font-weight: 500;">
                                        ${r} ${q?'<span style="color: var(--secondary-color);">‚úì Correct</span>':""}
                                    </span>
                                    <span style="color: var(--text-secondary);">${f} (${h}%)</span>
                                </div>
                                <div style="background: #E5E7EB; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: ${q?"var(--secondary-color)":"var(--primary-color)"}; height: 100%; width: ${h}%; transition: width 0.3s;"></div>
                                </div>
                            </div>
                        `}),n+="</div>"),g==="multiple_choice"||g==="mcq")console.log("üîç MCQ correct answer check:",{questionType:g,correctAnswer:m,options:E,hasCorrectAnswer:m!==void 0,optionAtIndex:E[m]}),m!==void 0&&E[m]&&(n+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',n+='<strong style="color: var(--secondary-color);">Correct Answer:</strong> ',n+=`<span>${E[m]}</span>`,n+="</div>");else if(g==="boolean")console.log("üîç Boolean correct answer check:",{questionType:g,correctAnswer:m,options:E,hasCorrectAnswer:m!==void 0,optionAtIndex:E[m]}),m!==void 0&&E[m]&&(n+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',n+='<strong style="color: var(--secondary-color);">Correct Answer:</strong> ',n+=`<span>${E[m]}</span>`,n+="</div>");else if(g==="matching"){console.log("üîç Matching question debug:",{question:i,pairs:i==null?void 0:i.pairs,leftColumn:i==null?void 0:i.leftColumn,rightColumn:i==null?void 0:i.rightColumn,correctPairs:i==null?void 0:i.correctPairs,correctAnswer:i==null?void 0:i.correctAnswer});let r=(i==null?void 0:i.leftColumn)||[];r.length===0&&(i!=null&&i.pairs)&&Array.isArray(i.pairs)&&(r=i.pairs.map(f=>f.left),console.log("üìù Built leftColumn from pairs:",r));const d=(i==null?void 0:i.correctPairs)||(i==null?void 0:i.correctAnswer);if(d){n+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',n+='<strong style="color: var(--secondary-color);">Correct Answer:</strong><br>';const f=Object.entries(d).map(([h,I])=>`${r[parseInt(h)]||h} ‚Üí ${I}`).join(", ");n+=`<span style="margin-top: 4px; display: block;">${f}</span>`,n+="</div>"}}else g==="ordering"&&(i!=null&&i.correctOrder)?(n+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',n+='<strong style="color: var(--secondary-color);">Correct Order:</strong><br>',n+=`<span style="margin-top: 4px; display: block;">${i.correctOrder.join(", ")}</span>`,n+="</div>"):g==="fill_blank"&&(i!=null&&i.correctAnswer)&&(n+='<div style="background: #F0FDF4; border-left: 4px solid var(--secondary-color); padding: 12px; margin-bottom: 16px; border-radius: 4px;">',n+='<strong style="color: var(--secondary-color);">Correct Answer:</strong><br>',n+=`<span style="margin-top: 4px; display: block;">${i.correctAnswer}</span>`,n+="</div>");n+='<details style="margin-top: 16px;">',n+='<summary style="cursor: pointer; color: var(--primary-color); font-weight: 500;">View individual responses</summary>',n+='<div style="margin-top: 12px; max-height: 300px; overflow-y: auto;">',n+='<table style="width: 100%; border-collapse: collapse;">',n+='<tr style="background: #F9FAFB;"><th style="text-align: left; padding: 8px;">Student</th><th style="text-align: left; padding: 8px;">Answer</th><th style="text-align: left; padding: 8px;">Time</th></tr>',a.forEach(r=>{let d;if(g==="multiple_choice"||g==="mcq"||g==="poll"){let h=r.answer;typeof h=="string"&&h.length===1&&h>="A"&&h<="Z"&&(h=h.charCodeAt(0)-65),d=E[h]||r.answer}else if(g==="boolean")d=r.answer==="true"||r.answer===!0?"True":"False";else if(g==="matching")if(typeof r.answer=="object"&&r.answer!==null){let h=(i==null?void 0:i.leftColumn)||[];h.length===0&&(i!=null&&i.pairs)&&Array.isArray(i.pairs)&&(h=i.pairs.map(I=>I.left)),console.log("üîç Processing matching answer:",{answer:r.answer,leftColumn:h,participantName:r.participantName}),d=Object.entries(r.answer).map(([I,q])=>{const M=h[parseInt(I)]||I;return console.log(`   Mapping: index=${I}, right=${q}, leftItem=${M}`),`${M} ‚Üí ${q}`}).join(", ")}else d=JSON.stringify(r.answer);else g==="ordering"&&Array.isArray(r.answer)?d=r.answer.join(", "):d=r.answer;const f=r.submittedAt?new Date(r.submittedAt).toLocaleTimeString():"N/A";n+=`
                        <tr style="border-bottom: 1px solid #E5E7EB;">
                            <td style="padding: 8px;">${r.participantName}</td>
                            <td style="padding: 8px;">${d}</td>
                            <td style="padding: 8px; color: var(--text-secondary);">${f}</td>
                        </tr>
                    `}),n+="</table></div></details>",n+="</div>"}n+="</div>",s.innerHTML=n}async function ve(){var t;if(confirm("Are you sure you want to end this session?"))try{const e=((t=v==null?void 0:v.gamification)==null?void 0:t.enabled)&&(v==null?void 0:v.classId);let o;if(e?(x.debug("Ending session with gamification processing..."),o=await fetch(`https://api-modular.intellaclick.com/api/sessions-gamified/${k}/end-with-gamification`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})):(x.debug("Ending session (no gamification)..."),o=await fetch(`https://api-modular.intellaclick.com/api/sessions/${k}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({status:"ended"})})),!o.ok)throw new Error("Failed to end session");const s=await o.json();x.debug("Session ended:",s),e&&s.gamificationResults?u.success(`Session ended - ${s.gamificationResults.length} students earned points!`):u.success("Session ended"),X(),setTimeout(()=>window.location.href="classes.html",2e3)}catch(e){x.error("Error ending session:",e),u.error("Failed to end session")}}function Ie(){N=setInterval(F,3e3)}function X(){N&&clearInterval(N)}function Ee(){const t=`display.html?id=${k}&code=${T}`;window.open(t,"IntellaClickDisplay","width=1920,height=1080,menubar=no,toolbar=no,location=no,status=no")}function Ce(t){_(t,"Join link")}function ke(){const t=document.getElementById("sessionCode").textContent;_(t,"Session code")}function Te(){const t=document.getElementById("modalQuestionText").value.trim(),e=document.getElementById("modalQuestionType").value;if(!t){u.error("Please enter a question");return}const o=parseInt(document.getElementById("modalTimeLimit").value)||60,s=parseInt(document.getElementById("modalPoints").value)||10,n=document.getElementById("modalAwardParticipation").checked;let c={text:t,type:e,timeLimit:o,points:s,awardParticipationPoints:n};switch(e){case"poll":const p=[],l=[];if(["A","B","C","D"].forEach(r=>{const d=document.getElementById(`modalOption${r}`);d&&d.value.trim()&&(p.push(r),l.push(d.value.trim()))}),p.length<2){u.error("Please provide at least 2 options");return}c.type="mcq",c.options=p,c.optionTexts=l,c.awardParticipationPoints=!0;break;case"mcq":const a=[],i=[];let w=null;if(["A","B","C","D"].forEach(r=>{const d=document.getElementById(`modalOption${r}`);if(d&&d.value.trim()){a.push(r),i.push(d.value.trim());const f=document.querySelector(`input[name="modalCorrect"][value="${r}"]`);f&&f.checked&&(w=r)}}),a.length<2){u.error("Please provide at least 2 options");return}c.options=a,c.optionTexts=i,c.correctAnswer=w;break;case"tf":c.options=["True","False"],c.correctAnswer=document.querySelector('input[name="modalTF"]:checked').value;break;case"matching":const g=[];for(let r=1;r<=10;r++){const d=document.getElementById(`modalMatch${r}Left`),f=document.getElementById(`modalMatch${r}Right`);if(d&&f){const h=d.value.trim(),I=f.value.trim();h&&I&&g.push({left:h,right:I})}}if(g.length<2){u.error("Please provide at least 2 matching pairs");return}c.pairs=g;break;case"ordering":const E=[];for(let r=1;r<=10;r++){const d=document.getElementById(`modalOrder${r}`);if(d){const f=d.value.trim();f&&E.push(f)}}if(E.length<2){u.error("Please provide at least 2 items");return}c.correctOrder=E;break;case"fillblank":const m=(t.match(/\[blank\]/gi)||[]).length;if(m===0){u.error("Please include at least one [blank] in your question");return}const b=[];for(let r=1;r<=m;r++){const d=document.getElementById(`modalBlankAnswer${r}`),f=d?d.value.trim():"";if(!f){u.error(`Please provide answer for blank ${r}`);return}b.push(f)}c.correctAnswer=b.length===1?b[0]:b;break}P!==null?(y[P]=c,P=null,u.success("Question updated")):(y.push(c),u.success("Question added to queue")),Q(),G()}async function Me(){try{const t=await fetch("https://api-modular.intellaclick.com/api/quizzes",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load quizzes");const o=(await t.json()).quizzes||[],s=document.getElementById("quizList");o.length===0?(s.innerHTML='<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No quizzes found. <a href="saved-questions.html" style="color: var(--primary-color);">Create your first quiz</a></p>',document.getElementById("importBtn").disabled=!0):(s.innerHTML="",o.forEach(n=>{const c=document.createElement("div");c.className="quiz-item",c.innerHTML=`
                            <strong>${n.title}</strong><br>
                            <small style="color: var(--text-secondary);">${n.questionCount||0} questions ‚Ä¢ ${n.totalPoints||0} points</small>
                        `,c.onclick=()=>Be(n._id,c),s.appendChild(c)}))}catch(t){x.error("Error loading quizzes:",t);const e=document.getElementById("quizList");e.innerHTML='<p style="color: var(--danger-color); text-align: center; padding: 20px;">Failed to load quizzes. Please try again.</p>'}}function Be(t,e){z=t,document.querySelectorAll(".quiz-item").forEach(o=>{o.classList.remove("selected")}),e.classList.add("selected"),document.getElementById("importBtn").disabled=!1}async function Ae(){if(!z){u.error("Please select a quiz");return}try{const t=await fetch(`https://api-modular.intellaclick.com/api/quizzes/${z}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to load quiz");const e=await t.json(),o=e.quiz||e;o.questions&&o.questions.length>0?(x.debug("üìã Applying question defaults to imported quiz:",O),o.questions.forEach(s=>{const n=s.questionSnapshot||s,c=n.questionType||n.type||"mcq",p={text:n.questionText||s.text||"",type:c,options:n.options||[],correctAnswer:n.correctAnswer||0,timeLimit:n.timeLimit||s.timeLimit||O.defaultTimeLimit,points:n.points||s.points||O.defaultPoints,awardParticipationPoints:O.defaultAwardParticipation};p.type==="matching"&&n.pairs&&(p.pairs=n.pairs,x.debug("üì¶ Imported matching question with pairs:",n.pairs)),p.type==="ordering"&&n.correctOrder&&(p.correctOrder=n.correctOrder,x.debug("üì¶ Imported ordering question with correctOrder:",n.correctOrder)),y.push(p)}),Q(),K(),u.success(`Imported ${o.questions.length} questions from ${o.title}`)):u.error("Quiz has no questions")}catch(t){x.error("Error importing quiz:",t),u.error("Failed to import quiz")}}window.onclick=function(t){t.target.className==="modal"&&(t.target.style.display="none")};window.addEventListener("beforeunload",X);window.copySessionCode=ke;window.openDisplayView=Ee;window.showQuestionModal=pe;window.showImportModal=he;window.sendNextQuestion=ce;window.stopQuestion=we;window.showResults=xe;window.loadSession=F;window.endSession=ve;window.closeQuestionModal=G;window.addQuestionToQueue=Te;window.closeImportModal=K;window.importSelectedQuiz=Ae;window.copyJoinUrl=Ce;window.updateModalOptions=H;window.insertModalBlank=fe;window.updateModalBlankAnswerFields=j;
