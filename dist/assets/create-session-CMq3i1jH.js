import{t as r}from"./toast-93yYkT8V.js";/* empty css               *//* empty css                       */import{c as x,s as P}from"./api-Dxj3jBlT.js";import{l as i}from"./logger-gSLuc3Ra.js";let q,p,k=null,u=[],f=4,y=4,h=4,w=4;document.addEventListener("DOMContentLoaded",function(){if(q=new URLSearchParams(window.location.search).get("classId"),!q){window.location.href="classes.html";return}Q(),J(),S(4),B(4),C(4),A(4),document.getElementById("sessionForm").addEventListener("submit",Z),G();const t=sessionStorage.getItem("fromSavedSet"),o=sessionStorage.getItem("pendingQuestions");i.debug("🔵 Page loaded - checking for pending questions"),i.debug("fromSavedSet:",t),i.debug("pendingQuestions:",o?"exists":"none"),t==="true"&&o&&(i.debug("✅ Auto-selecting Quick Poll mode"),setTimeout(()=>{z("quick")},500))});function Q(){localStorage.getItem("token")||(window.location.href="login.html")}function S(e){f=e;const t=document.getElementById("mcqOptionsContainer");t.innerHTML="";for(let o=0;o<e;o++){const n=String.fromCharCode(65+o),s=document.createElement("div");s.className="radio-option",s.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${n}" ${o===0?"checked":""}>
                    <input type="text" id="option${n}" placeholder="Option ${n}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,t.appendChild(s)}}function B(e){y=e;const t=document.getElementById("pollOptionsContainer");t.innerHTML="";for(let o=0;o<e;o++){const n=String.fromCharCode(65+o),s=document.createElement("input");s.type="text",s.id=`pollOption${n}`,s.placeholder=`Option ${n}`,s.style.width="100%",t.appendChild(s)}}function L(){if(f>=26){r.error("Maximum 26 options allowed");return}f++,S(f)}function M(){if(f<=2){r.error("Minimum 2 options required");return}f--,S(f)}function N(){if(y>=26){r.error("Maximum 26 options allowed");return}y++,B(y)}function R(){if(y<=2){r.error("Minimum 2 options required");return}y--,B(y)}function C(e){h=e;const t=document.getElementById("matchingPairsContainer");t.innerHTML="";for(let o=0;o<e;o++){const n=o+1,s=document.createElement("input");s.type="text",s.id=`match${n}Left`,s.placeholder=`Item ${n}`,s.style.width="100%";const a=document.createElement("input");a.type="text",a.id=`match${n}Right`,a.placeholder=`Match ${n}`,a.style.width="100%",t.appendChild(s),t.appendChild(a)}}function D(){if(h>=10){r.error("Maximum 10 pairs allowed");return}h++,C(h)}function F(){if(h<=2){r.error("Minimum 2 pairs required");return}h--,C(h)}function A(e){w=e;const t=document.getElementById("orderingItemsContainer");t.innerHTML="";for(let o=0;o<e;o++){const n=o+1,s=document.createElement("input");s.type="text",s.id=`order${n}`,s.placeholder=`${j(n)} item`,s.style.width="100%",t.appendChild(s)}}function H(){if(w>=10){r.error("Maximum 10 items allowed");return}w++,A(w)}function U(){if(w<=2){r.error("Minimum 2 items required");return}w--,A(w)}function j(e){const t=["th","st","nd","rd"],o=e%100;return e+(t[(o-20)%10]||t[o]||t[0])}async function G(){try{const e=await fetch("https://api.intellaclick.com/api/users/session-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const o=(await e.json()).settings;o.allowAnonymous!==void 0&&(document.getElementById("allowAnonymous").checked=o.allowAnonymous),o.openToAll!==void 0&&(document.getElementById("openToAll").checked=o.openToAll),o.allowAnswerChange!==void 0&&(document.getElementById("allowAnswerChange").checked=o.allowAnswerChange),o.showCorrectAnswer!==void 0&&(document.getElementById("showCorrectAnswer").checked=o.showCorrectAnswer),o.enableGamification!==void 0&&(document.getElementById("enableGamification").checked=o.enableGamification),i.debug("✅ Loaded saved session settings from backend:",o)}else i.debug("No saved settings found, using defaults")}catch(e){i.error("Error loading saved settings:",e)}}async function J(){try{const e=await x.getById(q);p=e.class||e,document.getElementById("classInfo").innerHTML=`
                    <strong>${p.name}</strong> - ${p.code} ${p.section?"("+p.section+")":""}
                `;const t=new Date,o=t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),n=t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});document.getElementById("sessionName").value=`${p.name} Session - ${o} ${n}`}catch(e){i.error("Error loading class:",e),r.error("Failed to load class information")}}function z(e){if(i.debug("=== selectSessionType called ==="),i.debug("type:",e),k=e,e!=="quick")u=[];else{const n=sessionStorage.getItem("fromSavedSet"),s=sessionStorage.getItem("pendingQuestions");if(i.debug("fromSavedSet:",n),i.debug("pendingQuestions:",s?`${s.length} chars`:"null"),n==="true"&&s)try{u=JSON.parse(s),i.debug("✅ Loaded questions:",u.length),sessionStorage.removeItem("fromSavedSet"),sessionStorage.removeItem("pendingQuestions"),r.success(`Loaded ${u.length} questions from saved set`)}catch(a){i.error("❌ Error loading saved questions:",a)}else i.debug("No pending questions found");O()}document.querySelectorAll(".option-card").forEach(n=>{n.classList.remove("selected")}),document.getElementById(e+"Option").classList.add("selected"),document.getElementById("sessionConfig").style.display="block",document.getElementById("quickPollConfig").style.display=e==="quick"?"block":"none",document.getElementById("quizConfig").style.display=e==="quiz"?"block":"none",document.getElementById("desktopInstructions").style.display=e==="desktop"?"block":"none";const t=e!=="desktop";document.getElementById("sessionSettings").style.display=t?"block":"none",document.getElementById("sessionOptions").style.display=t?"block":"none",document.getElementById("sessionName").parentElement.style.display=t?"block":"none",document.getElementById("startButton").style.display=e==="desktop"?"none":"inline-block",e==="quiz"?W():e==="desktop"&&_();const o=new Date;document.getElementById("sessionName").value=`${p.name} - ${o.toLocaleDateString()}`}async function W(){try{const t=await(await fetch("https://api.intellaclick.com/api/quizzes",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),o=document.getElementById("quizSelect"),n=document.getElementById("noQuizzesMessage");t.success&&t.quizzes&&t.quizzes.length>0?(o.innerHTML='<option value="">Select a quiz...</option>'+t.quizzes.map(s=>`<option value="${s._id}">${s.title} (${s.questionCount||0} questions)</option>`).join(""),n.style.display="none"):(o.innerHTML='<option value="">No quizzes available</option>',n.style.display="block")}catch(e){i.error("Error loading quizzes:",e);const t=document.getElementById("quizSelect");t.innerHTML='<option value="">Error loading quizzes</option>',r.error("Failed to load quizzes")}}function _(){document.getElementById("desktopClassName").textContent=p.name,document.getElementById("desktopJoinCode").textContent=p.joinCode||"N/A"}function V(){const e=document.getElementById("questionType").value;switch(document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none",e){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block";break}}function K(){const e=document.getElementById("questionType").value,t=document.getElementById("questionText").value.trim();if(!t){r.error("Please enter a question");return}const o=parseInt(document.getElementById("duration").value)||60;let n={text:t,type:e,timeLimit:o,points:10};try{switch(e){case"mcq":const s=[],a=[];let g=null;for(let l=0;l<f;l++){const c=String.fromCharCode(65+l),m=document.getElementById(`option${c}`);if(m&&m.value.trim()){s.push(c),a.push(m.value.trim());const $=document.querySelector(`input[name="correctAnswer"][value="${c}"]`);$&&$.checked&&(g=c)}}if(s.length<2){r.error("Please provide at least 2 answer options");return}n.options=s,n.optionTexts=a,n.correctAnswer=g;break;case"poll":const I=[],E=[];for(let l=0;l<y;l++){const c=String.fromCharCode(65+l),m=document.getElementById(`pollOption${c}`);m&&m.value.trim()&&(I.push(c),E.push(m.value.trim()))}if(I.length<2){r.error("Please provide at least 2 poll options");return}n.options=I,n.optionTexts=E;const b=document.getElementById("pollParticipationPoints").checked;n.awardParticipationPoints=b;break;case"tf":n.options=["True","False"],n.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const d=[];for(let l=1;l<=h;l++){const c=document.getElementById(`match${l}Left`).value.trim(),m=document.getElementById(`match${l}Right`).value.trim();c&&m&&d.push({left:c,right:m})}if(d.length<2){r.error("Please provide at least 2 matching pairs");return}n.pairs=d;break;case"ordering":const v=[];for(let l=1;l<=w;l++){const c=document.getElementById(`order${l}`).value.trim();c&&v.push(c)}if(v.length<2){r.error("Please provide at least 2 items to order");return}n.correctOrder=v;break;case"fillblank":const T=document.getElementById("blankAnswer").value.trim();if(!T){r.error("Please provide the correct answer");return}if(!t.includes("[blank]")){r.error("Please include [blank] in your question where the answer should go");return}n.correctAnswer=T;break}u.push(n),X(),O(),r.success("Question added successfully!")}catch(s){r.error("Error adding question: "+s.message)}}function X(){document.getElementById("questionText").value="";for(let t=0;t<f;t++){const o=String.fromCharCode(65+t),n=document.getElementById(`option${o}`);n&&(n.value="")}for(let t=0;t<y;t++){const o=String.fromCharCode(65+t),n=document.getElementById(`pollOption${o}`);n&&(n.value="")}for(let t=1;t<=h;t++){const o=document.getElementById(`match${t}Left`),n=document.getElementById(`match${t}Right`);o&&(o.value=""),n&&(n.value="")}for(let t=1;t<=w;t++){const o=document.getElementById(`order${t}`);o&&(o.value="")}const e=document.getElementById("blankAnswer");e&&(e.value="")}function Y(e){window.confirm("Remove this question?")&&(u.splice(e,1),O())}function O(){const e=document.getElementById("questionsList");if(u.length===0){e.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}e.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${u.length} Question(s) Added:</strong>
                </div>
                ${u.map((t,o)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${o+1}: ${t.text}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${t.type.toUpperCase()}</div>
                        </div>
                        <button type="button" class="btn btn-danger btn-small" onclick="removeQuickPollQuestion(${o})" style="margin-left: 12px;">Remove</button>
                    </div>
                `).join("")}
            `}async function Z(e){if(e.preventDefault(),!k){r.error("Please select a session type");return}if(k==="desktop")return;const o=document.getElementById("customSessionCode").value.trim()||Math.random().toString(36).substring(2,8).toUpperCase(),n={sessionCode:o,title:document.getElementById("sessionName").value,description:`${k==="quick"?"Quick Poll":"Quiz Session"} for ${p.name}`,requireLogin:!document.getElementById("allowAnonymous").checked,classId:q,restrictToEnrolled:!document.getElementById("openToAll").checked,gamification:{enabled:document.getElementById("enableGamification").checked},allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked};if(i.debug("=== CREATING SESSION WITH SETTINGS ==="),i.debug("showCorrectAnswer checkbox value:",document.getElementById("showCorrectAnswer").checked),i.debug("Session data being sent:",n),k==="quick"){if(u.length===0){r.error("Please add at least one question to the quick poll");return}n.questions=u}else if(k==="quiz"){const s=document.getElementById("quizSelect").value;if(!s){r.error("Please select a quiz");return}try{const a=await fetch(`https://api.intellaclick.com/api/quizzes/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("Failed to load quiz");const g=await a.json(),I=g.quiz||g,E=(I.questions||[]).map(b=>{const d=b.questionSnapshot||{},v=d.questionType||d.type||"mcq";return{text:d.questionText||"",type:v,timeLimit:60,points:b.points||10,options:d.options,correctAnswer:d.correctAnswer,pairs:d.pairs,correctOrder:d.correctOrder,optionTexts:d.options}});if(n.questions=E,n.quizId=s,n.quizTitle=I.title,n.questions.length===0){r.error("Selected quiz has no questions");return}}catch(a){i.error("Error loading quiz:",a),r.error("Failed to load quiz data");return}}try{const s=await P.create(n),a=s.session||s,g={allowAnonymous:document.getElementById("allowAnonymous").checked,openToAll:document.getElementById("openToAll").checked,allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked,enableGamification:document.getElementById("enableGamification").checked};fetch("https://api.intellaclick.com/api/users/session-settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(g)}).then(()=>{i.debug("✅ Saved session settings to backend for next time")}).catch(I=>{i.error("Failed to save settings (non-critical):",I)}),r.success(`Session created! Code: ${a.sessionCode||o}`),n.questions&&n.questions.length>0&&(sessionStorage.setItem("pendingQuestions",JSON.stringify(n.questions)),sessionStorage.setItem("currentQuestionIndex","0")),n.questions&&n.questions.length>0&&oe(n.title,n.questions),setTimeout(()=>{i.debug("=== REDIRECTING NOW ==="),window.location.href=`session.html?id=${a.id||a._id}&code=${a.sessionCode||o}&type=${k}`},5e3)}catch(s){i.error("Error creating session:",s),r.error(s.message||"Failed to create session")}}function ee(){window.confirm("Are you sure you want to cancel?")&&(window.location.href="classes.html")}function te(){const e=window.location.href;sessionStorage.setItem("createSessionUrl",e),i.debug("Navigating to saved questions, returnUrl:",e),window.location.href=`saved-questions.html?returnUrl=${encodeURIComponent(e)}`}function ne(){const e=document.getElementById("questionText"),t=e.selectionStart,o=e.selectionEnd,n=e.value,s=n.substring(0,t)+"[blank]"+n.substring(o);e.value=s,e.selectionStart=e.selectionEnd=t+7,e.focus()}async function oe(e,t){if(i.debug("=== AUTO-SAVE CALLED ==="),i.debug("Session name:",e),i.debug("Questions array:",t),i.debug("Questions length:",t==null?void 0:t.length),!t||t.length===0){i.debug("❌ No questions to save - skipping auto-save");return}const o=localStorage.getItem("token");if(!o){i.warn("⚠️ No authentication token - skipping auto-save (silent)");return}i.debug(`🔄 Auto-saving "${e}" with ${t.length} questions to cloud...`);const n={name:e,questions:t,classId:null};i.debug("Payload being sent:",JSON.stringify(n,null,2));try{const s=await fetch("https://api.intellaclick.com/api/question-sets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(n)});if(i.debug("Response status:",s.status),!s.ok){const g=await s.json();i.error("❌ Cloud API save failed:",g),i.error("Response status:",s.status),i.warn("⚠️ Question set auto-save failed, but session will continue");return}const a=await s.json();i.debug("✅ Question set auto-saved to cloud successfully:",a)}catch(s){i.error("❌ Error auto-saving question set:",s),i.error("Error stack:",s.stack),i.warn("⚠️ Question set auto-save failed, but session will continue")}}window.selectSessionType=z;window.goToSavedQuestions=te;window.insertBlank=ne;window.updateQuestionOptions=V;window.addQuickPollQuestion=K;window.cancelSession=ee;window.removeQuickPollQuestion=Y;window.addMcqOption=L;window.removeMcqOption=M;window.addPollOption=N;window.removePollOption=R;window.addMatchingPair=D;window.removeMatchingPair=F;window.addOrderingItem=H;window.removeOrderingItem=U;
