const u={},y=typeof import.meta<"u"&&(u==null?void 0:u.VITE_API_URL)||"https://api-modular.intellaclick.com/api";function g(){const e=localStorage.getItem("token");return{"Content-Type":"application/json",...e&&{Authorization:`Bearer ${e}`}}}async function l(e){var t,n,a,o,d;if(!e.ok){if(e.status===401){const i=await e.json().catch(()=>({error:"Authentication failed"}));if(((t=i.error)==null?void 0:t.toLowerCase().includes("token"))||((n=i.error)==null?void 0:n.toLowerCase().includes("expired"))||((a=i.error)==null?void 0:a.toLowerCase().includes("jwt"))||((o=i.message)==null?void 0:o.toLowerCase().includes("token"))||((d=i.message)==null?void 0:d.toLowerCase().includes("expired")))throw localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),alert("Your session has expired. Please log in again."),window.location.href="/login.html",new Error("Session expired. Please log in again.")}const c=await e.json().catch(()=>({error:"Request failed"}));console.error("API Error Response:",{status:e.status,statusText:e.statusText,url:e.url,errorData:c});let r=c.error||c.message||`HTTP ${e.status}`;throw typeof r!="string"&&(r=JSON.stringify(r)),(r.includes("E11000")||r.includes("duplicate key"))&&(r.includes("code_1")||r.includes("code:")?r="A class with this code already exists. Please use a different class code.":r="This record already exists in the database."),new Error(r)}return e.json()}async function s(e,t={}){const n=`${y}${e}`,a={...t,headers:{...g(),...t.headers}};try{const o=await fetch(n,a);return await l(o)}catch(o){throw console.error(`API Error [${e}]:`,o),o}}const h={async login(e,t){return s("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})})},async register(e){return s("/auth/register",{method:"POST",body:JSON.stringify(e)})},async getMe(){return s("/auth/me")}},S={async getAll(e={}){const t=new URLSearchParams(e).toString();return s(`/sessions${t?`?${t}`:""}`)},async getActive(){return s("/sessions/instructor/active")},async create(e){return s("/sessions",{method:"POST",body:JSON.stringify(e)})},async getById(e){return s(`/sessions/${e}`)},async getByCode(e){return s(`/sessions/code/${e}`)},async updateStatus(e,t){return s(`/sessions/${e}/status`,{method:"PATCH",body:JSON.stringify({status:t})})},async getCurrentQuestion(e){return s(`/sessions/${e}/current-question`)},async nextQuestion(e){return s(`/sessions/${e}/next-question`,{method:"POST"})},async endQuestion(e){return s(`/sessions/${e}/end-question`,{method:"POST"})},async end(e){return s(`/sessions/${e}/end`,{method:"POST"})},async getResponses(e){return s(`/sessions/${e}/responses`)},async delete(e){return s(`/sessions/${e}`,{method:"DELETE"})},async getCurrentQuestionByCode(e){return s(`/sessions/code/${e}/current-question`)},async getByCodeFull(e){return s(`/sessions/code/${e}`)},async startQuestionTimer(e,t,n){return s(`/sessions/${e}/questions/${t}/timer`,{method:"POST",body:JSON.stringify({timeLimit:n})})},async addQuestionTime(e,t,n){return s(`/sessions/${e}/questions/${t}/timer`,{method:"POST",body:JSON.stringify({addSeconds:n})})},async endQuestionSession(e,t){return s(`/sessions/${e}/questions/${t}/end`,{method:"POST"})},async addQuestions(e,t){return s(`/sessions/${e}/questions`,{method:"POST",body:JSON.stringify({questions:t})})},async updateQuestionParticipationPoints(e,t,n){return s(`/sessions/${e}/questions/${t}/participation-points`,{method:"PATCH",body:JSON.stringify({awardParticipationPoints:n})})},async updateAllParticipationPoints(e,t){return s(`/sessions/${e}/participation-points`,{method:"PATCH",body:JSON.stringify({awardParticipationPoints:t})})}},$={async getAll(e={}){const t=new URLSearchParams(e).toString();return s(`/classes${t?`?${t}`:""}`)},async getById(e){return s(`/classes/${e}`)},async create(e){return s("/classes",{method:"POST",body:JSON.stringify(e)})},async update(e,t){return s(`/classes/${e}`,{method:"PUT",body:JSON.stringify(t)})},async delete(e,t={}){const n=new URLSearchParams(t).toString();return s(`/classes/${e}${n?`?${n}`:""}`,{method:"DELETE"})},async archive(e){return s(`/classes/${e}/archive`,{method:"POST"})},async getStudents(e){return s(`/classes/${e}/students`)}},f={async getSettings(e){return s(`/gamification/settings/${e}`)},async updateSettings(e,t){return s(`/gamification/settings/${e}`,{method:"PUT",body:JSON.stringify(t)})},async getLeaderboard(e){return s(`/gamification/leaderboard/${e}`)},async getStudentStats(e,t){return s(`/gamification/stats/${e}/${t}`)},async syncInstructorSessions(e,t={}){const n=new URLSearchParams(t).toString();return s(`/gamification/sync-instructor-sessions/${e}${n?`?${n}`:""}`,{method:"POST"})},async getRecentAchievements(e,t=10){const n=new URLSearchParams;return e&&n.append("classId",e),t&&n.append("limit",t),s(`/gamification/achievements/recent?${n.toString()}`)},async getEngagement(e,t="week"){return s(`/gamification/engagement/${e}?period=${t}`)}},P={async getAll(){return s("/quizzes")},async getById(e){return s(`/quizzes/${e}`)},async create(e){return s("/quizzes",{method:"POST",body:JSON.stringify(e)})},async update(e,t){return s(`/quizzes/${e}`,{method:"PUT",body:JSON.stringify(t)})},async delete(e){return s(`/quizzes/${e}`,{method:"DELETE"})},async duplicate(e){return s(`/quizzes/${e}/duplicate`,{method:"POST"})}},T={async getAll(){return s("/question-sets")},async getById(e){return s(`/question-sets/${e}`)},async create(e){return s("/question-sets",{method:"POST",body:JSON.stringify(e)})},async update(e,t){return s(`/question-sets/${e}`,{method:"PUT",body:JSON.stringify(t)})},async delete(e){return s(`/question-sets/${e}`,{method:"DELETE"})}};export{h as a,T as b,$ as c,f as g,P as q,S as s};
