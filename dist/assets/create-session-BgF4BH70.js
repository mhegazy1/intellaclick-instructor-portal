import{t as a}from"./toast-93yYkT8V.js";/* empty css               *//* empty css                       */import{c as x,s as P}from"./api-DhNc_vJl.js";import{l as r}from"./logger-gSLuc3Ra.js";let q,f,v=null,g=[],y=4,h=4,w=4,I=4;document.addEventListener("DOMContentLoaded",function(){if(q=new URLSearchParams(window.location.search).get("classId"),!q){window.location.href="classes.html";return}Q(),J(),S(4),B(4),C(4),$(4),document.getElementById("sessionForm").addEventListener("submit",Z),G();const n=sessionStorage.getItem("fromSavedSet"),i=sessionStorage.getItem("pendingQuestions");r.debug("üîµ Page loaded - checking for pending questions"),r.debug("fromSavedSet:",n),r.debug("pendingQuestions:",i?"exists":"none"),n==="true"&&i&&(r.debug("‚úÖ Auto-selecting Quick Poll mode"),setTimeout(()=>{z("quick")},500))});function Q(){localStorage.getItem("token")||(window.location.href="login.html")}function S(t){y=t;const n=document.getElementById("mcqOptionsContainer"),i={};let e=null;for(let o=0;o<26;o++){const s=String.fromCharCode(65+o),l=document.getElementById(`option${s}`),d=document.querySelector(`input[name="correctAnswer"][value="${s}"]`);l&&(i[s]=l.value),d&&d.checked&&(e=s)}n.innerHTML="";for(let o=0;o<t;o++){const s=String.fromCharCode(65+o),l=document.createElement("div");l.className="radio-option",l.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${s}" ${e===s||o===0&&!e?"checked":""}>
                    <input type="text" id="option${s}" placeholder="Option ${s}" value="${i[s]||""}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,n.appendChild(l)}}function B(t){h=t;const n=document.getElementById("pollOptionsContainer"),i={};for(let e=0;e<26;e++){const o=String.fromCharCode(65+e),s=document.getElementById(`pollOption${o}`);s&&(i[o]=s.value)}n.innerHTML="";for(let e=0;e<t;e++){const o=String.fromCharCode(65+e),s=document.createElement("input");s.type="text",s.id=`pollOption${o}`,s.placeholder=`Option ${o}`,s.value=i[o]||"",s.style.width="100%",n.appendChild(s)}}function L(){if(y>=26){a.error("Maximum 26 options allowed");return}y++,S(y)}function M(){if(y<=2){a.error("Minimum 2 options required");return}y--,S(y)}function N(){if(h>=26){a.error("Maximum 26 options allowed");return}h++,B(h)}function R(){if(h<=2){a.error("Minimum 2 options required");return}h--,B(h)}function C(t){w=t;const n=document.getElementById("matchingPairsContainer"),i={};for(let e=1;e<=10;e++){const o=document.getElementById(`match${e}Left`),s=document.getElementById(`match${e}Right`);o&&(i[`${e}Left`]=o.value),s&&(i[`${e}Right`]=s.value)}n.innerHTML="";for(let e=0;e<t;e++){const o=e+1,s=document.createElement("input");s.type="text",s.id=`match${o}Left`,s.placeholder=`Item ${o}`,s.value=i[`${o}Left`]||"",s.style.width="100%";const l=document.createElement("input");l.type="text",l.id=`match${o}Right`,l.placeholder=`Match ${o}`,l.value=i[`${o}Right`]||"",l.style.width="100%",n.appendChild(s),n.appendChild(l)}}function D(){if(w>=10){a.error("Maximum 10 pairs allowed");return}w++,C(w)}function F(){if(w<=2){a.error("Minimum 2 pairs required");return}w--,C(w)}function $(t){I=t;const n=document.getElementById("orderingItemsContainer"),i={};for(let e=1;e<=10;e++){const o=document.getElementById(`order${e}`);o&&(i[e]=o.value)}n.innerHTML="";for(let e=0;e<t;e++){const o=e+1,s=document.createElement("input");s.type="text",s.id=`order${o}`,s.placeholder=`${j(o)} item`,s.value=i[o]||"",s.style.width="100%",n.appendChild(s)}}function H(){if(I>=10){a.error("Maximum 10 items allowed");return}I++,$(I)}function U(){if(I<=2){a.error("Minimum 2 items required");return}I--,$(I)}function j(t){const n=["th","st","nd","rd"],i=t%100;return t+(n[(i-20)%10]||n[i]||n[0])}async function G(){try{const t=await fetch("https://api.intellaclick.com/api/users/session-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const i=(await t.json()).settings;i.allowAnonymous!==void 0&&(document.getElementById("allowAnonymous").checked=i.allowAnonymous),i.openToAll!==void 0&&(document.getElementById("openToAll").checked=i.openToAll),i.allowAnswerChange!==void 0&&(document.getElementById("allowAnswerChange").checked=i.allowAnswerChange),i.showCorrectAnswer!==void 0&&(document.getElementById("showCorrectAnswer").checked=i.showCorrectAnswer),i.enableGamification!==void 0&&(document.getElementById("enableGamification").checked=i.enableGamification),r.debug("‚úÖ Loaded saved session settings from backend:",i)}else r.debug("No saved settings found, using defaults")}catch(t){r.error("Error loading saved settings:",t)}}async function J(){try{const t=await x.getById(q);f=t.class||t,document.getElementById("classInfo").innerHTML=`
                    <strong>${f.name}</strong> - ${f.code} ${f.section?"("+f.section+")":""}
                `;const n=new Date,i=n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),e=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});document.getElementById("sessionName").value=`${f.name} Session - ${i} ${e}`}catch(t){r.error("Error loading class:",t),a.error("Failed to load class information")}}function z(t){if(r.debug("=== selectSessionType called ==="),r.debug("type:",t),v=t,t!=="quick")g=[];else{const e=sessionStorage.getItem("fromSavedSet"),o=sessionStorage.getItem("pendingQuestions");if(r.debug("fromSavedSet:",e),r.debug("pendingQuestions:",o?`${o.length} chars`:"null"),e==="true"&&o)try{g=JSON.parse(o),r.debug("‚úÖ Loaded questions:",g.length),sessionStorage.removeItem("fromSavedSet"),sessionStorage.removeItem("pendingQuestions"),a.success(`Loaded ${g.length} questions from saved set`)}catch(s){r.error("‚ùå Error loading saved questions:",s)}else r.debug("No pending questions found");A()}document.querySelectorAll(".option-card").forEach(e=>{e.classList.remove("selected")}),document.getElementById(t+"Option").classList.add("selected"),document.getElementById("sessionConfig").style.display="block",document.getElementById("quickPollConfig").style.display=t==="quick"?"block":"none",document.getElementById("quizConfig").style.display=t==="quiz"?"block":"none",document.getElementById("desktopInstructions").style.display=t==="desktop"?"block":"none";const n=t!=="desktop";document.getElementById("sessionSettings").style.display=n?"block":"none",document.getElementById("sessionOptions").style.display=n?"block":"none",document.getElementById("sessionName").parentElement.style.display=n?"block":"none",document.getElementById("startButton").style.display=t==="desktop"?"none":"inline-block",t==="quiz"?V():t==="desktop"&&W();const i=new Date;document.getElementById("sessionName").value=`${f.name} - ${i.toLocaleDateString()}`}async function V(){try{const n=await(await fetch("https://api.intellaclick.com/api/quizzes",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),i=document.getElementById("quizSelect"),e=document.getElementById("noQuizzesMessage");n.success&&n.quizzes&&n.quizzes.length>0?(i.innerHTML='<option value="">Select a quiz...</option>'+n.quizzes.map(o=>`<option value="${o._id}">${o.title} (${o.questionCount||0} questions)</option>`).join(""),e.style.display="none"):(i.innerHTML='<option value="">No quizzes available</option>',e.style.display="block")}catch(t){r.error("Error loading quizzes:",t);const n=document.getElementById("quizSelect");n.innerHTML='<option value="">Error loading quizzes</option>',a.error("Failed to load quizzes")}}function W(){document.getElementById("desktopClassName").textContent=f.name,document.getElementById("desktopJoinCode").textContent=f.joinCode||"N/A"}function _(){const t=document.getElementById("questionType").value;switch(document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none",t){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block";break}}function K(){const t=document.getElementById("questionType").value,n=document.getElementById("questionText").value.trim();if(!n){a.error("Please enter a question");return}const i=parseInt(document.getElementById("duration").value)||60;let e={text:n,type:t,timeLimit:i,points:10};try{switch(t){case"mcq":const o=[],s=[];let l=null;for(let c=0;c<y;c++){const m=String.fromCharCode(65+c),p=document.getElementById(`option${m}`);if(p&&p.value.trim()){o.push(m),s.push(p.value.trim());const T=document.querySelector(`input[name="correctAnswer"][value="${m}"]`);T&&T.checked&&(l=m)}}if(o.length<2){a.error("Please provide at least 2 answer options");return}e.options=o,e.optionTexts=s,e.correctAnswer=l;break;case"poll":const d=[],E=[];for(let c=0;c<h;c++){const m=String.fromCharCode(65+c),p=document.getElementById(`pollOption${m}`);p&&p.value.trim()&&(d.push(m),E.push(p.value.trim()))}if(d.length<2){a.error("Please provide at least 2 poll options");return}e.options=d,e.optionTexts=E;const b=document.getElementById("pollParticipationPoints").checked;e.awardParticipationPoints=b;break;case"tf":e.options=["True","False"],e.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const u=[];for(let c=1;c<=w;c++){const m=document.getElementById(`match${c}Left`).value.trim(),p=document.getElementById(`match${c}Right`).value.trim();m&&p&&u.push({left:m,right:p})}if(u.length<2){a.error("Please provide at least 2 matching pairs");return}e.pairs=u,r.debug("üîç Created matching question with pairs:",{pairs:u,questionPairs:e.pairs});break;case"ordering":const k=[];for(let c=1;c<=I;c++){const m=document.getElementById(`order${c}`).value.trim();m&&k.push(m)}if(k.length<2){a.error("Please provide at least 2 items to order");return}e.correctOrder=k;break;case"fillblank":const O=document.getElementById("blankAnswer").value.trim();if(!O){a.error("Please provide the correct answer");return}if(!n.includes("[blank]")){a.error("Please include [blank] in your question where the answer should go");return}e.correctAnswer=O;break}g.push(e),r.debug("‚úÖ Added question to array:",{type:e.type,question:e,arrayLength:g.length}),X(),A(),a.success("Question added successfully!")}catch(o){a.error("Error adding question: "+o.message)}}function X(){document.getElementById("questionText").value="";for(let n=0;n<y;n++){const i=String.fromCharCode(65+n),e=document.getElementById(`option${i}`);e&&(e.value="")}for(let n=0;n<h;n++){const i=String.fromCharCode(65+n),e=document.getElementById(`pollOption${i}`);e&&(e.value="")}for(let n=1;n<=w;n++){const i=document.getElementById(`match${n}Left`),e=document.getElementById(`match${n}Right`);i&&(i.value=""),e&&(e.value="")}for(let n=1;n<=I;n++){const i=document.getElementById(`order${n}`);i&&(i.value="")}const t=document.getElementById("blankAnswer");t&&(t.value="")}function Y(t){window.confirm("Remove this question?")&&(g.splice(t,1),A())}function A(){const t=document.getElementById("questionsList");if(g.length===0){t.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}t.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${g.length} Question(s) Added:</strong>
                </div>
                ${g.map((n,i)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${i+1}: ${n.text}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${n.type.toUpperCase()}</div>
                        </div>
                        <button type="button" class="btn btn-danger btn-small" onclick="removeQuickPollQuestion(${i})" style="margin-left: 12px;">Remove</button>
                    </div>
                `).join("")}
            `}async function Z(t){if(t.preventDefault(),!v){a.error("Please select a session type");return}if(v==="desktop")return;const i=document.getElementById("customSessionCode").value.trim()||Math.random().toString(36).substring(2,8).toUpperCase(),e={sessionCode:i,title:document.getElementById("sessionName").value,description:`${v==="quick"?"Quick Poll":"Quiz Session"} for ${f.name}`,requireLogin:!document.getElementById("allowAnonymous").checked,classId:q,restrictToEnrolled:!document.getElementById("openToAll").checked,gamification:{enabled:document.getElementById("enableGamification").checked},allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked};if(r.debug("=== CREATING SESSION WITH SETTINGS ==="),r.debug("showCorrectAnswer checkbox value:",document.getElementById("showCorrectAnswer").checked),r.debug("Session data being sent:",e),v==="quick"){if(g.length===0){a.error("Please add at least one question to the quick poll");return}e.questions=g}else if(v==="quiz"){const o=document.getElementById("quizSelect").value;if(!o){a.error("Please select a quiz");return}try{const s=await fetch(`https://api.intellaclick.com/api/quizzes/${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Failed to load quiz");const l=await s.json(),d=l.quiz||l,E=(d.questions||[]).map(b=>{const u=b.questionSnapshot||{},k=u.questionType||u.type||"mcq";return{text:u.questionText||"",type:k,timeLimit:60,points:b.points||10,options:u.options,correctAnswer:u.correctAnswer,pairs:u.pairs,correctOrder:u.correctOrder,optionTexts:u.options}});if(e.questions=E,e.quizId=o,e.quizTitle=d.title,e.questions.length===0){a.error("Selected quiz has no questions");return}}catch(s){r.error("Error loading quiz:",s),a.error("Failed to load quiz data");return}}try{const o=await P.create(e),s=o.session||o,l={allowAnonymous:document.getElementById("allowAnonymous").checked,openToAll:document.getElementById("openToAll").checked,allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked,enableGamification:document.getElementById("enableGamification").checked};if(fetch("https://api.intellaclick.com/api/users/session-settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(l)}).then(()=>{r.debug("‚úÖ Saved session settings to backend for next time")}).catch(d=>{r.error("Failed to save settings (non-critical):",d)}),a.success(`Session created! Code: ${s.sessionCode||i}`),e.questions&&e.questions.length>0){r.debug("üì¶ Storing questions in sessionStorage:",e.questions),sessionStorage.setItem("pendingQuestions",JSON.stringify(e.questions)),sessionStorage.setItem("currentQuestionIndex","0");const d=JSON.parse(sessionStorage.getItem("pendingQuestions"));r.debug("‚úÖ Verified stored questions:",d)}e.questions&&e.questions.length>0&&oe(e.title,e.questions),setTimeout(()=>{r.debug("=== REDIRECTING NOW ==="),window.location.href=`session.html?id=${s.id||s._id}&code=${s.sessionCode||i}&type=${v}`},5e3)}catch(o){r.error("Error creating session:",o),a.error(o.message||"Failed to create session")}}function ee(){window.confirm("Are you sure you want to cancel?")&&(window.location.href="classes.html")}function te(){const t=window.location.href;sessionStorage.setItem("createSessionUrl",t),r.debug("Navigating to saved questions, returnUrl:",t),window.location.href=`saved-questions.html?returnUrl=${encodeURIComponent(t)}`}function ne(){const t=document.getElementById("questionText"),n=t.selectionStart,i=t.selectionEnd,e=t.value,o=e.substring(0,n)+"[blank]"+e.substring(i);t.value=o,t.selectionStart=t.selectionEnd=n+7,t.focus()}async function oe(t,n){if(r.debug("=== AUTO-SAVE CALLED ==="),r.debug("Session name:",t),r.debug("Questions array:",n),r.debug("Questions length:",n==null?void 0:n.length),!n||n.length===0){r.debug("‚ùå No questions to save - skipping auto-save");return}const i=localStorage.getItem("token");if(!i){r.warn("‚ö†Ô∏è No authentication token - skipping auto-save (silent)");return}r.debug(`üîÑ Auto-saving "${t}" with ${n.length} questions to cloud...`);const e={name:t,questions:n,classId:null};r.debug("Payload being sent:",JSON.stringify(e,null,2));try{const o=await fetch("https://api-modular.intellaclick.com/api/question-sets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(e)});if(r.debug("Response status:",o.status),!o.ok){const l=await o.json();r.error("‚ùå Cloud API save failed:",l),r.error("Response status:",o.status),r.warn("‚ö†Ô∏è Question set auto-save failed, but session will continue");return}const s=await o.json();r.debug("‚úÖ Question set auto-saved to cloud successfully:",s)}catch(o){r.error("‚ùå Error auto-saving question set:",o),r.error("Error stack:",o.stack),r.warn("‚ö†Ô∏è Question set auto-save failed, but session will continue")}}window.selectSessionType=z;window.goToSavedQuestions=te;window.insertBlank=ne;window.updateQuestionOptions=_;window.addQuickPollQuestion=K;window.cancelSession=ee;window.removeQuickPollQuestion=Y;window.addMcqOption=L;window.removeMcqOption=M;window.addPollOption=N;window.removePollOption=R;window.addMatchingPair=D;window.removeMatchingPair=F;window.addOrderingItem=H;window.removeOrderingItem=U;
