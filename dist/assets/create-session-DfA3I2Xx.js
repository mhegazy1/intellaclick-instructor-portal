import{t as d}from"./toast-Cbd37M37.js";/* empty css               *//* empty css                       */import{c as F,s as j}from"./api-Cc5qfUA_.js";import{l as a}from"./logger-CXzo1yMG.js";import{g as G,a as J}from"./questionPreview-BhPLn-7f.js";const M=document.createElement("style");M.textContent=G();document.head.appendChild(M);let T,E,b=null,p=[],k=null,y=4,h=4,w=4,I=4;document.addEventListener("DOMContentLoaded",function(){if(T=new URLSearchParams(window.location.search).get("classId"),!T){window.location.href="classes.html";return}V(),ae(),P(4),A(4),C(4),$(4),document.getElementById("sessionForm").addEventListener("submit",me),oe(),ie();const e=sessionStorage.getItem("fromSavedSet"),n=sessionStorage.getItem("pendingQuestions");a.debug("ðŸ”µ Page loaded - checking for pending questions"),a.debug("fromSavedSet:",e),a.debug("pendingQuestions:",n?"exists":"none"),e==="true"&&n&&(a.debug("âœ… Auto-selecting Quick Poll mode"),setTimeout(()=>{N("quick")},500))});function V(){localStorage.getItem("token")||(window.location.href="login.html")}function P(t){y=t;const e=document.getElementById("mcqOptionsContainer"),n={};let s=null;for(let i=0;i<26;i++){const o=String.fromCharCode(65+i),r=document.getElementById(`option${o}`),l=document.querySelector(`input[name="correctAnswer"][value="${o}"]`);r&&(n[o]=r.value),l&&l.checked&&(s=o)}e.innerHTML="";for(let i=0;i<t;i++){const o=String.fromCharCode(65+i),r=document.createElement("div");r.className="radio-option",r.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${o}" ${s===o||i===0&&!s?"checked":""}>
                    <input type="text" id="option${o}" placeholder="Option ${o}" value="${n[o]||""}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,e.appendChild(r)}}function A(t){h=t;const e=document.getElementById("pollOptionsContainer"),n={};for(let s=0;s<26;s++){const i=String.fromCharCode(65+s),o=document.getElementById(`pollOption${i}`);o&&(n[i]=o.value)}e.innerHTML="";for(let s=0;s<t;s++){const i=String.fromCharCode(65+s),o=document.createElement("input");o.type="text",o.id=`pollOption${i}`,o.placeholder=`Option ${i}`,o.value=n[i]||"",o.style.width="100%",e.appendChild(o)}}function W(){if(y>=26){d.error("Maximum 26 options allowed");return}y++,P(y)}function _(){if(y<=2){d.error("Minimum 2 options required");return}y--,P(y)}function K(){if(h>=26){d.error("Maximum 26 options allowed");return}h++,A(h)}function X(){if(h<=2){d.error("Minimum 2 options required");return}h--,A(h)}function C(t){w=t;const e=document.getElementById("matchingPairsContainer"),n={};for(let s=1;s<=10;s++){const i=document.getElementById(`match${s}Left`),o=document.getElementById(`match${s}Right`);i&&(n[`${s}Left`]=i.value),o&&(n[`${s}Right`]=o.value)}e.innerHTML="";for(let s=0;s<t;s++){const i=s+1,o=document.createElement("input");o.type="text",o.id=`match${i}Left`,o.placeholder=`Item ${i}`,o.value=n[`${i}Left`]||"",o.style.width="100%";const r=document.createElement("input");r.type="text",r.id=`match${i}Right`,r.placeholder=`Match ${i}`,r.value=n[`${i}Right`]||"",r.style.width="100%",e.appendChild(o),e.appendChild(r)}}function Y(){if(w>=10){d.error("Maximum 10 pairs allowed");return}w++,C(w)}function Z(){if(w<=2){d.error("Minimum 2 pairs required");return}w--,C(w)}function $(t){I=t;const e=document.getElementById("orderingItemsContainer"),n={};for(let s=1;s<=10;s++){const i=document.getElementById(`order${s}`);i&&(n[s]=i.value)}e.innerHTML="";for(let s=0;s<t;s++){const i=s+1,o=document.createElement("input");o.type="text",o.id=`order${i}`,o.placeholder=`${ne(i)} item`,o.value=n[i]||"",o.style.width="100%",e.appendChild(o)}}function ee(){if(I>=10){d.error("Maximum 10 items allowed");return}I++,$(I)}function te(){if(I<=2){d.error("Minimum 2 items required");return}I--,$(I)}function ne(t){const e=["th","st","nd","rd"],n=t%100;return t+(e[(n-20)%10]||e[n]||e[0])}async function oe(){try{const t=await fetch("https://api-modular.intellaclick.com/api/users/session-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const n=(await t.json()).settings;n.allowAnonymous!==void 0&&(document.getElementById("allowAnonymous").checked=n.allowAnonymous),n.openToAll!==void 0&&(document.getElementById("openToAll").checked=n.openToAll),n.allowAnswerChange!==void 0&&(document.getElementById("allowAnswerChange").checked=n.allowAnswerChange),n.showCorrectAnswer!==void 0&&(document.getElementById("showCorrectAnswer").checked=n.showCorrectAnswer),n.enableGamification!==void 0&&(document.getElementById("enableGamification").checked=n.enableGamification),n.autoSaveQuestions!==void 0&&(document.getElementById("autoSaveQuestions").checked=n.autoSaveQuestions),a.debug("âœ… Loaded saved session settings from backend:",n)}else a.debug("No saved settings found, using defaults")}catch(t){a.error("Error loading saved settings:",t)}}async function ie(){try{const t=await fetch("https://api-modular.intellaclick.com/api/users/question-defaults",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const n=(await t.json()).defaults;return n.defaultTimeLimit!==void 0&&(document.getElementById("defaultTimeLimit").value=n.defaultTimeLimit),n.defaultPoints!==void 0&&(document.getElementById("defaultPoints").value=n.defaultPoints),n.defaultAwardParticipation!==void 0&&(document.getElementById("defaultAwardParticipation").checked=n.defaultAwardParticipation),a.debug("âœ… Loaded question defaults from backend:",n),n}else return a.debug("No saved question defaults found, using system defaults"),null}catch(t){return a.error("Error loading question defaults:",t),null}}async function se(){try{const t={defaultTimeLimit:parseInt(document.getElementById("defaultTimeLimit").value)||60,defaultPoints:parseInt(document.getElementById("defaultPoints").value)||10,defaultAwardParticipation:document.getElementById("defaultAwardParticipation").checked};return(await fetch("https://api-modular.intellaclick.com/api/users/question-defaults",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)})).ok?(a.debug("âœ… Question defaults saved to backend:",t),t):(a.error("Failed to save question defaults"),null)}catch(t){return a.error("Error saving question defaults:",t),null}}async function ae(){try{const t=await F.getById(T);E=t.class||t,document.getElementById("classInfo").innerHTML=`
                    <strong>${E.name}</strong> - ${E.code} ${E.section?"("+E.section+")":""}
                `;const e=new Date,n=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),s=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});document.getElementById("sessionName").value=`${E.name} Session - ${n} ${s}`}catch(t){a.error("Error loading class:",t),d.error("Failed to load class information")}}function N(t){if(a.debug("=== selectSessionType called ==="),a.debug("type:",t),b=t,t!=="quick")p=[];else{const o=sessionStorage.getItem("fromSavedSet"),r=sessionStorage.getItem("pendingQuestions");if(a.debug("fromSavedSet:",o),a.debug("pendingQuestions:",r?`${r.length} chars`:"null"),o==="true"&&r)try{p=JSON.parse(r),a.debug("âœ… Loaded questions:",p.length),sessionStorage.removeItem("fromSavedSet"),sessionStorage.removeItem("pendingQuestions"),d.success(`Loaded ${p.length} questions from saved set`)}catch(l){a.error("âŒ Error loading saved questions:",l)}else a.debug("No pending questions found");x()}document.querySelectorAll(".option-card").forEach(o=>{o.classList.remove("selected")}),document.getElementById(t+"Option").classList.add("selected"),document.getElementById("sessionConfig").style.display="block",document.getElementById("quickPollConfig").style.display=t==="quick"?"block":"none",document.getElementById("quizConfig").style.display=t==="quiz"?"block":"none",document.getElementById("desktopInstructions").style.display=t==="desktop"?"block":"none";const e=t!=="desktop";document.getElementById("sessionSettings").style.display=e?"block":"none",document.getElementById("sessionOptions").style.display=e?"block":"none",document.getElementById("sessionName").parentElement.style.display=e?"block":"none",document.getElementById("startButton").style.display=t==="desktop"?"none":"inline-block",t==="quiz"?re():t==="desktop"&&le();const n=new Date,s=n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),i=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});document.getElementById("sessionName").value=`${E.name} Session - ${s} ${i}`}async function re(){try{const e=await(await fetch("https://api-modular.intellaclick.com/api/quizzes",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),n=document.getElementById("quizSelect"),s=document.getElementById("noQuizzesMessage");e.success&&e.quizzes&&e.quizzes.length>0?(n.innerHTML='<option value="">Select a quiz...</option>'+e.quizzes.map(i=>`<option value="${i._id}">${i.title} (${i.questionCount||0} questions)</option>`).join(""),s.style.display="none"):(n.innerHTML='<option value="">No quizzes available</option>',s.style.display="block")}catch(t){a.error("Error loading quizzes:",t);const e=document.getElementById("quizSelect");e.innerHTML='<option value="">Error loading quizzes</option>',d.error("Failed to load quizzes")}}function le(){document.getElementById("desktopClassName").textContent=E.name,document.getElementById("desktopJoinCode").textContent=E.joinCode||"N/A"}function R(){const t=document.getElementById("questionType").value;document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none";const e=document.getElementById("insertBlankBtn");switch(t==="fillblank"?e.style.display="block":e.style.display="none",t){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block",L();break}}function de(){const t=document.getElementById("questionType").value,e=document.getElementById("questionText").value.trim();if(!e){d.error("Please enter a question");return}const n=parseInt(document.getElementById("defaultTimeLimit").value)||60,s=parseInt(document.getElementById("defaultPoints").value)||10,i=document.getElementById("defaultAwardParticipation").checked;let o={text:e,type:t,timeLimit:n,points:s,awardParticipationPoints:i};try{switch(t){case"mcq":const r=[],l=[];let c=null;for(let u=0;u<y;u++){const m=String.fromCharCode(65+u),f=document.getElementById(`option${m}`);if(f&&f.value.trim()){r.push(m),l.push(f.value.trim());const z=document.querySelector(`input[name="correctAnswer"][value="${m}"]`);z&&z.checked&&(c=m)}}if(r.length<2){d.error("Please provide at least 2 answer options");return}o.options=r,o.optionTexts=l,o.correctAnswer=c;break;case"poll":const g=[],B=[];for(let u=0;u<h;u++){const m=String.fromCharCode(65+u),f=document.getElementById(`pollOption${m}`);f&&f.value.trim()&&(g.push(m),B.push(f.value.trim()))}if(g.length<2){d.error("Please provide at least 2 poll options");return}o.options=g,o.optionTexts=B;const v=document.getElementById("pollParticipationPoints").checked;o.awardParticipationPoints=v;break;case"tf":o.options=["True","False"],o.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const q=[];for(let u=1;u<=w;u++){const m=document.getElementById(`match${u}Left`).value.trim(),f=document.getElementById(`match${u}Right`).value.trim();m&&f&&q.push({left:m,right:f})}if(q.length<2){d.error("Please provide at least 2 matching pairs");return}o.pairs=q,a.debug("ðŸ” Created matching question with pairs:",{pairs:q,questionPairs:o.pairs});break;case"ordering":const Q=[];for(let u=1;u<=I;u++){const m=document.getElementById(`order${u}`).value.trim();m&&Q.push(m)}if(Q.length<2){d.error("Please provide at least 2 items to order");return}o.correctOrder=Q;break;case"fillblank":const O=(e.match(/\[blank\]/gi)||[]).length;if(O===0){d.error("Please include at least one [blank] in your question");return}const S=[];for(let u=1;u<=O;u++){const m=document.getElementById(`blankAnswer${u}`),f=m?m.value.trim():"";if(!f){d.error(`Please provide answer for blank ${u}`);return}S.push(f)}o.correctAnswer=S.length===1?S[0]:S;break}k!==null?(p[k]=o,a.debug("âœ… Updated question at index:",k),d.success("Question updated successfully!"),k=null,document.getElementById("addQuestionBtn").textContent="Add Question",document.getElementById("cancelEditBtn").style.display="none"):(p.push(o),a.debug("âœ… Added question to array:",{type:o.type,question:o,arrayLength:p.length}),d.success("Question added successfully!")),U(),x()}catch(r){d.error("Error adding question: "+r.message)}}function U(){document.getElementById("questionText").value="";for(let e=0;e<y;e++){const n=String.fromCharCode(65+e),s=document.getElementById(`option${n}`);s&&(s.value="")}for(let e=0;e<h;e++){const n=String.fromCharCode(65+e),s=document.getElementById(`pollOption${n}`);s&&(s.value="")}for(let e=1;e<=w;e++){const n=document.getElementById(`match${e}Left`),s=document.getElementById(`match${e}Right`);n&&(n.value=""),s&&(s.value="")}for(let e=1;e<=I;e++){const n=document.getElementById(`order${e}`);n&&(n.value="")}const t=document.getElementById("blankAnswersContainer");t&&(t.innerHTML="")}function ce(t){window.confirm("Remove this question?")&&(p.splice(t,1),k===t?H():k!==null&&k>t&&k--,x())}function ue(t){const e=p[t];k=t,document.getElementById("addQuestionBtn").textContent="Update Question",document.getElementById("cancelEditBtn").style.display="inline-block",document.getElementById("questionType").value=e.type,R(),document.getElementById("questionText").value=e.text,document.getElementById("defaultTimeLimit").value=e.timeLimit||60,document.getElementById("defaultPoints").value=e.points||10,document.getElementById("defaultAwardParticipation").checked=e.awardParticipationPoints||!1,setTimeout(()=>{switch(e.type){case"mcq":y=e.options.length,P(y),setTimeout(()=>{e.optionTexts.forEach((o,r)=>{const l=String.fromCharCode(65+r),c=document.getElementById(`option${l}`);c&&(c.value=o)});const i=document.querySelector(`input[name="correctAnswer"][value="${e.correctAnswer}"]`);i&&(i.checked=!0)},50);break;case"poll":h=e.options.length,A(h),setTimeout(()=>{e.optionTexts.forEach((i,o)=>{const r=String.fromCharCode(65+o),l=document.getElementById(`pollOption${r}`);l&&(l.value=i)}),document.getElementById("pollParticipationPoints").checked=e.awardParticipationPoints||!1},50);break;case"tf":const s=document.querySelector(`input[name="tfAnswer"][value="${e.correctAnswer}"]`);s&&(s.checked=!0);break;case"matching":w=e.pairs.length,C(w),setTimeout(()=>{e.pairs.forEach((i,o)=>{const r=document.getElementById(`match${o+1}Left`),l=document.getElementById(`match${o+1}Right`);r&&(r.value=i.left),l&&(l.value=i.right)})},50);break;case"ordering":I=e.correctOrder.length,$(I),setTimeout(()=>{e.correctOrder.forEach((i,o)=>{const r=document.getElementById(`order${o+1}`);r&&(r.value=i)})},50);break;case"fillblank":setTimeout(()=>{(Array.isArray(e.correctAnswer)?e.correctAnswer:[e.correctAnswer]).forEach((o,r)=>{const l=document.getElementById(`blankAnswer${r+1}`);l&&(l.value=o)})},50);break}const n=document.getElementById("quickPollConfig")||document.getElementById("questionText");n&&n.scrollIntoView({behavior:"smooth",block:"start"}),d.info('Editing question. Click "Update Question" when done.')},100)}function H(){k=null,document.getElementById("addQuestionBtn").textContent="+ Add This Question",document.getElementById("cancelEditBtn").style.display="none",U(),d.info("Edit cancelled")}function x(){const t=document.getElementById("questionsList");if(p.length===0){t.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}t.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${p.length} Question(s) Added:</strong>
                </div>
                ${p.map((e,n)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${n+1}: ${e.text}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${e.type.toUpperCase()}${e.awardParticipationPoints?" | Participation Points: âœ“":""}</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="editQuickPollQuestion(${n})">Edit</button>
                            <button type="button" class="btn btn-danger btn-small" onclick="removeQuickPollQuestion(${n})">Remove</button>
                        </div>
                    </div>
                `).join("")}
            `}async function me(t){if(t.preventDefault(),!b){d.error("Please select a session type");return}if(b==="desktop")return;await se();const n=document.getElementById("customSessionCode").value.trim()||Math.random().toString(36).substring(2,8).toUpperCase(),s={sessionCode:n,title:document.getElementById("sessionName").value,description:`${b==="quick"?"Quick Poll":"Quiz Session"} for ${E.name}`,requireLogin:!document.getElementById("allowAnonymous").checked,classId:T,restrictToEnrolled:!document.getElementById("openToAll").checked,gamification:{enabled:document.getElementById("enableGamification").checked},allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked};if(a.debug("=== CREATING SESSION WITH SETTINGS ==="),a.debug("showCorrectAnswer checkbox value:",document.getElementById("showCorrectAnswer").checked),a.debug("Session data being sent:",s),b==="quick"){if(p.length===0){d.error("Please add at least one question to the quick poll");return}s.questions=p}else if(b==="quiz"){const i=document.getElementById("quizSelect").value;if(!i){d.error("Please select a quiz");return}try{const o=await fetch(`https://api-modular.intellaclick.com/api/quizzes/${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Failed to load quiz");const r=await o.json(),l=r.quiz||r,c={defaultTimeLimit:parseInt(document.getElementById("defaultTimeLimit").value)||60,defaultPoints:parseInt(document.getElementById("defaultPoints").value)||10,defaultAwardParticipation:document.getElementById("defaultAwardParticipation").checked};a.debug("ðŸ“‹ Applying question defaults to imported quiz:",c);const g=(l.questions||[]).map(B=>{const v=B.questionSnapshot||{},q=v.questionType||v.type||"mcq";return{text:v.questionText||"",type:q,timeLimit:c.defaultTimeLimit,points:c.defaultPoints,awardParticipationPoints:c.defaultAwardParticipation,options:v.options,correctAnswer:v.correctAnswer,pairs:v.pairs,correctOrder:v.correctOrder,optionTexts:v.options}});if(s.questions=g,s.quizId=i,s.quizTitle=l.title,s.questions.length===0){d.error("Selected quiz has no questions");return}}catch(o){a.error("Error loading quiz:",o),d.error("Failed to load quiz data");return}}try{const i=await j.create(s),o=i.session||i,r={allowAnonymous:document.getElementById("allowAnonymous").checked,openToAll:document.getElementById("openToAll").checked,allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked,enableGamification:document.getElementById("enableGamification").checked,autoSaveQuestions:document.getElementById("autoSaveQuestions").checked};if(fetch("https://api-modular.intellaclick.com/api/users/session-settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(r)}).then(()=>{a.debug("âœ… Saved session settings to backend for next time")}).catch(c=>{a.error("Failed to save settings (non-critical):",c)}),d.success(`Session created! Code: ${o.sessionCode||n}`),s.questions&&s.questions.length>0){a.debug("ðŸ“¦ Storing questions in sessionStorage:",s.questions),sessionStorage.setItem("pendingQuestions",JSON.stringify(s.questions)),sessionStorage.setItem("currentQuestionIndex","0");const c=JSON.parse(sessionStorage.getItem("pendingQuestions"));a.debug("âœ… Verified stored questions:",c)}const l=document.getElementById("autoSaveQuestions").checked;a.debug("Auto-save checkbox state:",l),l&&s.questions&&s.questions.length>0?(a.debug("Auto-saving questions because checkbox is checked"),ye(s.title,s.questions)):l||a.debug("â­ï¸ Skipping auto-save - user unchecked the box"),setTimeout(()=>{a.debug("=== REDIRECTING NOW ==="),window.location.href=`session.html?id=${o.id||o._id}&code=${o.sessionCode||n}&type=${b}`},5e3)}catch(i){a.error("Error creating session:",i),d.error(i.message||"Failed to create session")}}function pe(){window.confirm("Are you sure you want to cancel?")&&(window.location.href="classes.html")}function ge(){const t=window.location.href;sessionStorage.setItem("createSessionUrl",t),a.debug("Navigating to saved questions, returnUrl:",t),window.location.href=`saved-questions.html?returnUrl=${encodeURIComponent(t)}`}function fe(){const t=document.getElementById("questionText"),e=t.selectionStart,n=t.selectionEnd,s=t.value,i=s.substring(0,e)+"[blank]"+s.substring(n);t.value=i,t.selectionStart=t.selectionEnd=e+7,t.focus(),document.getElementById("questionType").value==="fillblank"&&L()}function L(){const e=(document.getElementById("questionText").value.match(/\[blank\]/gi)||[]).length,n=document.getElementById("blankAnswersContainer");if(n.innerHTML="",e===0){n.innerHTML='<small style="color: var(--text-secondary);">No blanks found. Click "Insert [blank]" button to add blanks to your question.</small>';return}for(let s=0;s<e;s++){const i=document.createElement("input");i.type="text",i.id=`blankAnswer${s+1}`,i.placeholder=`Answer for blank ${s+1}`,i.style.marginTop="0",n.appendChild(i)}}async function ye(t,e){if(a.debug("=== AUTO-SAVE CALLED ==="),a.debug("Session name:",t),a.debug("Questions array:",e),a.debug("Questions length:",e==null?void 0:e.length),!e||e.length===0){a.debug("âŒ No questions to save - skipping auto-save");return}const n=localStorage.getItem("token");if(!n){a.warn("âš ï¸ No authentication token - skipping auto-save (silent)");return}a.debug(`ðŸ”„ Auto-saving "${t}" with ${e.length} questions to cloud...`);const s={name:t,questions:e,classId:null};a.debug("Payload being sent:",JSON.stringify(s,null,2));try{const i=await fetch("https://api-modular.intellaclick.com/api/question-sets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(s)});if(a.debug("Response status:",i.status),!i.ok){const r=await i.json();a.error("âŒ Cloud API save failed:",r),a.error("Response status:",i.status),a.warn("âš ï¸ Question set auto-save failed, but session will continue");return}const o=await i.json();a.debug("âœ… Question set auto-saved to cloud successfully:",o)}catch(i){a.error("âŒ Error auto-saving question set:",i),a.error("Error stack:",i.stack),a.warn("âš ï¸ Question set auto-save failed, but session will continue")}}function he(){const t=document.getElementById("questionText").value.trim();if(!t){d.error("Please enter question text first");return}const e=document.getElementById("questionType").value,n=parseInt(document.getElementById("defaultTimeLimit").value)||60,s=parseInt(document.getElementById("defaultPoints").value)||10;let i={text:t,type:e,timeLimit:n,points:s};if(e==="mcq"||e==="poll"){const r=[];for(let l=0;l<(e==="mcq"?y:h);l++){const c=String.fromCharCode(65+l),g=document.getElementById(e==="mcq"?`option${c}`:`pollOption${c}`);g&&g.value.trim()&&r.push(g.value.trim())}i.options=r}else if(e==="matching"){const r=[],l=[];for(let c=1;c<=w;c++){const g=document.getElementById(`match${c}Left`),B=document.getElementById(`match${c}Right`);g&&g.value.trim()&&r.push(g.value.trim()),B&&B.value.trim()&&l.push(B.value.trim())}i.matching={items:r,matches:l}}else if(e==="ordering"){const r=[];for(let l=1;l<=I;l++){const c=document.getElementById(`order${l}`);c&&c.value.trim()&&r.push(c.value.trim())}i.ordering=r}const o=J(i);document.getElementById("questionPreviewBody").innerHTML=o,document.getElementById("questionPreviewModal").classList.add("active")}function D(){document.getElementById("questionPreviewModal").classList.remove("active")}document.addEventListener("keydown",t=>{if(t.key==="Escape"){const e=document.getElementById("questionPreviewModal");e&&e.classList.contains("active")&&D()}});window.selectSessionType=N;window.goToSavedQuestions=ge;window.insertBlank=fe;window.updateBlankAnswerFields=L;window.updateQuestionOptions=R;window.addQuickPollQuestion=de;window.cancelSession=pe;window.removeQuickPollQuestion=ce;window.editQuickPollQuestion=ue;window.cancelEdit=H;window.addMcqOption=W;window.removeMcqOption=_;window.addPollOption=K;window.removePollOption=X;window.addMatchingPair=Y;window.removeMatchingPair=Z;window.addOrderingItem=ee;window.removeOrderingItem=te;window.previewQuestion=he;window.closePreviewModal=D;
