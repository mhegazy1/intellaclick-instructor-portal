import{t as s}from"./toast-Cbd37M37.js";/* empty css               *//* empty css                       */import{q as B}from"./api-Cc5qfUA_.js";import{l as w}from"./logger-CXzo1yMG.js";let d=[],k=null,v=null,p=4,f=4,g=4,y=4;document.addEventListener("DOMContentLoaded",function(){D(),document.getElementById("quizForm").addEventListener("submit",J),E(4),q(4),I(4),b(4),O();const e=new URLSearchParams(window.location.search).get("id");e&&N(e)});function E(r){p=r;const e=document.getElementById("mcqOptionsContainer"),i={};let n=null;for(let o=0;o<26;o++){const t=String.fromCharCode(65+o),l=document.getElementById(`option${t}`),a=document.querySelector(`input[name="correctAnswer"][value="${t}"]`);l&&(i[t]=l.value),a&&a.checked&&(n=t)}e.innerHTML="";for(let o=0;o<r;o++){const t=String.fromCharCode(65+o),l=document.createElement("div");l.className="radio-option",l.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${t}" ${n===t||o===0&&!n?"checked":""}>
                    <input type="text" id="option${t}" placeholder="Option ${t}" value="${i[t]||""}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,e.appendChild(l)}}function q(r){f=r;const e=document.getElementById("pollOptionsContainer"),i={};for(let n=0;n<26;n++){const o=String.fromCharCode(65+n),t=document.getElementById(`pollOption${o}`);t&&(i[o]=t.value)}e.innerHTML="";for(let n=0;n<r;n++){const o=String.fromCharCode(65+n),t=document.createElement("input");t.type="text",t.id=`pollOption${o}`,t.placeholder=`Option ${o}`,t.value=i[o]||"",t.style.width="100%",e.appendChild(t)}}function z(){if(p>=26){s.error("Maximum 26 options allowed");return}p++,E(p)}function A(){if(p<=2){s.error("Minimum 2 options required");return}p--,E(p)}function P(){if(f>=26){s.error("Maximum 26 options allowed");return}f++,q(f)}function M(){if(f<=2){s.error("Minimum 2 options required");return}f--,q(f)}function I(r){g=r;const e=document.getElementById("matchingPairsContainer"),i={};for(let n=1;n<=10;n++){const o=document.getElementById(`match${n}Left`),t=document.getElementById(`match${n}Right`);o&&(i[`${n}Left`]=o.value),t&&(i[`${n}Right`]=t.value)}e.innerHTML="";for(let n=0;n<r;n++){const o=n+1,t=document.createElement("input");t.type="text",t.id=`match${o}Left`,t.placeholder=`Item ${o}`,t.value=i[`${o}Left`]||"",t.style.width="100%";const l=document.createElement("input");l.type="text",l.id=`match${o}Right`,l.placeholder=`Match ${o}`,l.value=i[`${o}Right`]||"",l.style.width="100%",e.appendChild(t),e.appendChild(l)}}function S(){if(g>=10){s.error("Maximum 10 pairs allowed");return}g++,I(g)}function L(){if(g<=2){s.error("Minimum 2 pairs required");return}g--,I(g)}function b(r){y=r;const e=document.getElementById("orderingItemsContainer"),i={};for(let n=1;n<=10;n++){const o=document.getElementById(`order${n}`);o&&(i[n]=o.value)}e.innerHTML="";for(let n=0;n<r;n++){const o=n+1,t=document.createElement("input");t.type="text",t.id=`order${o}`,t.placeholder=`${H(o)} item`,t.value=i[o]||"",t.style.width="100%",e.appendChild(t)}}function R(){if(y>=10){s.error("Maximum 10 items allowed");return}y++,b(y)}function F(){if(y<=2){s.error("Minimum 2 items required");return}y--,b(y)}function H(r){const e=["th","st","nd","rd"],i=r%100;return r+(e[(i-20)%10]||e[i]||e[0])}function D(){localStorage.getItem("token")||(window.location.href="login.html")}async function N(r){try{w.debug("Loading quiz for editing:",r);const e=await B.getById(r),i=e.quiz||e;k=r,document.getElementById("quizTitle").value=i.title||"",document.getElementById("quizDescription").value=i.description||"",document.querySelector(".header h1").textContent="Edit Quiz",document.getElementById("saveButton").textContent="Update Quiz",i.questions&&i.questions.length>0&&(d=i.questions.map(n=>{const o=n.questionSnapshot||{};return{questionText:o.questionText||"",questionType:o.questionType||"mcq",options:o.options||[],correctAnswer:o.correctAnswer,pairs:o.pairs,correctOrder:o.correctOrder,points:n.points||10}}),x()),s.success("Quiz loaded for editing")}catch(e){w.error("Error loading quiz:",e),s.error("Failed to load quiz: "+e.message)}}function O(){const r=document.getElementById("questionType").value;switch(document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none",r){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block";break}}function V(){const r=document.getElementById("questionType").value,e=document.getElementById("questionText").value.trim();if(!e){s.error("Please enter a question");return}let i={questionText:e,questionType:r,points:10};try{switch(r){case"mcq":const n=[];let o=null;for(let c=0;c<p;c++){const u=String.fromCharCode(65+c),m=document.getElementById(`option${u}`);if(m&&m.value.trim()){n.push(m.value.trim());const C=document.querySelector(`input[name="correctAnswer"][value="${u}"]`);C&&C.checked&&(o=u)}}if(n.length<2){s.error("Please provide at least 2 answer options");return}i.options=n,i.correctAnswer=o;break;case"poll":const t=[];for(let c=0;c<f;c++){const u=String.fromCharCode(65+c),m=document.getElementById(`pollOption${u}`);m&&m.value.trim()&&t.push(m.value.trim())}if(t.length<2){s.error("Please provide at least 2 poll options");return}i.options=t;const l=document.getElementById("pollParticipationPoints").checked;i.awardParticipationPoints=l;break;case"tf":i.options=["True","False"],i.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const a=[];for(let c=1;c<=g;c++){const u=document.getElementById(`match${c}Left`).value.trim(),m=document.getElementById(`match${c}Right`).value.trim();u&&m&&a.push({left:u,right:m})}if(a.length<2){s.error("Please provide at least 2 matching pairs");return}i.pairs=a;break;case"ordering":const h=[];for(let c=1;c<=y;c++){const u=document.getElementById(`order${c}`).value.trim();u&&h.push(u)}if(h.length<2){s.error("Please provide at least 2 items to order");return}i.correctOrder=h;break;case"fillblank":const $=document.getElementById("blankAnswer").value.trim();if(!$){s.error("Please provide the correct answer");return}if(!e.includes("[blank]")){s.error("Please include [blank] in your question where the answer should go");return}i.correctAnswer=$;break}if(v!==null){d[v]=i,s.success("Question updated successfully!"),v=null;const n=document.querySelector('button[onclick="addQuestion()"]');n&&(n.textContent="+ Add This Question",n.className="btn btn-primary")}else d.push(i),s.success("Question added successfully!");Q(),x()}catch(n){w.error("Error adding question:",n),s.error("Error adding question: "+n.message)}}function Q(){document.getElementById("questionText").value="";for(let e=0;e<p;e++){const i=String.fromCharCode(65+e),n=document.getElementById(`option${i}`);n&&(n.value="")}for(let e=0;e<f;e++){const i=String.fromCharCode(65+e),n=document.getElementById(`pollOption${i}`);n&&(n.value="")}for(let e=1;e<=g;e++){const i=document.getElementById(`match${e}Left`),n=document.getElementById(`match${e}Right`);i&&(i.value=""),n&&(n.value="")}for(let e=1;e<=y;e++){const i=document.getElementById(`order${e}`);i&&(i.value="")}const r=document.getElementById("blankAnswer");r&&(r.value="")}function U(r){const e=d[r];switch(v=r,document.getElementById("questionText").value=e.questionText,document.getElementById("questionType").value=e.questionType,O(),e.questionType){case"mcq":if(e.options&&(E(e.options.length),e.options.forEach((o,t)=>{const l=String.fromCharCode(65+t),a=document.getElementById(`option${l}`);a&&(a.value=o)}),e.correctAnswer)){const o=document.querySelector(`input[name="correctAnswer"][value="${e.correctAnswer}"]`);o&&(o.checked=!0)}break;case"poll":e.options&&(q(e.options.length),e.options.forEach((o,t)=>{const l=String.fromCharCode(65+t),a=document.getElementById(`pollOption${l}`);a&&(a.value=o)}));break;case"tf":if(e.correctAnswer){const o=document.querySelector(`input[name="tfAnswer"][value="${e.correctAnswer}"]`);o&&(o.checked=!0)}break;case"matching":e.pairs&&(I(e.pairs.length),e.pairs.forEach((o,t)=>{const l=t+1,a=document.getElementById(`match${l}Left`),h=document.getElementById(`match${l}Right`);a&&(a.value=o.left),h&&(h.value=o.right)}));break;case"ordering":e.correctOrder&&(b(e.correctOrder.length),e.correctOrder.forEach((o,t)=>{const l=document.getElementById(`order${t+1}`);l&&(l.value=o)}));break;case"fillblank":e.correctAnswer&&(document.getElementById("blankAnswer").value=e.correctAnswer);break}const i=document.querySelector('button[onclick="addQuestion()"]');i&&(i.textContent="Update Question",i.className="btn btn-success");const n=document.getElementById("cancelEditBtn");n&&(n.style.display="inline-block"),document.getElementById("questionText").scrollIntoView({behavior:"smooth",block:"center"}),s.success("Question loaded for editing")}function j(r){window.confirm("Remove this question?")&&(d.splice(r,1),x(),v===r&&T(),s.success("Question removed"))}function T(){v=null,Q();const r=document.querySelector('button[onclick="addQuestion()"]');r&&(r.textContent="+ Add This Question",r.className="btn btn-primary");const e=document.getElementById("cancelEditBtn");e&&(e.style.display="none"),s.success("Edit cancelled")}function x(){const r=document.getElementById("questionsList");if(d.length===0){r.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}r.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${d.length} Question(s) Added:</strong>
                </div>
                ${d.map((e,i)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${i+1}: ${e.questionText}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${G(e.questionType)}</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="editQuestion(${i})">Edit</button>
                            <button type="button" class="btn btn-danger btn-small" onclick="removeQuestion(${i})">Remove</button>
                        </div>
                    </div>
                `).join("")}
            `}function G(r){return{mcq:"Multiple Choice",poll:"Poll",tf:"True/False",matching:"Matching",ordering:"Put in Order",fillblank:"Fill in the Blank"}[r]||r.toUpperCase()}async function J(r){r.preventDefault();const e=document.getElementById("quizTitle").value.trim(),i=document.getElementById("quizDescription").value.trim();if(!e){s.error("Please enter a quiz title");return}if(d.length===0){s.error("Please add at least one question to the quiz");return}const n=d.map(t=>({questionSnapshot:{questionText:t.questionText,questionType:t.questionType,options:t.options,correctAnswer:t.correctAnswer,pairs:t.pairs,correctOrder:t.correctOrder},points:t.points||10})),o={title:e,description:i,type:"standard",questions:n,questionCount:n.length,settings:{shuffleQuestions:!1,shuffleAnswers:!1,showCorrectAnswers:!0}};try{document.getElementById("saveButton").disabled=!0,document.getElementById("saveButton").textContent="Saving...";let t;k?(t=await B.update(k,o),w.debug("Quiz updated:",t),s.success("Quiz updated successfully!")):(t=await B.create(o),w.debug("Quiz created:",t),s.success("Quiz saved successfully!")),setTimeout(()=>{window.location.href="quizzes.html"},1e3)}catch(t){w.error("Error saving quiz:",t),s.error("Failed to save quiz: "+t.message),document.getElementById("saveButton").disabled=!1,document.getElementById("saveButton").textContent="Save Quiz"}}function K(){d.length>0?window.confirm("Are you sure you want to cancel? All unsaved changes will be lost.")&&(window.location.href="quizzes.html"):window.location.href="quizzes.html"}function W(){const r=document.getElementById("questionText"),e=r.selectionStart,i=r.selectionEnd,n=r.value,o=n.substring(0,e)+"[blank]"+n.substring(i);r.value=o,r.selectionStart=r.selectionEnd=e+7,r.focus()}window.updateQuestionOptions=O;window.addQuestion=V;window.editQuestion=U;window.removeQuestion=j;window.cancelEditQuestion=T;window.cancelQuiz=K;window.insertBlank=W;window.addMcqOption=z;window.removeMcqOption=A;window.addPollOption=P;window.removePollOption=M;window.addMatchingPair=S;window.removeMatchingPair=L;window.addOrderingItem=R;window.removeOrderingItem=F;
