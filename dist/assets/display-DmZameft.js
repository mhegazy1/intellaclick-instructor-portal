import"./toast-93yYkT8V.js";/* empty css               */import{s as x}from"./api-Cc5qfUA_.js";import{l as t}from"./logger-gSLuc3Ra.js";let E,m,y,s=null,L=null,p=null,S=0,C=null,A=!1;document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search);if(E=e.get("id"),m=e.get("code"),!E||!m){alert("Invalid session parameters"),window.location.href="classes.html";return}document.getElementById("sessionCode").textContent=m,document.getElementById("joinUrl").textContent=`join.intellaclick.com/session/${m}`,new QRCode(document.getElementById("qrcode"),{text:`https://join.intellaclick.com/session/${m}`,width:180,height:180}),q(),setInterval(B,1e3),B();const i=document.getElementById("showCorrectAnswer");i&&i.addEventListener("change",()=>{i.dataset.userModified="true"})});function q(){try{y=io("https://api-modular.intellaclick.com",{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5}),y.on("connect",()=>{t.debug("Connected to Socket.IO"),y.emit("join-session",{sessionCode:m})}),y.on("connect_error",e=>{t.debug("Socket connection error (will retry):",e.message)}),y.on("question-sent",e=>{t.debug("New question received:",e),O(e.question)}),y.on("response-update",e=>{t.debug("Response update received:",e),D(e),B()}),y.on("new-response",e=>{t.debug("New response received:",e),B()}),y.on("question-ended",()=>{t.debug("Question ended"),p&&clearInterval(p)})}catch(e){t.error("Failed to initialize socket:",e)}}async function B(){try{const e=await x.getCurrentQuestionByCode(m);if(e.question)A=!1,(!s||s.id!==e.question.id)&&O(e.question);else{const d=document.getElementById("keepResults").checked;(!A||!d)&&k()}const i=await x.getByCodeFull(m);if(i.session){L=i.session,t.debug("=== SESSION DATA LOADED ==="),t.debug("Session showCorrectAnswer field:",i.session.showCorrectAnswer),t.debug("Session allowAnswerChange field:",i.session.allowAnswerChange);const d=document.getElementById("showCorrectAnswer");if(d&&!d.dataset.userModified){const l=i.session.showCorrectAnswer!==void 0?i.session.showCorrectAnswer:!1;t.debug("Setting checkbox to:",l),d.checked=l}if(document.getElementById("participantCount").textContent=i.session.participantCount||0,s&&i.session.responses){t.debug("Current question ID:",s.id),t.debug("All responses:",i.session.responses);const l=i.session.responses.filter(o=>(t.debug("Checking response:",o,"questionId:",o.questionId),o.questionId===s.id||o.questionId===s.questionId));t.debug("Filtered responses for current question:",l),document.getElementById("responseCount").textContent=l.length,v(l)}}}catch(e){t.error("Error polling session:",e)}}function O(e){s=e,A=!1,t.debug("=== DISPLAYING QUESTION ==="),t.debug("Full question object:",JSON.stringify(e,null,2)),t.debug("Question type:",e.type,e.questionType),t.debug("Has pairs?",!!e.pairs,e.pairs),t.debug("Has leftColumn?",!!e.leftColumn,e.leftColumn),t.debug("Has rightColumn?",!!e.rightColumn,e.rightColumn),t.debug("Has items?",!!e.items,e.items),t.debug("Has correctOrder?",!!e.correctOrder,e.correctOrder),t.debug("========================"),document.getElementById("waitingMessage").style.display="none",document.getElementById("questionCard").style.display="block";const i=e.type||e.questionType;let d=e.questionText||"";(i==="fill_blank"||i==="fillblank")&&(d=d.replace(/\[blank\]/gi,'<span style="display: inline-block; min-width: 120px; border-bottom: 3px solid #4F46E5; margin: 0 8px; height: 1.5em; vertical-align: bottom;"></span>')),document.getElementById("questionText").innerHTML=d,document.getElementById("questionNumber").textContent=`Question ${e.questionNumber||1}`;const l=document.getElementById("optionsGrid");if(l.innerHTML="",i==="ordering"){const o=e.shuffledOrderingItems||e.items||e.correctOrder||e.options||[];o.length>0&&o.forEach((c,n)=>{const r=document.createElement("div");r.className="option";const u=typeof c=="string"?c:c.text||c,a=String.fromCharCode(65+n);r.innerHTML=`
                            <div class="option-label">${a}</div>
                            <div class="option-text">${u}</div>
                        `,l.appendChild(r)})}else if(i==="matching"){if(e.pairs&&Array.isArray(e.pairs)){const o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr 1fr",o.style.gap="2rem";const c=document.createElement("div"),n=document.createElement("div"),r=e.pairs.map(g=>g.left),u=e.pairs.map(g=>g.right);c.innerHTML='<h3 style="margin-bottom: 1rem;">Match:</h3>'+r.map((g,h)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${String.fromCharCode(65+h)}. ${g}
                            </div>`).join("");const a=e.shuffledMatchingRight||u;n.innerHTML='<h3 style="margin-bottom: 1rem;">With:</h3>'+a.map((g,h)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${h+1}. ${g}
                            </div>`).join(""),o.appendChild(c),o.appendChild(n),l.appendChild(o)}else if(e.leftColumn&&e.rightColumn){const o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr 1fr",o.style.gap="2rem";const c=document.createElement("div"),n=document.createElement("div");c.innerHTML='<h3 style="margin-bottom: 1rem;">Match:</h3>'+e.leftColumn.map((u,a)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${String.fromCharCode(65+a)}. ${u}
                            </div>`).join("");const r=e.shuffledMatchingRight||e.rightColumn;n.innerHTML='<h3 style="margin-bottom: 1rem;">With:</h3>'+r.map((u,a)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${a+1}. ${u}
                            </div>`).join(""),o.appendChild(c),o.appendChild(n),l.appendChild(o)}}else if(i==="fill_blank"||i==="fillblank"){const o=document.createElement("div");o.style.textAlign="center",o.style.color="var(--text-secondary)",o.style.fontStyle="italic",o.style.padding="2rem",o.textContent="Fill in the blank",l.appendChild(o)}else e.options&&e.options.length>0&&e.options.forEach((o,c)=>{const n=document.createElement("div");n.className="option",(e.type==="boolean"||e.type==="true_false")&&n.classList.add("true-false");const r=typeof o=="string"?o:o.text,u=String.fromCharCode(65+c);n.innerHTML=`
                            <div class="option-label">${u}</div>
                            <div class="option-text">${r}</div>
                        `,l.appendChild(n)});e.timeLimit&&Q(e.timeLimit,e.startedAt),document.getElementById("addTimeBtn").disabled=!1,document.getElementById("addTime30Btn").disabled=!1,document.getElementById("endBtn").disabled=!1,document.getElementById("responseCount").textContent="0",v([])}function k(){s=null,document.getElementById("waitingMessage").style.display="block",document.getElementById("questionCard").style.display="none",p&&clearInterval(p),document.getElementById("addTimeBtn").disabled=!0,document.getElementById("addTime30Btn").disabled=!0,document.getElementById("endBtn").disabled=!0}function Q(e,i){p&&clearInterval(p);const d=new Date(i);C=new Date(d.getTime()+e*1e3),p=setInterval(()=>{S=Math.max(0,Math.floor((C-new Date)/1e3)),document.getElementById("timeLeft").textContent=S;const o=document.getElementById("timer");S<=10?o.classList.add("warning"):o.classList.remove("warning"),S<=0&&(clearInterval(p),$())},100)}function $(){const e=document.getElementById("showCorrectAnswer").checked;t.debug("=== TIMER EXPIRED - ANSWER DISPLAY CHECK ==="),t.debug("showCorrectAnswer checked?",e),t.debug("currentQuestion exists?",!!s),t.debug("currentQuestion has correctAnswer?",s?!!s.correctAnswer:!1),t.debug("Will highlight answer?",e&&s&&s.correctAnswer),e&&s&&s.correctAnswer!==void 0&&s.correctAnswer!==null?(t.debug("CALLING highlightCorrectAnswer() from timer expiration"),N(),document.getElementById("addTimeBtn").disabled=!0,document.getElementById("addTime30Btn").disabled=!0,document.getElementById("endBtn").disabled=!0):(t.debug("NOT highlighting answer on timer expiration"),t.debug("  Reason: showCorrect=",e,"hasQuestion=",!!s,"hasAnswer=",s?s.correctAnswer!==void 0&&s.correctAnswer!==null:!1))}function D(e){e&&(document.getElementById("responseCount").textContent=e.responseCount||0,e.responses&&v(e.responses))}function v(e){const i=document.getElementById("responseChart");if(i.innerHTML="",!s)return;t.debug("Updating chart with responses:",e),t.debug("Current question type:",s.type),t.debug("Current question options:",s.options);const d=s.type||s.questionType;d==="fill_blank"||d==="fillblank"?R(e,i):d==="matching"?H(e,i):d==="ordering"?G(e,i):M(e,i)}function M(e,i){if(!s.options)return;const d={};s.options.forEach((o,c)=>{const n=String.fromCharCode(65+c),r=typeof o=="string"?o:o.text||o.id;d[c]={letter:n,text:r,count:0}}),t.debug("Initialized counts:",d),e.forEach(o=>{t.debug("Processing response:",o.answer);for(let c=0;c<s.options.length;c++){const n=String.fromCharCode(65+c),r=typeof s.options[c]=="string"?s.options[c]:s.options[c].text||s.options[c].id;if(o.answer===n||o.answer===r||o.answer===r.toLowerCase()||o.answer===r.toUpperCase()){d[c].count++,t.debug(`Matched answer "${o.answer}" to option ${c} (${r})`);break}}}),t.debug("Final counts:",d);const l=e.length||1;Object.values(d).forEach(o=>{const c=Math.round(o.count/l*100),n=document.createElement("div");n.className="response-bar",n.innerHTML=`
                    <div class="response-option">${o.letter}</div>
                    <div class="response-bar-container">
                        <div class="response-bar-fill" style="width: ${c}%">
                            ${o.count>0?`<span class="response-count">${o.count}</span>`:""}
                        </div>
                    </div>
                    <span class="response-percent">${c}%</span>
                `,i.appendChild(n)})}function R(e,i){const d=document.createElement("div");if(d.style.fontWeight="600",d.style.marginBottom="1rem",d.style.color="var(--text-primary)",d.textContent=`${e.length} student${e.length===1?"":"s"} answered`,i.appendChild(d),A&&document.getElementById("showCorrectAnswer").checked&&s.correctAnswer!==void 0&&s.correctAnswer!==null){const l=document.createElement("div");l.style.padding="1rem",l.style.marginTop="1rem",l.style.background="rgba(76, 175, 80, 0.1)",l.style.border="2px solid #4caf50",l.style.borderRadius="8px",l.style.fontSize="1.1rem",l.style.fontWeight="600",l.style.color="#2e7d32",l.innerHTML=`<div style="margin-bottom: 0.5rem;">Correct Answer:</div><div style="font-size: 1.2rem;">${s.correctAnswer}</div>`,i.appendChild(l)}}function H(e,i){const d=document.createElement("div");d.style.fontWeight="600",d.style.marginBottom="1rem",d.style.color="var(--text-primary)",d.textContent=`${e.length} student${e.length===1?"":"s"} answered`,i.appendChild(d)}function G(e,i){const d=document.createElement("div");d.style.fontWeight="600",d.style.marginBottom="1rem",d.style.color="var(--text-primary)",d.textContent=`${e.length} student${e.length===1?"":"s"} answered`,i.appendChild(d)}async function P(e){if(!(!s||!C))try{await x.addQuestionTime(E,s.id,e),C=new Date(C.getTime()+e*1e3),t.debug(`âœ… Added ${e} seconds to timer. New end time:`,C)}catch(i){t.error("Error adding time:",i)}}async function U(){if(s)try{if(await x.endQuestionSession(E,s.id),A=!0,!document.getElementById("keepResults").checked)k();else{p&&clearInterval(p),document.getElementById("addTimeBtn").disabled=!0,document.getElementById("addTime30Btn").disabled=!0,document.getElementById("endBtn").disabled=!0;const i=document.getElementById("showCorrectAnswer").checked,d=s.type||s.questionType;t.debug("=== END QUESTION - ANSWER DISPLAY CHECK ==="),t.debug("showCorrectAnswer checkbox checked?",i),t.debug("Question type:",d),t.debug("currentQuestion has correctAnswer?",s.correctAnswer!==void 0&&s.correctAnswer!==null),t.debug("currentQuestion has pairs?",!!s.pairs),t.debug("currentQuestion has correctOrder?",!!s.correctOrder);const l=s.correctAnswer!==void 0&&s.correctAnswer!==null||d==="matching"&&s.pairs||d==="ordering"&&s.correctOrder;t.debug("Has answer data?",l),t.debug("Will highlight answer?",i&&l),i&&l?(t.debug("CALLING highlightCorrectAnswer()"),N()):t.debug("NOT highlighting answer")}}catch(e){t.error("Error ending question:",e)}}function N(){if(!s){t.debug("Cannot highlight - no question");return}const e=s.type||s.questionType;if(e==="matching"){F();return}if(e==="ordering"){j();return}if(e==="fill_blank"||e==="fillblank"){t.debug("Skipping highlight for question type:",e);return}if(s.correctAnswer===void 0||s.correctAnswer===null){t.debug("No correct answer to highlight");return}t.debug("Highlighting correct answer:",s.correctAnswer),t.debug("Question options:",s.options),document.getElementById("optionsGrid").querySelectorAll(".option").forEach((l,o)=>{const c=String.fromCharCode(65+o),n=typeof s.options[o]=="string"?s.options[o]:s.options[o].text||s.options[o].id,r=String(s.correctAnswer).toUpperCase(),u=String(n).toUpperCase();t.debug(`Checking option ${o}: letter=${c}, text=${n}, correct=${s.correctAnswer}`);const a=typeof s.correctAnswer=="number"&&s.correctAnswer===o,g=c===r,h=u===r||n===s.correctAnswer;(a||g||h)&&(t.debug(`Match found! Highlighting option ${o}`),l.classList.add("correct"))})}function F(){const e=["#4caf50","#2196f3","#ff9800","#9c27b0","#f44336","#00bcd4","#ff5722","#3f51b5"],i=s.pairs||[];if(i.length===0)return;const l=document.getElementById("optionsGrid").querySelector('div[style*="grid-template-columns"]');if(!l)return;const o=l.children[0],c=l.children[1];i.forEach((n,r)=>{const u=e[r%e.length],a=o.querySelectorAll('div[style*="padding"]');a[r].style.background=u,a[r].style.color="white",a[r].style.fontWeight="600",c.querySelectorAll('div[style*="padding"]').forEach(h=>{h.textContent.trim().replace(/^\d+\.\s*/,"")===n.right&&(h.style.background=u,h.style.color="white",h.style.fontWeight="600")})})}function j(){const e=s.correctOrder||s.items||[];if(t.debug("Ordering correct answer data:",{correctOrder:e,items:s.items,fullQuestion:s}),e.length===0){t.warn("No correct order found for ordering question");return}const d=document.getElementById("optionsGrid").querySelectorAll(".option");t.debug(`Found ${d.length} option elements to highlight`),d.forEach((l,o)=>{var r,u;const c=(u=(r=l.querySelector(".option-text"))==null?void 0:r.textContent)==null?void 0:u.trim();if(t.debug(`Option ${o}: "${c}"`),!c)return;const n=e.findIndex(a=>a===c);if(t.debug(`  Correct position: ${n}`),n>=0){const a=document.createElement("div");a.style.cssText=`
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: #4caf50;
                        color: white;
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-weight: 600;
                        font-size: 16px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    `,a.textContent=(n+1).toString(),l.style.position="relative",l.style.background="rgba(76, 175, 80, 0.1)",l.style.border="2px solid #4caf50",l.appendChild(a),t.debug(`  Added badge: ${n+1}`)}})}function W(){document.getElementById("settingsPanel").classList.toggle("open")}let b=[],w=-1;async function _(){var e,i,d;try{if(!localStorage.getItem("token")){alert("Please log in first");return}const o=sessionStorage.getItem("questionQueue_"+m),c=sessionStorage.getItem("questionIndex_"+m);if(o&&(b=JSON.parse(o),w=c?parseInt(c):-1),!b||b.length===0){alert("No questions in queue. Add questions from the session page first.");return}if(w+1>=b.length){alert("No more questions in queue.");return}w++;const n=b[w];t.debug("ðŸ” Question from queue:",JSON.stringify(n,null,2));const r={...n};if(r.questionText=n.text||n.questionText,!r.questionText){t.error("âŒ Question missing text field. Available fields:",Object.keys(n)),alert("Question is missing text. Please check the question format.");return}delete r.text;const a={mcq:"multiple_choice",tf:"boolean",matching:"matching",ordering:"ordering",fillblank:"fill_blank"}[n.type]||n.type;if(r.questionType=a,r.type=a,r.timeLimit=n.timeLimit||60,r.points=n.points||10,n.type==="tf"&&(r.options=["True","False"]),n.type==="matching"){t.debug("ðŸ”µ MATCHING QUESTION - Original data:",{hasPairs:!!n.pairs,pairsLength:(e=n.pairs)==null?void 0:e.length,pairs:n.pairs,hasLeftColumn:!!n.leftColumn,hasRightColumn:!!n.rightColumn}),n.pairs&&Array.isArray(n.pairs)?(r.leftColumn=n.pairs.map(I=>I.left),r.rightColumn=n.pairs.map(I=>I.right),r.pairs=n.pairs,t.debug("ðŸ”µ MATCHING - Normalized to:",{leftColumn:r.leftColumn,rightColumn:r.rightColumn,pairs:r.pairs})):n.leftColumn&&n.rightColumn?(r.leftColumn=n.leftColumn,r.rightColumn=n.rightColumn):t.warn("âš ï¸ MATCHING QUESTION HAS NO DATA - pairs, leftColumn, and rightColumn all missing!"),n.correctPairs&&(r.correctPairs=n.correctPairs),r.pairs=r.pairs||[];const f=r.pairs.map(I=>I.right),T=f.sort(()=>Math.random()-.5);r.shuffledMatchingRight=T,console.log("ðŸŽ² MATCHING SHUFFLE DEBUG:",{originalPairs:r.pairs,rightItems:f,shuffledMatchingRight:T,willBeSentToBackend:!0})}if(n.type==="ordering"){t.debug("ðŸŸ¢ ORDERING QUESTION - Original data:",{hasCorrectOrder:!!n.correctOrder,correctOrderLength:(i=n.correctOrder)==null?void 0:i.length,correctOrder:n.correctOrder,hasItems:!!n.items,itemsLength:(d=n.items)==null?void 0:d.length,items:n.items}),n.correctOrder?(r.items=n.correctOrder,r.correctOrder=n.correctOrder,t.debug("ðŸŸ¢ ORDERING - Normalized to:",{items:r.items,correctOrder:r.correctOrder})):n.items?(r.items=n.items,r.correctOrder=n.items):t.warn("âš ï¸ ORDERING QUESTION HAS NO DATA - both correctOrder and items are missing!"),r.correctOrder=r.correctOrder||[];const f=[...r.correctOrder].sort(()=>Math.random()-.5);r.shuffledOrderingItems=f,console.log("ðŸŽ² ORDERING SHUFFLE DEBUG:",{originalOrder:r.correctOrder,shuffledOrderingItems:f,willBeSentToBackend:!0})}t.debug("=== SENDING QUESTION DEBUG ==="),t.debug("Original question from queue:",n),t.debug("Normalized question to send:",r),t.debug("questionText field:",r.questionText),t.debug("timeLimit field:",r.timeLimit),t.debug("points field:",r.points),console.log("ðŸ“¤ SENDING TO BACKEND:",{type:r.type,hasShuffledMatchingRight:!!r.shuffledMatchingRight,shuffledMatchingRight:r.shuffledMatchingRight,hasShuffledOrderingItems:!!r.shuffledOrderingItems,shuffledOrderingItems:r.shuffledOrderingItems,fullQuestion:r});const g=await fetch(`https://api-modular.intellaclick.com/api/sessions/${E}/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(r)});if(!g.ok){const f=await g.json();throw t.error("API Error:",f),new Error(f.error||"Failed to send question")}const h=await g.json();t.debug("âœ… Question sent successfully:",h),sessionStorage.setItem("questionIndex_"+m,w.toString()),document.getElementById("nextQuestionBtn").disabled=w+1>=b.length}catch(l){t.error("Error sending question:",l),alert("Failed to send question: "+l.message)}}function z(){const e=sessionStorage.getItem("questionQueue_"+m);if(!e){alert("No questions to save. Add questions to the session first.");return}const i=JSON.parse(e);if(i.length===0){alert("No questions to save.");return}const d=prompt("Enter a name for this question set:",`Session ${m} Questions`);if(!d)return;const l=JSON.parse(localStorage.getItem("savedQuestionSets")||"[]"),o={id:"qset_"+Date.now(),name:d,questions:i,createdAt:new Date().toISOString(),questionCount:i.length};l.push(o),localStorage.setItem("savedQuestionSets",JSON.stringify(l)),alert(`âœ… Saved "${d}" with ${i.length} questions!

You can load this question set from the session creation page.`),document.getElementById("settingsPanel").classList.remove("open")}function J(){const e=document.getElementById("showSessionInfo").checked,i=document.getElementById("showQuestion").checked,d=document.getElementById("showTimer").checked,l=document.getElementById("showAnalytics").checked,o=document.getElementById("showControls").checked;document.getElementById("sessionInfo").classList.toggle("hidden",!e),document.getElementById("questionArea").classList.toggle("hidden",!i),document.getElementById("timer").style.visibility=d?"visible":"hidden",document.getElementById("analyticsPanel").classList.toggle("hidden",!l),document.getElementById("controlBar").classList.toggle("hidden",!o);const c=document.getElementById("questionArea");!e&&!l?(c.style.left="1.5rem",c.style.right="1.5rem"):e?l?(c.style.left="calc(1.5rem + 240px + 1.5rem)",c.style.right="calc(1.5rem + 380px + 1.5rem)"):(c.style.left="calc(1.5rem + 240px + 1.5rem)",c.style.right="1.5rem"):(c.style.left="1.5rem",c.style.right="calc(1.5rem + 380px + 1.5rem)")}window.toggleSettings=W;window.sendNextQuestion=_;window.addTime=P;window.endQuestion=U;window.applySettings=J;window.saveSessionQuestions=z;
