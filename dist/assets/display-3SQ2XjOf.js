import"./toast-93yYkT8V.js";/* empty css               */import{s as x}from"./api-BBvzFwfC.js";import{l as t}from"./logger-gSLuc3Ra.js";let I,m,f,r=null,q=null,h=null,A=0,C=null,E=!1;document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search);if(I=e.get("id"),m=e.get("code"),!I||!m){alert("Invalid session parameters"),window.location.href="classes.html";return}document.getElementById("sessionCode").textContent=m,document.getElementById("joinUrl").textContent=`join.intellaclick.com/session/${m}`,new QRCode(document.getElementById("qrcode"),{text:`https://join.intellaclick.com/session/${m}`,width:180,height:180}),N(),setInterval(v,1e3),v();const s=document.getElementById("showCorrectAnswer");s&&s.addEventListener("change",()=>{s.dataset.userModified="true"})});function N(){try{f=io("https://api.intellaclick.com",{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5}),f.on("connect",()=>{t.debug("Connected to Socket.IO"),f.emit("join-session",{sessionCode:m})}),f.on("connect_error",e=>{t.debug("Socket connection error (will retry):",e.message)}),f.on("question-sent",e=>{t.debug("New question received:",e),B(e.question)}),f.on("response-update",e=>{t.debug("Response update received:",e),$(e),v()}),f.on("new-response",e=>{t.debug("New response received:",e),v()}),f.on("question-ended",()=>{t.debug("Question ended"),h&&clearInterval(h)})}catch(e){t.error("Failed to initialize socket:",e)}}async function v(){try{const e=await x.getCurrentQuestionByCode(m);if(e.question)E=!1,(!r||r.id!==e.question.id)&&B(e.question);else{const i=document.getElementById("keepResults").checked;(!E||!i)&&k()}const s=await x.getByCodeFull(m);if(s.session){q=s.session,t.debug("=== SESSION DATA LOADED ==="),t.debug("Session showCorrectAnswer field:",s.session.showCorrectAnswer),t.debug("Session allowAnswerChange field:",s.session.allowAnswerChange);const i=document.getElementById("showCorrectAnswer");if(i&&!i.dataset.userModified){const l=s.session.showCorrectAnswer!==void 0?s.session.showCorrectAnswer:!1;t.debug("Setting checkbox to:",l),i.checked=l}if(document.getElementById("participantCount").textContent=s.session.participantCount||0,r&&s.session.responses){t.debug("Current question ID:",r.id),t.debug("All responses:",s.session.responses);const l=s.session.responses.filter(o=>(t.debug("Checking response:",o,"questionId:",o.questionId),o.questionId===r.id||o.questionId===r.questionId));t.debug("Filtered responses for current question:",l),document.getElementById("responseCount").textContent=l.length,S(l)}}}catch(e){t.error("Error polling session:",e)}}function T(e){const s=[...e];for(let i=s.length-1;i>0;i--){const l=Math.floor(Math.random()*(i+1));[s[i],s[l]]=[s[l],s[i]]}return s}function B(e){r=e,E=!1,t.debug("=== DISPLAYING QUESTION ==="),t.debug("Full question object:",JSON.stringify(e,null,2)),t.debug("Question type:",e.type,e.questionType),t.debug("Has pairs?",!!e.pairs,e.pairs),t.debug("Has leftColumn?",!!e.leftColumn,e.leftColumn),t.debug("Has rightColumn?",!!e.rightColumn,e.rightColumn),t.debug("Has items?",!!e.items,e.items),t.debug("Has correctOrder?",!!e.correctOrder,e.correctOrder),t.debug("========================"),document.getElementById("waitingMessage").style.display="none",document.getElementById("questionCard").style.display="block";const s=e.type||e.questionType;let i=e.questionText||"";(s==="fill_blank"||s==="fillblank")&&(i=i.replace(/\[blank\]/gi,'<span style="display: inline-block; min-width: 120px; border-bottom: 3px solid #4F46E5; margin: 0 8px; height: 1.5em; vertical-align: bottom;"></span>')),document.getElementById("questionText").innerHTML=i,document.getElementById("questionNumber").textContent=`Question ${e.questionNumber||1}`;const l=document.getElementById("optionsGrid");if(l.innerHTML="",s==="ordering"){const o=e.items||e.correctOrder||e.options||[];o.length>0&&T(o).forEach((n,d)=>{const u=document.createElement("div");u.className="option";const a=typeof n=="string"?n:n.text||n,g=String.fromCharCode(65+d);u.innerHTML=`
                            <div class="option-label">${g}</div>
                            <div class="option-text">${a}</div>
                        `,l.appendChild(u)})}else if(s==="matching"){if(e.pairs&&Array.isArray(e.pairs)){const o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr 1fr",o.style.gap="2rem";const c=document.createElement("div"),n=document.createElement("div"),d=e.pairs.map(g=>g.left),u=e.pairs.map(g=>g.right);c.innerHTML='<h3 style="margin-bottom: 1rem;">Match:</h3>'+d.map((g,p)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${String.fromCharCode(65+p)}. ${g}
                            </div>`).join("");const a=T(u);n.innerHTML='<h3 style="margin-bottom: 1rem;">With:</h3>'+a.map((g,p)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${p+1}. ${g}
                            </div>`).join(""),o.appendChild(c),o.appendChild(n),l.appendChild(o)}else if(e.leftColumn&&e.rightColumn){const o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr 1fr",o.style.gap="2rem";const c=document.createElement("div"),n=document.createElement("div");c.innerHTML='<h3 style="margin-bottom: 1rem;">Match:</h3>'+e.leftColumn.map((u,a)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${String.fromCharCode(65+a)}. ${u}
                            </div>`).join("");const d=T(e.rightColumn);n.innerHTML='<h3 style="margin-bottom: 1rem;">With:</h3>'+d.map((u,a)=>`<div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(248,249,250,0.8); border-radius: 8px;">
                                ${a+1}. ${u}
                            </div>`).join(""),o.appendChild(c),o.appendChild(n),l.appendChild(o)}}else if(s==="fill_blank"||s==="fillblank"){const o=document.createElement("div");o.style.textAlign="center",o.style.color="var(--text-secondary)",o.style.fontStyle="italic",o.style.padding="2rem",o.textContent="Fill in the blank",l.appendChild(o)}else e.options&&e.options.length>0&&e.options.forEach((o,c)=>{const n=document.createElement("div");n.className="option",(e.type==="boolean"||e.type==="true_false")&&n.classList.add("true-false");const d=typeof o=="string"?o:o.text,u=String.fromCharCode(65+c);n.innerHTML=`
                            <div class="option-label">${u}</div>
                            <div class="option-text">${d}</div>
                        `,l.appendChild(n)});e.timeLimit&&L(e.timeLimit,e.startedAt),document.getElementById("addTimeBtn").disabled=!1,document.getElementById("addTime30Btn").disabled=!1,document.getElementById("endBtn").disabled=!1,document.getElementById("responseCount").textContent="0",S([])}function k(){r=null,document.getElementById("waitingMessage").style.display="block",document.getElementById("questionCard").style.display="none",h&&clearInterval(h),document.getElementById("addTimeBtn").disabled=!0,document.getElementById("addTime30Btn").disabled=!0,document.getElementById("endBtn").disabled=!0}function L(e,s){h&&clearInterval(h);const i=new Date(s);C=new Date(i.getTime()+e*1e3),h=setInterval(()=>{A=Math.max(0,Math.floor((C-new Date)/1e3)),document.getElementById("timeLeft").textContent=A;const o=document.getElementById("timer");A<=10?o.classList.add("warning"):o.classList.remove("warning"),A<=0&&(clearInterval(h),Q())},100)}function Q(){const e=document.getElementById("showCorrectAnswer").checked;t.debug("=== TIMER EXPIRED - ANSWER DISPLAY CHECK ==="),t.debug("showCorrectAnswer checked?",e),t.debug("currentQuestion exists?",!!r),t.debug("currentQuestion has correctAnswer?",r?!!r.correctAnswer:!1),t.debug("Will highlight answer?",e&&r&&r.correctAnswer),e&&r&&r.correctAnswer!==void 0&&r.correctAnswer!==null?(t.debug("CALLING highlightCorrectAnswer() from timer expiration"),O(),document.getElementById("addTimeBtn").disabled=!0,document.getElementById("addTime30Btn").disabled=!0,document.getElementById("endBtn").disabled=!0):(t.debug("NOT highlighting answer on timer expiration"),t.debug("  Reason: showCorrect=",e,"hasQuestion=",!!r,"hasAnswer=",r?r.correctAnswer!==void 0&&r.correctAnswer!==null:!1))}function $(e){e&&(document.getElementById("responseCount").textContent=e.responseCount||0,e.responses&&S(e.responses))}function S(e){const s=document.getElementById("responseChart");if(s.innerHTML="",!r)return;t.debug("Updating chart with responses:",e),t.debug("Current question type:",r.type),t.debug("Current question options:",r.options);const i=r.type||r.questionType;i==="fill_blank"||i==="fillblank"?M(e,s):i==="matching"?R(e,s):i==="ordering"?H(e,s):D(e,s)}function D(e,s){if(!r.options)return;const i={};r.options.forEach((o,c)=>{const n=String.fromCharCode(65+c),d=typeof o=="string"?o:o.text||o.id;i[c]={letter:n,text:d,count:0}}),t.debug("Initialized counts:",i),e.forEach(o=>{t.debug("Processing response:",o.answer);for(let c=0;c<r.options.length;c++){const n=String.fromCharCode(65+c),d=typeof r.options[c]=="string"?r.options[c]:r.options[c].text||r.options[c].id;if(o.answer===n||o.answer===d||o.answer===d.toLowerCase()||o.answer===d.toUpperCase()){i[c].count++,t.debug(`Matched answer "${o.answer}" to option ${c} (${d})`);break}}}),t.debug("Final counts:",i);const l=e.length||1;Object.values(i).forEach(o=>{const c=Math.round(o.count/l*100),n=document.createElement("div");n.className="response-bar",n.innerHTML=`
                    <div class="response-option">${o.letter}</div>
                    <div class="response-bar-container">
                        <div class="response-bar-fill" style="width: ${c}%">
                            ${o.count>0?`<span class="response-count">${o.count}</span>`:""}
                        </div>
                    </div>
                    <span class="response-percent">${c}%</span>
                `,s.appendChild(n)})}function M(e,s){const i=document.createElement("div");if(i.style.fontWeight="600",i.style.marginBottom="1rem",i.style.color="var(--text-primary)",i.textContent=`${e.length} student${e.length===1?"":"s"} answered`,s.appendChild(i),E&&document.getElementById("showCorrectAnswer").checked&&r.correctAnswer!==void 0&&r.correctAnswer!==null){const l=document.createElement("div");l.style.padding="1rem",l.style.marginTop="1rem",l.style.background="rgba(76, 175, 80, 0.1)",l.style.border="2px solid #4caf50",l.style.borderRadius="8px",l.style.fontSize="1.1rem",l.style.fontWeight="600",l.style.color="#2e7d32",l.innerHTML=`<div style="margin-bottom: 0.5rem;">Correct Answer:</div><div style="font-size: 1.2rem;">${r.correctAnswer}</div>`,s.appendChild(l)}}function R(e,s){const i=document.createElement("div");i.style.fontWeight="600",i.style.marginBottom="1rem",i.style.color="var(--text-primary)",i.textContent=`${e.length} student${e.length===1?"":"s"} answered`,s.appendChild(i)}function H(e,s){const i=document.createElement("div");i.style.fontWeight="600",i.style.marginBottom="1rem",i.style.color="var(--text-primary)",i.textContent=`${e.length} student${e.length===1?"":"s"} answered`,s.appendChild(i)}async function G(e){if(!(!r||!C))try{await x.addQuestionTime(I,r.id,e),C=new Date(C.getTime()+e*1e3),t.debug(`✅ Added ${e} seconds to timer. New end time:`,C)}catch(s){t.error("Error adding time:",s)}}async function P(){if(r)try{if(await x.endQuestionSession(I,r.id),E=!0,!document.getElementById("keepResults").checked)k();else{h&&clearInterval(h),document.getElementById("addTimeBtn").disabled=!0,document.getElementById("addTime30Btn").disabled=!0,document.getElementById("endBtn").disabled=!0;const s=document.getElementById("showCorrectAnswer").checked,i=r.type||r.questionType;t.debug("=== END QUESTION - ANSWER DISPLAY CHECK ==="),t.debug("showCorrectAnswer checkbox checked?",s),t.debug("Question type:",i),t.debug("currentQuestion has correctAnswer?",r.correctAnswer!==void 0&&r.correctAnswer!==null),t.debug("currentQuestion has pairs?",!!r.pairs),t.debug("currentQuestion has correctOrder?",!!r.correctOrder);const l=r.correctAnswer!==void 0&&r.correctAnswer!==null||i==="matching"&&r.pairs||i==="ordering"&&r.correctOrder;t.debug("Has answer data?",l),t.debug("Will highlight answer?",s&&l),s&&l?(t.debug("CALLING highlightCorrectAnswer()"),O()):t.debug("NOT highlighting answer")}}catch(e){t.error("Error ending question:",e)}}function O(){if(!r){t.debug("Cannot highlight - no question");return}const e=r.type||r.questionType;if(e==="matching"){j();return}if(e==="ordering"){U();return}if(e==="fill_blank"||e==="fillblank"){t.debug("Skipping highlight for question type:",e);return}if(r.correctAnswer===void 0||r.correctAnswer===null){t.debug("No correct answer to highlight");return}t.debug("Highlighting correct answer:",r.correctAnswer),t.debug("Question options:",r.options),document.getElementById("optionsGrid").querySelectorAll(".option").forEach((l,o)=>{const c=String.fromCharCode(65+o),n=typeof r.options[o]=="string"?r.options[o]:r.options[o].text||r.options[o].id,d=String(r.correctAnswer).toUpperCase(),u=String(n).toUpperCase();t.debug(`Checking option ${o}: letter=${c}, text=${n}, correct=${r.correctAnswer}`);const a=typeof r.correctAnswer=="number"&&r.correctAnswer===o,g=c===d,p=u===d||n===r.correctAnswer;(a||g||p)&&(t.debug(`Match found! Highlighting option ${o}`),l.classList.add("correct"))})}function j(){const e=["#4caf50","#2196f3","#ff9800","#9c27b0","#f44336","#00bcd4","#ff5722","#3f51b5"],s=r.pairs||[];if(s.length===0)return;const l=document.getElementById("optionsGrid").querySelector('div[style*="grid-template-columns"]');if(!l)return;const o=l.children[0],c=l.children[1];s.forEach((n,d)=>{const u=e[d%e.length],a=o.querySelectorAll('div[style*="padding"]');a[d].style.background=u,a[d].style.color="white",a[d].style.fontWeight="600",c.querySelectorAll('div[style*="padding"]').forEach(p=>{p.textContent.trim().replace(/^\d+\.\s*/,"")===n.right&&(p.style.background=u,p.style.color="white",p.style.fontWeight="600")})})}function U(){const e=r.correctOrder||r.items||[];if(t.debug("Ordering correct answer data:",{correctOrder:e,items:r.items,fullQuestion:r}),e.length===0){t.warn("No correct order found for ordering question");return}const i=document.getElementById("optionsGrid").querySelectorAll(".option");t.debug(`Found ${i.length} option elements to highlight`),i.forEach((l,o)=>{var d,u;const c=(u=(d=l.querySelector(".option-text"))==null?void 0:d.textContent)==null?void 0:u.trim();if(t.debug(`Option ${o}: "${c}"`),!c)return;const n=e.findIndex(a=>a===c);if(t.debug(`  Correct position: ${n}`),n>=0){const a=document.createElement("div");a.style.cssText=`
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: #4caf50;
                        color: white;
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-weight: 600;
                        font-size: 16px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    `,a.textContent=(n+1).toString(),l.style.position="relative",l.style.background="rgba(76, 175, 80, 0.1)",l.style.border="2px solid #4caf50",l.appendChild(a),t.debug(`  Added badge: ${n+1}`)}})}function W(){document.getElementById("settingsPanel").classList.toggle("open")}let b=[],w=-1;async function _(){var e,s,i;try{if(!localStorage.getItem("token")){alert("Please log in first");return}const o=sessionStorage.getItem("questionQueue_"+m),c=sessionStorage.getItem("questionIndex_"+m);if(o&&(b=JSON.parse(o),w=c?parseInt(c):-1),!b||b.length===0){alert("No questions in queue. Add questions from the session page first.");return}if(w+1>=b.length){alert("No more questions in queue.");return}w++;const n=b[w];t.debug("🔍 Question from queue:",JSON.stringify(n,null,2));const d={...n};if(d.questionText=n.text||n.questionText,!d.questionText){t.error("❌ Question missing text field. Available fields:",Object.keys(n)),alert("Question is missing text. Please check the question format.");return}delete d.text;const a={mcq:"multiple_choice",tf:"boolean",matching:"matching",ordering:"ordering",fillblank:"fill_blank"}[n.type]||n.type;d.questionType=a,d.type=a,d.timeLimit=n.timeLimit||60,d.points=n.points||10,n.type==="tf"&&(d.options=["True","False"]),n.type==="matching"&&(t.debug("🔵 MATCHING QUESTION - Original data:",{hasPairs:!!n.pairs,pairsLength:(e=n.pairs)==null?void 0:e.length,pairs:n.pairs,hasLeftColumn:!!n.leftColumn,hasRightColumn:!!n.rightColumn}),n.pairs&&Array.isArray(n.pairs)?(d.leftColumn=n.pairs.map(y=>y.left),d.rightColumn=n.pairs.map(y=>y.right),d.pairs=n.pairs,t.debug("🔵 MATCHING - Normalized to:",{leftColumn:d.leftColumn,rightColumn:d.rightColumn,pairs:d.pairs})):n.leftColumn&&n.rightColumn?(d.leftColumn=n.leftColumn,d.rightColumn=n.rightColumn):t.warn("⚠️ MATCHING QUESTION HAS NO DATA - pairs, leftColumn, and rightColumn all missing!"),n.correctPairs&&(d.correctPairs=n.correctPairs)),n.type==="ordering"&&(t.debug("🟢 ORDERING QUESTION - Original data:",{hasCorrectOrder:!!n.correctOrder,correctOrderLength:(s=n.correctOrder)==null?void 0:s.length,correctOrder:n.correctOrder,hasItems:!!n.items,itemsLength:(i=n.items)==null?void 0:i.length,items:n.items}),n.correctOrder?(d.items=n.correctOrder,d.correctOrder=n.correctOrder,t.debug("🟢 ORDERING - Normalized to:",{items:d.items,correctOrder:d.correctOrder})):n.items?(d.items=n.items,d.correctOrder=n.items):t.warn("⚠️ ORDERING QUESTION HAS NO DATA - both correctOrder and items are missing!")),t.debug("=== SENDING QUESTION DEBUG ==="),t.debug("Original question from queue:",n),t.debug("Normalized question to send:",d),t.debug("questionText field:",d.questionText),t.debug("timeLimit field:",d.timeLimit),t.debug("points field:",d.points);const g=await fetch(`https://api.intellaclick.com/api/sessions/${I}/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(d)});if(!g.ok){const y=await g.json();throw t.error("API Error:",y),new Error(y.error||"Failed to send question")}const p=await g.json();t.debug("✅ Question sent successfully:",p),sessionStorage.setItem("questionIndex_"+m,w.toString()),document.getElementById("nextQuestionBtn").disabled=w+1>=b.length}catch(l){t.error("Error sending question:",l),alert("Failed to send question: "+l.message)}}function F(){const e=sessionStorage.getItem("questionQueue_"+m);if(!e){alert("No questions to save. Add questions to the session first.");return}const s=JSON.parse(e);if(s.length===0){alert("No questions to save.");return}const i=prompt("Enter a name for this question set:",`Session ${m} Questions`);if(!i)return;const l=JSON.parse(localStorage.getItem("savedQuestionSets")||"[]"),o={id:"qset_"+Date.now(),name:i,questions:s,createdAt:new Date().toISOString(),questionCount:s.length};l.push(o),localStorage.setItem("savedQuestionSets",JSON.stringify(l)),alert(`✅ Saved "${i}" with ${s.length} questions!

You can load this question set from the session creation page.`),document.getElementById("settingsPanel").classList.remove("open")}function z(){const e=document.getElementById("showSessionInfo").checked,s=document.getElementById("showQuestion").checked,i=document.getElementById("showTimer").checked,l=document.getElementById("showAnalytics").checked,o=document.getElementById("showControls").checked;document.getElementById("sessionInfo").classList.toggle("hidden",!e),document.getElementById("questionArea").classList.toggle("hidden",!s),document.getElementById("timer").style.visibility=i?"visible":"hidden",document.getElementById("analyticsPanel").classList.toggle("hidden",!l),document.getElementById("controlBar").classList.toggle("hidden",!o);const c=document.getElementById("questionArea");!e&&!l?(c.style.left="1.5rem",c.style.right="1.5rem"):e?l?(c.style.left="calc(1.5rem + 240px + 1.5rem)",c.style.right="calc(1.5rem + 380px + 1.5rem)"):(c.style.left="calc(1.5rem + 240px + 1.5rem)",c.style.right="1.5rem"):(c.style.left="1.5rem",c.style.right="calc(1.5rem + 380px + 1.5rem)")}window.toggleSettings=W;window.sendNextQuestion=_;window.addTime=G;window.endQuestion=P;window.applySettings=z;window.saveSessionQuestions=F;
