import{t as l}from"./toast-93yYkT8V.js";/* empty css               *//* empty css                       */import{c as M,s as N}from"./api-Cc5qfUA_.js";import{l as r}from"./logger-gSLuc3Ra.js";let q,v,B=null,p=[],b=null,h=4,w=4,I=4,E=4;document.addEventListener("DOMContentLoaded",function(){if(q=new URLSearchParams(window.location.search).get("classId"),!q){window.location.href="classes.html";return}R(),Y(),A(4),C(4),$(4),T(4),document.getElementById("sessionForm").addEventListener("submit",ie),_(),K();const e=sessionStorage.getItem("fromSavedSet"),o=sessionStorage.getItem("pendingQuestions");r.debug("üîµ Page loaded - checking for pending questions"),r.debug("fromSavedSet:",e),r.debug("pendingQuestions:",o?"exists":"none"),e==="true"&&o&&(r.debug("‚úÖ Auto-selecting Quick Poll mode"),setTimeout(()=>{O("quick")},500))});function R(){localStorage.getItem("token")||(window.location.href="login.html")}function A(n){h=n;const e=document.getElementById("mcqOptionsContainer"),o={};let t=null;for(let i=0;i<26;i++){const s=String.fromCharCode(65+i),a=document.getElementById(`option${s}`),d=document.querySelector(`input[name="correctAnswer"][value="${s}"]`);a&&(o[s]=a.value),d&&d.checked&&(t=s)}e.innerHTML="";for(let i=0;i<n;i++){const s=String.fromCharCode(65+i),a=document.createElement("div");a.className="radio-option",a.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${s}" ${t===s||i===0&&!t?"checked":""}>
                    <input type="text" id="option${s}" placeholder="Option ${s}" value="${o[s]||""}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,e.appendChild(a)}}function C(n){w=n;const e=document.getElementById("pollOptionsContainer"),o={};for(let t=0;t<26;t++){const i=String.fromCharCode(65+t),s=document.getElementById(`pollOption${i}`);s&&(o[i]=s.value)}e.innerHTML="";for(let t=0;t<n;t++){const i=String.fromCharCode(65+t),s=document.createElement("input");s.type="text",s.id=`pollOption${i}`,s.placeholder=`Option ${i}`,s.value=o[i]||"",s.style.width="100%",e.appendChild(s)}}function U(){if(h>=26){l.error("Maximum 26 options allowed");return}h++,A(h)}function D(){if(h<=2){l.error("Minimum 2 options required");return}h--,A(h)}function j(){if(w>=26){l.error("Maximum 26 options allowed");return}w++,C(w)}function F(){if(w<=2){l.error("Minimum 2 options required");return}w--,C(w)}function $(n){I=n;const e=document.getElementById("matchingPairsContainer"),o={};for(let t=1;t<=10;t++){const i=document.getElementById(`match${t}Left`),s=document.getElementById(`match${t}Right`);i&&(o[`${t}Left`]=i.value),s&&(o[`${t}Right`]=s.value)}e.innerHTML="";for(let t=0;t<n;t++){const i=t+1,s=document.createElement("input");s.type="text",s.id=`match${i}Left`,s.placeholder=`Item ${i}`,s.value=o[`${i}Left`]||"",s.style.width="100%";const a=document.createElement("input");a.type="text",a.id=`match${i}Right`,a.placeholder=`Match ${i}`,a.value=o[`${i}Right`]||"",a.style.width="100%",e.appendChild(s),e.appendChild(a)}}function H(){if(I>=10){l.error("Maximum 10 pairs allowed");return}I++,$(I)}function G(){if(I<=2){l.error("Minimum 2 pairs required");return}I--,$(I)}function T(n){E=n;const e=document.getElementById("orderingItemsContainer"),o={};for(let t=1;t<=10;t++){const i=document.getElementById(`order${t}`);i&&(o[t]=i.value)}e.innerHTML="";for(let t=0;t<n;t++){const i=t+1,s=document.createElement("input");s.type="text",s.id=`order${i}`,s.placeholder=`${W(i)} item`,s.value=o[i]||"",s.style.width="100%",e.appendChild(s)}}function J(){if(E>=10){l.error("Maximum 10 items allowed");return}E++,T(E)}function V(){if(E<=2){l.error("Minimum 2 items required");return}E--,T(E)}function W(n){const e=["th","st","nd","rd"],o=n%100;return n+(e[(o-20)%10]||e[o]||e[0])}async function _(){try{const n=await fetch("https://api-modular.intellaclick.com/api/users/session-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(n.ok){const o=(await n.json()).settings;o.allowAnonymous!==void 0&&(document.getElementById("allowAnonymous").checked=o.allowAnonymous),o.openToAll!==void 0&&(document.getElementById("openToAll").checked=o.openToAll),o.allowAnswerChange!==void 0&&(document.getElementById("allowAnswerChange").checked=o.allowAnswerChange),o.showCorrectAnswer!==void 0&&(document.getElementById("showCorrectAnswer").checked=o.showCorrectAnswer),o.enableGamification!==void 0&&(document.getElementById("enableGamification").checked=o.enableGamification),o.autoSaveQuestions!==void 0&&(document.getElementById("autoSaveQuestions").checked=o.autoSaveQuestions),r.debug("‚úÖ Loaded saved session settings from backend:",o)}else r.debug("No saved settings found, using defaults")}catch(n){r.error("Error loading saved settings:",n)}}async function K(){try{const n=await fetch("https://api-modular.intellaclick.com/api/users/question-defaults",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(n.ok){const o=(await n.json()).defaults;return o.defaultTimeLimit!==void 0&&(document.getElementById("defaultTimeLimit").value=o.defaultTimeLimit),o.defaultPoints!==void 0&&(document.getElementById("defaultPoints").value=o.defaultPoints),o.defaultAwardParticipation!==void 0&&(document.getElementById("defaultAwardParticipation").checked=o.defaultAwardParticipation),r.debug("‚úÖ Loaded question defaults from backend:",o),o}else return r.debug("No saved question defaults found, using system defaults"),null}catch(n){return r.error("Error loading question defaults:",n),null}}async function X(){try{const n={defaultTimeLimit:parseInt(document.getElementById("defaultTimeLimit").value)||60,defaultPoints:parseInt(document.getElementById("defaultPoints").value)||10,defaultAwardParticipation:document.getElementById("defaultAwardParticipation").checked};return(await fetch("https://api-modular.intellaclick.com/api/users/question-defaults",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(n)})).ok?(r.debug("‚úÖ Question defaults saved to backend:",n),n):(r.error("Failed to save question defaults"),null)}catch(n){return r.error("Error saving question defaults:",n),null}}async function Y(){try{const n=await M.getById(q);v=n.class||n,document.getElementById("classInfo").innerHTML=`
                    <strong>${v.name}</strong> - ${v.code} ${v.section?"("+v.section+")":""}
                `;const e=new Date,o=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),t=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});document.getElementById("sessionName").value=`${v.name} Session - ${o} ${t}`}catch(n){r.error("Error loading class:",n),l.error("Failed to load class information")}}function O(n){if(r.debug("=== selectSessionType called ==="),r.debug("type:",n),B=n,n!=="quick")p=[];else{const s=sessionStorage.getItem("fromSavedSet"),a=sessionStorage.getItem("pendingQuestions");if(r.debug("fromSavedSet:",s),r.debug("pendingQuestions:",a?`${a.length} chars`:"null"),s==="true"&&a)try{p=JSON.parse(a),r.debug("‚úÖ Loaded questions:",p.length),sessionStorage.removeItem("fromSavedSet"),sessionStorage.removeItem("pendingQuestions"),l.success(`Loaded ${p.length} questions from saved set`)}catch(d){r.error("‚ùå Error loading saved questions:",d)}else r.debug("No pending questions found");P()}document.querySelectorAll(".option-card").forEach(s=>{s.classList.remove("selected")}),document.getElementById(n+"Option").classList.add("selected"),document.getElementById("sessionConfig").style.display="block",document.getElementById("quickPollConfig").style.display=n==="quick"?"block":"none",document.getElementById("quizConfig").style.display=n==="quiz"?"block":"none",document.getElementById("desktopInstructions").style.display=n==="desktop"?"block":"none";const e=n!=="desktop";document.getElementById("sessionSettings").style.display=e?"block":"none",document.getElementById("sessionOptions").style.display=e?"block":"none",document.getElementById("sessionName").parentElement.style.display=e?"block":"none",document.getElementById("startButton").style.display=n==="desktop"?"none":"inline-block",n==="quiz"?Z():n==="desktop"&&ee();const o=new Date,t=o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),i=o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});document.getElementById("sessionName").value=`${v.name} Session - ${t} ${i}`}async function Z(){try{const e=await(await fetch("https://api-modular.intellaclick.com/api/quizzes",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json(),o=document.getElementById("quizSelect"),t=document.getElementById("noQuizzesMessage");e.success&&e.quizzes&&e.quizzes.length>0?(o.innerHTML='<option value="">Select a quiz...</option>'+e.quizzes.map(i=>`<option value="${i._id}">${i.title} (${i.questionCount||0} questions)</option>`).join(""),t.style.display="none"):(o.innerHTML='<option value="">No quizzes available</option>',t.style.display="block")}catch(n){r.error("Error loading quizzes:",n);const e=document.getElementById("quizSelect");e.innerHTML='<option value="">Error loading quizzes</option>',l.error("Failed to load quizzes")}}function ee(){document.getElementById("desktopClassName").textContent=v.name,document.getElementById("desktopJoinCode").textContent=v.joinCode||"N/A"}function x(){const n=document.getElementById("questionType").value;switch(document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none",n){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block";break}}function te(){const n=document.getElementById("questionType").value,e=document.getElementById("questionText").value.trim();if(!e){l.error("Please enter a question");return}const o=parseInt(document.getElementById("duration").value)||60;let t={text:e,type:n,timeLimit:o,points:10};try{switch(n){case"mcq":const i=[],s=[];let a=null;for(let m=0;m<h;m++){const y=String.fromCharCode(65+m),k=document.getElementById(`option${y}`);if(k&&k.value.trim()){i.push(y),s.push(k.value.trim());const Q=document.querySelector(`input[name="correctAnswer"][value="${y}"]`);Q&&Q.checked&&(a=y)}}if(i.length<2){l.error("Please provide at least 2 answer options");return}t.options=i,t.optionTexts=s,t.correctAnswer=a;break;case"poll":const d=[],c=[];for(let m=0;m<w;m++){const y=String.fromCharCode(65+m),k=document.getElementById(`pollOption${y}`);k&&k.value.trim()&&(d.push(y),c.push(k.value.trim()))}if(d.length<2){l.error("Please provide at least 2 poll options");return}t.options=d,t.optionTexts=c;const f=document.getElementById("pollParticipationPoints").checked;t.awardParticipationPoints=f;break;case"tf":t.options=["True","False"],t.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const u=[];for(let m=1;m<=I;m++){const y=document.getElementById(`match${m}Left`).value.trim(),k=document.getElementById(`match${m}Right`).value.trim();y&&k&&u.push({left:y,right:k})}if(u.length<2){l.error("Please provide at least 2 matching pairs");return}t.pairs=u,r.debug("üîç Created matching question with pairs:",{pairs:u,questionPairs:t.pairs});break;case"ordering":const g=[];for(let m=1;m<=E;m++){const y=document.getElementById(`order${m}`).value.trim();y&&g.push(y)}if(g.length<2){l.error("Please provide at least 2 items to order");return}t.correctOrder=g;break;case"fillblank":const S=document.getElementById("blankAnswer").value.trim();if(!S){l.error("Please provide the correct answer");return}if(!e.includes("[blank]")){l.error("Please include [blank] in your question where the answer should go");return}t.correctAnswer=S;break}b!==null?(p[b]=t,r.debug("‚úÖ Updated question at index:",b),l.success("Question updated successfully!"),b=null,document.getElementById("addQuestionBtn").textContent="Add Question",document.getElementById("cancelEditBtn").style.display="none"):(p.push(t),r.debug("‚úÖ Added question to array:",{type:t.type,question:t,arrayLength:p.length}),l.success("Question added successfully!")),z(),P()}catch(i){l.error("Error adding question: "+i.message)}}function z(){document.getElementById("questionText").value="";for(let e=0;e<h;e++){const o=String.fromCharCode(65+e),t=document.getElementById(`option${o}`);t&&(t.value="")}for(let e=0;e<w;e++){const o=String.fromCharCode(65+e),t=document.getElementById(`pollOption${o}`);t&&(t.value="")}for(let e=1;e<=I;e++){const o=document.getElementById(`match${e}Left`),t=document.getElementById(`match${e}Right`);o&&(o.value=""),t&&(t.value="")}for(let e=1;e<=E;e++){const o=document.getElementById(`order${e}`);o&&(o.value="")}const n=document.getElementById("blankAnswer");n&&(n.value="")}function ne(n){window.confirm("Remove this question?")&&(p.splice(n,1),b===n?L():b!==null&&b>n&&b--,P())}function oe(n){const e=p[n];b=n,document.getElementById("addQuestionBtn").textContent="Update Question",document.getElementById("cancelEditBtn").style.display="inline-block",document.getElementById("questionType").value=e.type,x(),document.getElementById("questionText").value=e.text;const o=document.getElementById("duration");o&&(o.value=e.timeLimit||60);const t=document.getElementById("points");t&&(t.value=e.points||10),setTimeout(()=>{switch(e.type){case"mcq":h=e.options.length,A(h),setTimeout(()=>{e.optionTexts.forEach((c,f)=>{const u=String.fromCharCode(65+f),g=document.getElementById(`option${u}`);g&&(g.value=c)});const d=document.querySelector(`input[name="correctAnswer"][value="${e.correctAnswer}"]`);d&&(d.checked=!0)},50);break;case"poll":w=e.options.length,C(w),setTimeout(()=>{e.optionTexts.forEach((d,c)=>{const f=String.fromCharCode(65+c),u=document.getElementById(`pollOption${f}`);u&&(u.value=d)}),document.getElementById("pollParticipationPoints").checked=e.awardParticipationPoints||!1},50);break;case"tf":const s=document.querySelector(`input[name="tfAnswer"][value="${e.correctAnswer}"]`);s&&(s.checked=!0);break;case"matching":I=e.pairs.length,$(I),setTimeout(()=>{e.pairs.forEach((d,c)=>{const f=document.getElementById(`match${c+1}Left`),u=document.getElementById(`match${c+1}Right`);f&&(f.value=d.left),u&&(u.value=d.right)})},50);break;case"ordering":E=e.correctOrder.length,T(E),setTimeout(()=>{e.correctOrder.forEach((d,c)=>{const f=document.getElementById(`order${c+1}`);f&&(f.value=d)})},50);break;case"fillblank":const a=document.getElementById("blankAnswer");a&&(a.value=e.correctAnswer);break}const i=document.getElementById("quickPollConfig")||document.getElementById("questionText");i&&i.scrollIntoView({behavior:"smooth",block:"start"}),l.info('Editing question. Click "Update Question" when done.')},100)}function L(){b=null,document.getElementById("addQuestionBtn").textContent="+ Add This Question",document.getElementById("cancelEditBtn").style.display="none",z(),l.info("Edit cancelled")}function P(){const n=document.getElementById("questionsList");if(p.length===0){n.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}n.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${p.length} Question(s) Added:</strong>
                </div>
                ${p.map((e,o)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${o+1}: ${e.text}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${e.type.toUpperCase()}${e.awardParticipationPoints?" | Participation Points: ‚úì":""}</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="editQuickPollQuestion(${o})">Edit</button>
                            <button type="button" class="btn btn-danger btn-small" onclick="removeQuickPollQuestion(${o})">Remove</button>
                        </div>
                    </div>
                `).join("")}
            `}async function ie(n){if(n.preventDefault(),!B){l.error("Please select a session type");return}if(B==="desktop")return;await X();const o=document.getElementById("customSessionCode").value.trim()||Math.random().toString(36).substring(2,8).toUpperCase(),t={sessionCode:o,title:document.getElementById("sessionName").value,description:`${B==="quick"?"Quick Poll":"Quiz Session"} for ${v.name}`,requireLogin:!document.getElementById("allowAnonymous").checked,classId:q,restrictToEnrolled:!document.getElementById("openToAll").checked,gamification:{enabled:document.getElementById("enableGamification").checked},allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked};if(r.debug("=== CREATING SESSION WITH SETTINGS ==="),r.debug("showCorrectAnswer checkbox value:",document.getElementById("showCorrectAnswer").checked),r.debug("Session data being sent:",t),B==="quick"){if(p.length===0){l.error("Please add at least one question to the quick poll");return}t.questions=p}else if(B==="quiz"){const i=document.getElementById("quizSelect").value;if(!i){l.error("Please select a quiz");return}try{const s=await fetch(`https://api-modular.intellaclick.com/api/quizzes/${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Failed to load quiz");const a=await s.json(),d=a.quiz||a,c={defaultTimeLimit:parseInt(document.getElementById("defaultTimeLimit").value)||60,defaultPoints:parseInt(document.getElementById("defaultPoints").value)||10,defaultAwardParticipation:document.getElementById("defaultAwardParticipation").checked};r.debug("üìã Applying question defaults to imported quiz:",c);const f=(d.questions||[]).map(u=>{const g=u.questionSnapshot||{},S=g.questionType||g.type||"mcq";return{text:g.questionText||"",type:S,timeLimit:u.timeLimit||c.defaultTimeLimit,points:u.points||c.defaultPoints,awardParticipationPoints:c.defaultAwardParticipation,options:g.options,correctAnswer:g.correctAnswer,pairs:g.pairs,correctOrder:g.correctOrder,optionTexts:g.options}});if(t.questions=f,t.quizId=i,t.quizTitle=d.title,t.questions.length===0){l.error("Selected quiz has no questions");return}}catch(s){r.error("Error loading quiz:",s),l.error("Failed to load quiz data");return}}try{const i=await N.create(t),s=i.session||i,a={allowAnonymous:document.getElementById("allowAnonymous").checked,openToAll:document.getElementById("openToAll").checked,allowAnswerChange:document.getElementById("allowAnswerChange").checked,showCorrectAnswer:document.getElementById("showCorrectAnswer").checked,enableGamification:document.getElementById("enableGamification").checked,autoSaveQuestions:document.getElementById("autoSaveQuestions").checked};if(fetch("https://api-modular.intellaclick.com/api/users/session-settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(a)}).then(()=>{r.debug("‚úÖ Saved session settings to backend for next time")}).catch(c=>{r.error("Failed to save settings (non-critical):",c)}),l.success(`Session created! Code: ${s.sessionCode||o}`),t.questions&&t.questions.length>0){r.debug("üì¶ Storing questions in sessionStorage:",t.questions),sessionStorage.setItem("pendingQuestions",JSON.stringify(t.questions)),sessionStorage.setItem("currentQuestionIndex","0");const c=JSON.parse(sessionStorage.getItem("pendingQuestions"));r.debug("‚úÖ Verified stored questions:",c)}const d=document.getElementById("autoSaveQuestions").checked;r.debug("Auto-save checkbox state:",d),d&&t.questions&&t.questions.length>0?(r.debug("Auto-saving questions because checkbox is checked"),le(t.title,t.questions)):d||r.debug("‚è≠Ô∏è Skipping auto-save - user unchecked the box"),setTimeout(()=>{r.debug("=== REDIRECTING NOW ==="),window.location.href=`session.html?id=${s.id||s._id}&code=${s.sessionCode||o}&type=${B}`},5e3)}catch(i){r.error("Error creating session:",i),l.error(i.message||"Failed to create session")}}function se(){window.confirm("Are you sure you want to cancel?")&&(window.location.href="classes.html")}function re(){const n=window.location.href;sessionStorage.setItem("createSessionUrl",n),r.debug("Navigating to saved questions, returnUrl:",n),window.location.href=`saved-questions.html?returnUrl=${encodeURIComponent(n)}`}function ae(){const n=document.getElementById("questionText"),e=n.selectionStart,o=n.selectionEnd,t=n.value,i=t.substring(0,e)+"[blank]"+t.substring(o);n.value=i,n.selectionStart=n.selectionEnd=e+7,n.focus()}async function le(n,e){if(r.debug("=== AUTO-SAVE CALLED ==="),r.debug("Session name:",n),r.debug("Questions array:",e),r.debug("Questions length:",e==null?void 0:e.length),!e||e.length===0){r.debug("‚ùå No questions to save - skipping auto-save");return}const o=localStorage.getItem("token");if(!o){r.warn("‚ö†Ô∏è No authentication token - skipping auto-save (silent)");return}r.debug(`üîÑ Auto-saving "${n}" with ${e.length} questions to cloud...`);const t={name:n,questions:e,classId:null};r.debug("Payload being sent:",JSON.stringify(t,null,2));try{const i=await fetch("https://api-modular.intellaclick.com/api/question-sets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(t)});if(r.debug("Response status:",i.status),!i.ok){const a=await i.json();r.error("‚ùå Cloud API save failed:",a),r.error("Response status:",i.status),r.warn("‚ö†Ô∏è Question set auto-save failed, but session will continue");return}const s=await i.json();r.debug("‚úÖ Question set auto-saved to cloud successfully:",s)}catch(i){r.error("‚ùå Error auto-saving question set:",i),r.error("Error stack:",i.stack),r.warn("‚ö†Ô∏è Question set auto-save failed, but session will continue")}}window.selectSessionType=O;window.goToSavedQuestions=re;window.insertBlank=ae;window.updateQuestionOptions=x;window.addQuickPollQuestion=te;window.cancelSession=se;window.removeQuickPollQuestion=ne;window.editQuickPollQuestion=oe;window.cancelEdit=L;window.addMcqOption=U;window.removeMcqOption=D;window.addPollOption=j;window.removePollOption=F;window.addMatchingPair=H;window.removeMatchingPair=G;window.addOrderingItem=J;window.removeOrderingItem=V;
