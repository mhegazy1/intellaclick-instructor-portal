import{t as i}from"./toast-DdlZoz3i.js";/* empty css               */import{q as m}from"./api-BBvzFwfC.js";import{l as p}from"./logger-D123dQQV.js";let r=[],d=null,y=0,c=null;const f=new URLSearchParams(window.location.search);d=f.get("id");d&&g(d);async function g(n){try{const e=(await m.getById(n)).quiz;document.getElementById("quiz-title").value=e.title,document.getElementById("quiz-description").value=e.description||"",r=e.questions||[],a(),document.getElementById("pageTitle").textContent="Edit Quiz"}catch(t){p.error("Error loading quiz:",t),i.error("Failed to load quiz: "+t.message)}}window.createNewQuestion=function(){c=null,document.getElementById("builderQuestionText").value="",document.getElementById("builderQuestionType").value="mcq",document.getElementById("optionsList").innerHTML="",y=0,updateQuestionBuilderUI(),document.getElementById("questionBuilderModal").style.display="flex"};window.closeQuestionBuilder=function(){document.getElementById("questionBuilderModal").style.display="none"};window.updateQuestionBuilderUI=function(){const n=document.getElementById("builderQuestionType").value;if(document.getElementById("mcqOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("fillBlankOptions").style.display="none",n==="tf")document.getElementById("tfOptions").style.display="block";else if(n==="fillblank")document.getElementById("fillBlankOptions").style.display="block";else if(document.getElementById("mcqOptions").style.display="block",document.getElementById("optionsList").children.length===0)for(let e=0;e<4;e++)addOption()};window.addOption=function(){const n=document.getElementById("optionsList"),t=y++,e=document.createElement("div");e.style.cssText="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;",e.innerHTML=`
        <input type="radio" name="correctAnswer" value="${t}" ${t===0?"checked":""} style="width: 20px; height: 20px;">
        <input type="text" class="option-input" placeholder="Option ${String.fromCharCode(65+t)}" required style="flex: 1; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 6px;">
        <button type="button" onclick="removeOption(this)" style="padding: 0.5rem; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer;">âœ•</button>
      `,n.appendChild(e)};window.removeOption=function(n){document.getElementById("optionsList").children.length>2?n.parentElement.remove():i.error("You must have at least 2 options")};window.saveQuestion=function(n){n.preventDefault();try{const t=document.getElementById("builderQuestionType").value,e=document.getElementById("builderQuestionText").value.trim();if(!e){i.error("Please enter question text");return}const o={type:t,text:e,questionText:e};if(t==="mcq"){const l=Array.from(document.querySelectorAll(".option-input")).map(s=>s.value.trim()),u=parseInt(document.querySelector('input[name="correctAnswer"]:checked').value);if(l.some(s=>!s)){i.error("Please fill in all options");return}o.options=l,o.correctAnswer=u}else if(t==="tf")o.correctAnswer=document.getElementById("builderTFAnswer").value;else if(t==="fillblank"){const l=document.getElementById("builderFillBlankAnswers").value.trim();if(!l){i.error("Please enter at least one acceptable answer");return}const u=l.split(`
`).map(s=>s.trim()).filter(s=>s.length>0);if(u.length===0){i.error("Please enter at least one acceptable answer");return}o.correctAnswer=u}c!==null?(r[c]=o,i.success("Question updated")):(r.push(o),i.success("Question added")),a(),closeQuestionBuilder(),c=null,y=0,document.getElementById("optionsList").innerHTML=""}catch(t){p.error("Error saving question:",t),i.error("Error saving question: "+t.message)}};function w(){window.location.href=`saved-questions.html?returnUrl=${encodeURIComponent(window.location.href)}&mode=select`}function a(){const n=document.getElementById("question-list"),t=document.getElementById("question-count");if(r.length===0){n.innerHTML='<div class="empty-state"><p>No questions added yet. Click the buttons above to add questions.</p></div>',t.textContent="0 questions";return}n.innerHTML=r.map((e,o)=>{const l=e.text||e.questionText||"Question",u=e.type==="mcq"?"Multiple Choice":e.type==="tf"?"True/False":e.type==="fillblank"?"Fill in the Blank":"Unknown";let s="";return e.type==="mcq"&&e.options?s=`${e.options.length} options | Answer: ${e.options[e.correctAnswer]||"N/A"}`:e.type==="tf"?s=`Answer: ${e.correctAnswer}`:e.type==="fillblank"&&(s=`Accepted answers: ${(Array.isArray(e.correctAnswer)?e.correctAnswer:[e.correctAnswer]).join(", ")}`),`
          <div class="question-item">
            <div class="question-text">${o+1}. ${l}</div>
            <div class="question-meta">
              Type: ${u} | ${s}
              <button class="btn btn-danger btn-small" style="float: right; padding: 0.25rem 0.75rem; font-size: 0.875rem;"
                      onclick="window.removeQuestion(${o})">Remove</button>
            </div>
          </div>
        `}).join(""),t.textContent=`${r.length} question${r.length!==1?"s":""}`}window.removeQuestion=function(n){r.splice(n,1),a()};window.saveQuiz=async function(){const n=document.getElementById("quiz-title").value.trim(),t=document.getElementById("quiz-description").value.trim();if(!n){i.error("Please enter a quiz title");return}if(r.length===0){i.error("Please add at least one question to the quiz");return}const e={title:n,description:t,type:"standard",questions:r,settings:{}};try{let o;d?(o=await m.update(d,e),i.success("Quiz updated successfully!")):(o=await m.create(e),i.success("Quiz created successfully!")),setTimeout(()=>{window.location.href="quizzes.html"},1e3)}catch(o){p.error("Failed to save quiz:",o),i.error("Failed to save quiz: "+o.message)}};window.addEventListener("storage",n=>{if(n.key==="selected_questions"){const t=JSON.parse(n.newValue||"[]");t.length>0&&(r.push(...t),a(),i.success(`Added ${t.length} question(s) to quiz`),localStorage.removeItem("selected_questions"))}});window.addFromQuestionSets=w;
