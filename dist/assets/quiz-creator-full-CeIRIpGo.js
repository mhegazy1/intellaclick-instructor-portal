import{t as l}from"./toast-Cbd37M37.js";/* empty css               *//* empty css                       */import{q as b}from"./api-Cc5qfUA_.js";import{l as v}from"./logger-CXzo1yMG.js";import{g as M,a as A}from"./questionPreview-DWNg0Cim.js";const T=document.createElement("style");T.textContent=M();document.head.appendChild(T);let d=[],k=null,w=null,f=4,g=4,y=4,h=4;document.addEventListener("DOMContentLoaded",function(){j(),document.getElementById("quizForm").addEventListener("submit",Y),E(4),I(4),q(4),B(4),x();const e=new URLSearchParams(window.location.search).get("id");e&&G(e)});function E(r){f=r;const e=document.getElementById("mcqOptionsContainer"),i={};let o=null;for(let n=0;n<26;n++){const t=String.fromCharCode(65+n),s=document.getElementById(`option${t}`),c=document.querySelector(`input[name="correctAnswer"][value="${t}"]`);s&&(i[t]=s.value),c&&c.checked&&(o=t)}e.innerHTML="";for(let n=0;n<r;n++){const t=String.fromCharCode(65+n),s=document.createElement("div");s.className="radio-option",s.innerHTML=`
                    <input type="radio" name="correctAnswer" value="${t}" ${o===t||n===0&&!o?"checked":""}>
                    <input type="text" id="option${t}" placeholder="Option ${t}" value="${i[t]||""}" style="width: calc(100% - 40px); margin-left: 8px;">
                `,e.appendChild(s)}}function I(r){g=r;const e=document.getElementById("pollOptionsContainer"),i={};for(let o=0;o<26;o++){const n=String.fromCharCode(65+o),t=document.getElementById(`pollOption${n}`);t&&(i[n]=t.value)}e.innerHTML="";for(let o=0;o<r;o++){const n=String.fromCharCode(65+o),t=document.createElement("input");t.type="text",t.id=`pollOption${n}`,t.placeholder=`Option ${n}`,t.value=i[n]||"",t.style.width="100%",e.appendChild(t)}}function L(){if(f>=26){l.error("Maximum 26 options allowed");return}f++,E(f)}function S(){if(f<=2){l.error("Minimum 2 options required");return}f--,E(f)}function R(){if(g>=26){l.error("Maximum 26 options allowed");return}g++,I(g)}function F(){if(g<=2){l.error("Minimum 2 options required");return}g--,I(g)}function q(r){y=r;const e=document.getElementById("matchingPairsContainer"),i={};for(let o=1;o<=10;o++){const n=document.getElementById(`match${o}Left`),t=document.getElementById(`match${o}Right`);n&&(i[`${o}Left`]=n.value),t&&(i[`${o}Right`]=t.value)}e.innerHTML="";for(let o=0;o<r;o++){const n=o+1,t=document.createElement("input");t.type="text",t.id=`match${n}Left`,t.placeholder=`Item ${n}`,t.value=i[`${n}Left`]||"",t.style.width="100%";const s=document.createElement("input");s.type="text",s.id=`match${n}Right`,s.placeholder=`Match ${n}`,s.value=i[`${n}Right`]||"",s.style.width="100%",e.appendChild(t),e.appendChild(s)}}function H(){if(y>=10){l.error("Maximum 10 pairs allowed");return}y++,q(y)}function D(){if(y<=2){l.error("Minimum 2 pairs required");return}y--,q(y)}function B(r){h=r;const e=document.getElementById("orderingItemsContainer"),i={};for(let o=1;o<=10;o++){const n=document.getElementById(`order${o}`);n&&(i[o]=n.value)}e.innerHTML="";for(let o=0;o<r;o++){const n=o+1,t=document.createElement("input");t.type="text",t.id=`order${n}`,t.placeholder=`${U(n)} item`,t.value=i[n]||"",t.style.width="100%",e.appendChild(t)}}function N(){if(h>=10){l.error("Maximum 10 items allowed");return}h++,B(h)}function V(){if(h<=2){l.error("Minimum 2 items required");return}h--,B(h)}function U(r){const e=["th","st","nd","rd"],i=r%100;return r+(e[(i-20)%10]||e[i]||e[0])}function j(){localStorage.getItem("token")||(window.location.href="login.html")}async function G(r){try{v.debug("Loading quiz for editing:",r);const e=await b.getById(r),i=e.quiz||e;k=r,document.getElementById("quizTitle").value=i.title||"",document.getElementById("quizDescription").value=i.description||"",document.querySelector(".header h1").textContent="Edit Quiz",document.getElementById("saveButton").textContent="Update Quiz",i.questions&&i.questions.length>0&&(d=i.questions.map(o=>{const n=o.questionSnapshot||{};return{questionText:n.questionText||"",questionType:n.questionType||"mcq",options:n.options||[],correctAnswer:n.correctAnswer,pairs:n.pairs,correctOrder:n.correctOrder,points:o.points||10}}),O()),l.success("Quiz loaded for editing")}catch(e){v.error("Error loading quiz:",e),l.error("Failed to load quiz: "+e.message)}}function x(){const r=document.getElementById("questionType").value;switch(document.getElementById("mcqOptions").style.display="none",document.getElementById("pollOptions").style.display="none",document.getElementById("tfOptions").style.display="none",document.getElementById("matchingOptions").style.display="none",document.getElementById("orderingOptions").style.display="none",document.getElementById("fillblankOptions").style.display="none",r){case"mcq":document.getElementById("mcqOptions").style.display="block";break;case"poll":document.getElementById("pollOptions").style.display="block";break;case"tf":document.getElementById("tfOptions").style.display="block";break;case"matching":document.getElementById("matchingOptions").style.display="block";break;case"ordering":document.getElementById("orderingOptions").style.display="block";break;case"fillblank":document.getElementById("fillblankOptions").style.display="block";break}}function J(){const r=document.getElementById("questionType").value,e=document.getElementById("questionText").value.trim();if(!e){l.error("Please enter a question");return}let i={questionText:e,questionType:r,points:10};try{switch(r){case"mcq":const o=[];let n=null;for(let u=0;u<f;u++){const a=String.fromCharCode(65+u),p=document.getElementById(`option${a}`);if(p&&p.value.trim()){o.push(p.value.trim());const C=document.querySelector(`input[name="correctAnswer"][value="${a}"]`);C&&C.checked&&(n=a)}}if(o.length<2){l.error("Please provide at least 2 answer options");return}i.options=o,i.correctAnswer=n;break;case"poll":const t=[];for(let u=0;u<g;u++){const a=String.fromCharCode(65+u),p=document.getElementById(`pollOption${a}`);p&&p.value.trim()&&t.push(p.value.trim())}if(t.length<2){l.error("Please provide at least 2 poll options");return}i.options=t;const s=document.getElementById("pollParticipationPoints").checked;i.awardParticipationPoints=s;break;case"tf":i.options=["True","False"],i.correctAnswer=document.querySelector('input[name="tfAnswer"]:checked').value;break;case"matching":const c=[];for(let u=1;u<=y;u++){const a=document.getElementById(`match${u}Left`).value.trim(),p=document.getElementById(`match${u}Right`).value.trim();a&&p&&c.push({left:a,right:p})}if(c.length<2){l.error("Please provide at least 2 matching pairs");return}i.pairs=c;break;case"ordering":const m=[];for(let u=1;u<=h;u++){const a=document.getElementById(`order${u}`).value.trim();a&&m.push(a)}if(m.length<2){l.error("Please provide at least 2 items to order");return}i.correctOrder=m;break;case"fillblank":const $=document.getElementById("blankAnswer").value.trim();if(!$){l.error("Please provide the correct answer");return}if(!e.includes("[blank]")){l.error("Please include [blank] in your question where the answer should go");return}i.correctAnswer=$;break}if(w!==null){d[w]=i,l.success("Question updated successfully!"),w=null;const o=document.querySelector('button[onclick="addQuestion()"]');o&&(o.textContent="+ Add This Question",o.className="btn btn-primary")}else d.push(i),l.success("Question added successfully!");Q(),O()}catch(o){v.error("Error adding question:",o),l.error("Error adding question: "+o.message)}}function Q(){document.getElementById("questionText").value="";for(let e=0;e<f;e++){const i=String.fromCharCode(65+e),o=document.getElementById(`option${i}`);o&&(o.value="")}for(let e=0;e<g;e++){const i=String.fromCharCode(65+e),o=document.getElementById(`pollOption${i}`);o&&(o.value="")}for(let e=1;e<=y;e++){const i=document.getElementById(`match${e}Left`),o=document.getElementById(`match${e}Right`);i&&(i.value=""),o&&(o.value="")}for(let e=1;e<=h;e++){const i=document.getElementById(`order${e}`);i&&(i.value="")}const r=document.getElementById("blankAnswer");r&&(r.value="")}function K(r){const e=d[r];switch(w=r,document.getElementById("questionText").value=e.questionText,document.getElementById("questionType").value=e.questionType,x(),e.questionType){case"mcq":if(e.options&&(E(e.options.length),e.options.forEach((n,t)=>{const s=String.fromCharCode(65+t),c=document.getElementById(`option${s}`);c&&(c.value=n)}),e.correctAnswer)){const n=document.querySelector(`input[name="correctAnswer"][value="${e.correctAnswer}"]`);n&&(n.checked=!0)}break;case"poll":e.options&&(I(e.options.length),e.options.forEach((n,t)=>{const s=String.fromCharCode(65+t),c=document.getElementById(`pollOption${s}`);c&&(c.value=n)}));break;case"tf":if(e.correctAnswer){const n=document.querySelector(`input[name="tfAnswer"][value="${e.correctAnswer}"]`);n&&(n.checked=!0)}break;case"matching":e.pairs&&(q(e.pairs.length),e.pairs.forEach((n,t)=>{const s=t+1,c=document.getElementById(`match${s}Left`),m=document.getElementById(`match${s}Right`);c&&(c.value=n.left),m&&(m.value=n.right)}));break;case"ordering":e.correctOrder&&(B(e.correctOrder.length),e.correctOrder.forEach((n,t)=>{const s=document.getElementById(`order${t+1}`);s&&(s.value=n)}));break;case"fillblank":e.correctAnswer&&(document.getElementById("blankAnswer").value=e.correctAnswer);break}const i=document.querySelector('button[onclick="addQuestion()"]');i&&(i.textContent="Update Question",i.className="btn btn-success");const o=document.getElementById("cancelEditBtn");o&&(o.style.display="inline-block"),document.getElementById("questionText").scrollIntoView({behavior:"smooth",block:"center"}),l.success("Question loaded for editing")}function W(r){window.confirm("Remove this question?")&&(d.splice(r,1),O(),w===r&&z(),l.success("Question removed"))}function z(){w=null,Q();const r=document.querySelector('button[onclick="addQuestion()"]');r&&(r.textContent="+ Add This Question",r.className="btn btn-primary");const e=document.getElementById("cancelEditBtn");e&&(e.style.display="none"),l.success("Edit cancelled")}function O(){const r=document.getElementById("questionsList");if(d.length===0){r.innerHTML='<p style="color: var(--text-secondary); font-size: 14px;">No questions added yet.</p>';return}r.innerHTML=`
                <div style="margin-bottom: 12px;">
                    <strong>${d.length} Question(s) Added:</strong>
                </div>
                ${d.map((e,i)=>`
                    <div style="background-color: #F9FAFB; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px;">Q${i+1}: ${e.questionText}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type: ${X(e.questionType)}</div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="editQuestion(${i})">Edit</button>
                            <button type="button" class="btn btn-danger btn-small" onclick="removeQuestion(${i})">Remove</button>
                        </div>
                    </div>
                `).join("")}
            `}function X(r){return{mcq:"Multiple Choice",poll:"Poll",tf:"True/False",matching:"Matching",ordering:"Put in Order",fillblank:"Fill in the Blank"}[r]||r.toUpperCase()}async function Y(r){r.preventDefault();const e=document.getElementById("quizTitle").value.trim(),i=document.getElementById("quizDescription").value.trim();if(!e){l.error("Please enter a quiz title");return}if(d.length===0){l.error("Please add at least one question to the quiz");return}const o=d.map(t=>({questionSnapshot:{questionText:t.questionText,questionType:t.questionType,options:t.options,correctAnswer:t.correctAnswer,pairs:t.pairs,correctOrder:t.correctOrder},points:t.points||10})),n={title:e,description:i,type:"standard",questions:o,questionCount:o.length,settings:{shuffleQuestions:!1,shuffleAnswers:!1,showCorrectAnswers:!0}};try{document.getElementById("saveButton").disabled=!0,document.getElementById("saveButton").textContent="Saving...";let t;k?(t=await b.update(k,n),v.debug("Quiz updated:",t),l.success("Quiz updated successfully!")):(t=await b.create(n),v.debug("Quiz created:",t),l.success("Quiz saved successfully!")),setTimeout(()=>{window.location.href="quizzes.html"},1e3)}catch(t){v.error("Error saving quiz:",t),l.error("Failed to save quiz: "+t.message),document.getElementById("saveButton").disabled=!1,document.getElementById("saveButton").textContent="Save Quiz"}}function Z(){d.length>0?window.confirm("Are you sure you want to cancel? All unsaved changes will be lost.")&&(window.location.href="quizzes.html"):window.location.href="quizzes.html"}function _(){const r=document.getElementById("questionText"),e=r.selectionStart,i=r.selectionEnd,o=r.value,n=o.substring(0,e)+"[blank]"+o.substring(i);r.value=n,r.selectionStart=r.selectionEnd=e+7,r.focus()}function ee(){const r=document.getElementById("questionText").value.trim();if(!r){l.error("Please enter question text first");return}const e=document.getElementById("questionType").value;let i={text:r,type:e,timeLimit:60,points:10};if(e==="mcq"||e==="poll"){const n=[];for(let t=0;t<(e==="mcq"?f:g);t++){const s=String.fromCharCode(65+t),c=document.getElementById(e==="mcq"?`option${s}`:`pollOption${s}`);c&&c.value.trim()&&n.push(c.value.trim())}i.options=n}else if(e==="matching"){const n=[],t=[];for(let s=1;s<=y;s++){const c=document.getElementById(`match${s}Left`),m=document.getElementById(`match${s}Right`);c&&c.value.trim()&&n.push(c.value.trim()),m&&m.value.trim()&&t.push(m.value.trim())}i.matching={items:n,matches:t}}else if(e==="ordering"){const n=[];for(let t=1;t<=h;t++){const s=document.getElementById(`order${t}`);s&&s.value.trim()&&n.push(s.value.trim())}i.ordering=n}const o=A(i);document.getElementById("questionPreviewBody").innerHTML=o,document.getElementById("questionPreviewModal").classList.add("active")}function P(){document.getElementById("questionPreviewModal").classList.remove("active")}document.addEventListener("keydown",r=>{if(r.key==="Escape"){const e=document.getElementById("questionPreviewModal");e&&e.classList.contains("active")&&P()}});window.updateQuestionOptions=x;window.addQuestion=J;window.editQuestion=K;window.removeQuestion=W;window.cancelEditQuestion=z;window.cancelQuiz=Z;window.insertBlank=_;window.addMcqOption=L;window.removeMcqOption=S;window.addPollOption=R;window.removePollOption=F;window.addMatchingPair=H;window.removeMatchingPair=D;window.addOrderingItem=N;window.removeOrderingItem=V;window.previewQuestion=ee;window.closePreviewModal=P;
