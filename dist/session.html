<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Management - IntellaClick</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <!-- Modular CSS -->
  <script type="module" crossorigin src="/assets/session-D7J4eoc_.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/toast-Cbd37M37.js">
  <link rel="modulepreload" crossorigin href="/assets/logger-CXzo1yMG.js">
  <link rel="modulepreload" crossorigin href="/assets/questionPreview-ChZvlnqt.js">
  <link rel="stylesheet" crossorigin href="/assets/session-CecWfiqS.css">
  <link rel="stylesheet" crossorigin href="/assets/common-ABeTdMwf.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Session Management</h1>
            <div class="session-info">
                <div class="info-item">
                    <span class="info-label">Session Code</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="session-code" id="sessionCode">Loading...</span>
                        <button class="btn btn-secondary" onclick="copySessionCode()" style="padding: 4px 8px; font-size: 12px;">Copy</button>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    <span class="status-badge status-waiting" id="sessionStatus">Waiting</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Participants</span>
                    <span class="info-value" id="participantCount">0</span>
                </div>
            </div>
            <div class="join-url" id="joinUrl">
                Students can join at: https://join.intellaclick.com/session/XXXXX
            </div>
            <div class="qr-container">
                <div class="qr-code" id="qrcode"></div>
                <div class="qr-info">
                    <h3>Scan to Join</h3>
                    <p>Students can scan this QR code with their phone to join the session instantly. The code contains the direct link to join this session.</p>
                </div>
            </div>
        </div>

        <div class="section" id="questionSection">
            <h2>Question Management</h2>
            
            <!-- Question Queue -->
            <div id="questionQueue" style="margin-bottom: 20px;">
                <h3 style="font-size: 16px; margin-bottom: 12px;">Question Queue</h3>
                <div id="queueList" style="background-color: var(--background); padding: 12px; border-radius: 8px; min-height: 60px;">
                    <p style="color: var(--text-secondary); font-size: 14px;">No questions in queue. Create a new question or import from a quiz.</p>
                </div>
            </div>

            <!-- Current Question Display -->
            <div id="currentQuestionSection" style="display: none; margin-bottom: 20px;">
                <h3 style="font-size: 16px; margin-bottom: 12px;">Current Question</h3>
                <div style="background-color: #EFF6FF; padding: 16px; border-radius: 8px;">
                    <h4 id="questionText" style="margin-bottom: 12px;"></h4>
                    <div id="questionOptions"></div>
                </div>
            </div>

            <div class="control-buttons">
                <button class="btn btn-primary" onclick="openDisplayView()" style="font-size: 1rem; font-weight: 600;">
                    <svg width="20" height="20" fill="currentColor" style="margin-right: 6px;">
                        <path d="M0 1.5A1.5 1.5 0 0 1 1.5 0h13A1.5 1.5 0 0 1 16 1.5v13a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13zM1.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5h-13z"/>
                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                    </svg>
                    üñ•Ô∏è Open Display View
                </button>
                <button class="btn btn-primary" onclick="showQuestionModal()">
                    <svg width="16" height="16" fill="currentColor" style="margin-right: 4px;">
                        <path d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                    </svg>
                    Create Question
                </button>
                <button class="btn btn-secondary" onclick="showImportModal()">
                    <svg width="16" height="16" fill="currentColor" style="margin-right: 4px;">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                    </svg>
                    Import Quiz
                </button>
                <button class="btn btn-success" onclick="sendNextQuestion()" disabled id="sendBtn">Next Question</button>
                <button class="btn btn-secondary" onclick="stopQuestion()" disabled id="stopBtn">Stop Question</button>
                <button class="btn btn-success" onclick="showResults()" id="resultsBtn">Show Results</button>
            </div>
        </div>

        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 style="margin: 0;">Participants</h2>
                <button class="btn btn-secondary" onclick="loadSession()" style="padding: 6px 12px; font-size: 12px;">
                    Refresh
                </button>
            </div>
            <div id="participantsList" class="participants-grid">
                <p style="color: var(--text-secondary);">No participants yet. Share the session code for students to join.</p>
            </div>
        </div>

        <div class="section" id="responsesSection" style="display: none;">
            <h2>Responses</h2>
            <div class="response-chart" id="responseChart">
                Response data will appear here
            </div>
        </div>

        <div class="control-buttons">
            <button class="btn btn-danger" onclick="endSession()">End Session</button>
            <a href="classes.html" class="btn btn-secondary">Back to Classes</a>
        </div>
    </div>


    <!-- Create Question Modal -->
    <div id="questionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeQuestionModal()">&times;</span>
                <h2>Create Quick Question</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalQuestionText">Question</label>
                    <textarea id="modalQuestionText" rows="3" placeholder="Enter your question here..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="modalQuestionType">Question Type</label>
                    <select id="modalQuestionType" onchange="updateModalOptions()">
                        <option value="mcq">Multiple Choice</option>
                        <option value="poll">Poll Question (No Correct Answer)</option>
                        <option value="tf">True/False</option>
                        <option value="matching">Matching</option>
                        <option value="ordering">Put in Order</option>
                        <option value="fillblank">Fill in the Blank</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="modalTimeLimit">Time Limit (seconds)</label>
                        <input type="number" id="modalTimeLimit" value="60" min="10" max="300">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="modalPoints">Points</label>
                        <input type="number" id="modalPoints" value="10" min="1" max="100">
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="modalAwardParticipation" style="width: 20px; height: 20px; cursor: pointer;">
                        <span>Award points for participation (even if answer is wrong)</span>
                    </label>
                </div>

                <div id="modalQuestionOptions">
                    <!-- Options will be dynamically inserted based on question type -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeQuestionModal()">Cancel</button>
                <button class="btn btn-outline" onclick="previewModalQuestion()" style="margin-left: auto;">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button class="btn btn-primary" onclick="addQuestionToQueue()">Add to Queue</button>
            </div>
        </div>
    </div>

    <!-- Question Preview Modal -->
    <div class="preview-modal" id="questionPreviewModal" onclick="if(event.target === this) closePreviewModal()">
        <div class="preview-content">
            <div class="preview-header">
                <h2><i class="fas fa-eye"></i> Question Preview</h2>
                <button class="preview-close" onclick="closePreviewModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="preview-body" id="questionPreviewBody">
                <!-- Preview content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Import Quiz Modal -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeImportModal()">&times;</span>
                <h2>Import Quiz Questions</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px;">Select a quiz to import its questions:</p>
                <div class="quiz-list" id="quizList">
                    <p style="color: var(--text-secondary); text-align: center; padding: 20px;">Loading quizzes...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="importSelectedQuiz()" disabled id="importBtn">Import Selected</button>
            </div>
        </div>
    </div>

</body>
</html>